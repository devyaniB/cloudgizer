<!DOCTYPE html>
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="description" content="Cloudgizer is a tool for building web applications as Apache modules in C programming language."/>
<meta name="viewport" content="width=device-width, initial-scale=0.5">
<title>Cloudgizer - development tools for web applications in C programming language</title>
<style type="text/css">

body, html {
    font-family: Georgia, "Times New Roman", Helvetica, sans-serif;
    color: black;
    text-rendering: optimizelegibility;
    font-size:18px;
    background-color: white;
    max-width: 100%;
    min-height: 100%;
    margin: 0px;
    z-index: 1;
    height: 100%;
    text-align:left;
    padding-left:1vw;
    padding-right:1vw;
}


/* code styling */
div.codestyle
{
    border:0.5vw #E9EBFD solid;
    border-top-left-radius: 4px;
    border-top-right-radius: 4px;
    border-bottom-left-radius: 4px;
    border-bottom-right-radius: 4px;
    box-shadow: 5px 5px #C9CBDB ;
    text-align:left;
    background-color:#F5F5F5;
    padding:1vw;
    margin-top:1vw;
    margin-bottom:1vw;
}

h1 {
      margin-top:40px;
      border-bottom: 3px solid orange;
}

h2 {
      margin-top:40px;
      border-bottom: 2px solid orange;
}

h3 {
      margin-top:40px;
      border-bottom: 1px solid orange;
}
</style>

</head>
<body>
<div>

<h1>Cloudgizer</h1>
Cloudgizer is a tool for building web applications as Apache modules, with emphasis on performance, small-footprint, and more productive and safer programming in C. It combines the ease of scripting with the power of C, improving the resource utilization for cloud applications.<br/>
<br/>
Current stable version is <b>1.2</b> (as tagged in git repository).<br/>
<br/>
This site has been last updated on Sat Oct  6 08:47:27 MST 2018.<br/>
<br/>
This is the documentation for the latest Cloudgizer code. If you download older tagged versions from the git repository, each comes with 'docs' directory that contains the documentation matching that version.<br/>
<br/>
<hr/>
<br/>


<a href='#0'>About Cloudgizer</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#1'>Example source code - learn by example</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#2'>License</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#3'>Source code, reporting issues</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#4'>Hello world</a><br/>
<a href='#5'>Basics</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#6'>The big picture</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#7'>Basic components</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#8'>The architecture</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#9'>Structure of an application</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#10'>Hello World</a><br/>
<a href='#11'>Download and Installation</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#12'>Download source code and create installation file</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#13'>Install Cloudgizer</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#14'>Create Example Application installation file</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#15'>Install the Example application</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#16'>Your own application</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#17'>Developing and building application, Cloning applications</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#18'>Packaging</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#19'>Deploying</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#20'>Smoke tests</a><br/>
<a href='#21'>Getting started</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#22'>Configuration, database and debug files</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#23'>Configuration file</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#24'>Database file</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#25'>Debug file</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#26'>How to write code</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#27'>Markup code block</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#28'>Markup usage</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#29'>Line continuation and whitespaces</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#30'>A typical program</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#31'>Errors in your program</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#32'>CLD utility</a><br/>
<a href='#33'>Processing of requests</a><br/>
<a href='#34'>Constructs</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#35'>Comments</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#36'>Outputting data</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#37'>Whitespaces and empty lines</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#38'>Semicolon</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#39'>Encoding output</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#40'>Ignoring markup</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#41'>Outputting preprocessor data to a file</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#42'>Outputting HTTP header for a typical web page</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#43'>Defining, setting and outputting integers</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#44'>Outputting data from a command line program</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#45'>Embedded C code</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#46'>URL input parameters (GET and POST)</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#47'>Cookies, setting and getting</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#48'>Database queries</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#49'>Basic usage of queries</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#50'>Database transactions</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#51'>Column Length</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#52'>When query has no results</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#53'>Force query to produce a single empty row</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#54'>Current row in a query result set</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#55'>Number of rows and columns in a query result set</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#56'>Number of affected rows in DML</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#57'>Input parameters to queries</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#58'>Column names</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#59'>Nesting queries</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#60'>Using multiple query texts at run-time (conditional queries)</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#61'>Dynamic queries</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#62'>Dynamic queries when table structure is unknown</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#63'>Result-set data array</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#64'>Using query results more than once</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#65'>Copying query text in multiple places safely (query shards)</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#66'>Re-using query text in multiple places (query fragments)</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#67'>Loop control in result set</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#68'>Error handling in executing queries</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#69'>Getting auto_increment value</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#70'>NULL and result column data types</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#71'>Executing Cloudgizer program from command line</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#72'>Executing external programs</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#73'>Loading URL content (calling a web page) programmatically</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#74'>Strings</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#75'>Defining and copying strings</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#76'>Appending string</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#77'>Search and replace string</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#78'>Constructing complex strings</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#79'>Program flow</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#80'>Loops</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#81'>Conditional statements (if, else...)</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#82'>Files</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#83'>File storage</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#84'>Permissions and ownership</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#85'>Uploading files</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#86'>Reading a whole file</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#87'>Writing a whole file or appending to a file</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#88'>Copying a file</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#89'>Web address of server</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#90'>Error handling in general</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#91'>Include files</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#92'>Debugging your code</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#93'>Tracing and debugging options</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#94'>Finding where program crashed</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#95'>Enabling debugging information</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#96'>Which shared libraries are loaded?</a><br/>
<a href='#97'>API</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#98'>Memory allocation</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#99'>Allocation and garbage collection</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#100'>Get size of memory allocated for variable</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#101'>Check if allocated memory is valid, overwritten or underwritten</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#102'>Configuration parameters</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#103'>Tracing and debugging</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#104'>Write to trace file</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#105'>Which trace file is being written to?</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#106'>Using custom tag value for debugging</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#107'>Linting your HTML code dynamically</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#108'>URL input</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#109'>URL input parameters</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#110'>Is URL referrer from the same site?</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#111'>URL string that is being processed</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#112'>URL parameters manipulation</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#113'>Cookies</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#114'>Data type for storing</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#115'>Cookies: get, set, delete, find</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#116'>Global data</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#117'>Encoding and Decoding, URL encoding, Web encoding, Base64 encoding</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#118'>Numbers</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#119'>Create string from integer</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#120'>Check if string is a positive integer or a number</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#121'>Execution of external programs, piping from one program to another</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#122'>Output data and HTTP header</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#123'>Outputting HTTP header, custom HTTP response headers</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#124'>Encoding data for output</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#125'>Output text without breaks</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#126'>Disable and Enable HTML output, status of enablement</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#127'>Send files to the client and output HTTP headers for files</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#128'>File not found (404)</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#129'>Flush output</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#130'>Create new database document and a new associated file</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#131'>Strings</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#132'>Initialize, Copy, Append strings</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#133'>Output data to string</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#134'>Change case of strings (upper, lower)</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#135'>Substrings</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#136'>Trim string</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#137'>Break down string into an array of strings based on a delimiter</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#138'>Clear Unused variable error</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#139'>Error reporting</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#140'>Encryption and hashing</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#141'>Hashing</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#142'>Encrypting data</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#143'>Decrypting data</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#144'>Generating random string</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#145'>Storing and retrieving data in a sequential list (FIFO)</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#146'>Executing Cloudgizer program from command line (Batch processing)</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#147'>Using batch processing</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#148'>Exit code for batch processing</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#149'>POST URL (web call)</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#150'>Files</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#151'>File storage</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#152'>Get file size</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#153'>Copy files</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#154'>Read entire file into a string variable</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#155'>Write whole file from a string</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#156'>Append to file from a string</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#157'>Lock a file</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#158'>Get application home directory</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#159'>Check if directory</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#160'>Temporary files</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#161'>Send email</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#162'>Queries and Transactions</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#163'>SELECT from the database</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#164'>Get value from auto-increment column</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#165'>Execute any SQL other than SELECT, including DDL statements</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#166'>Check for open transaction</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a href='#167'>Get miscellaneous</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#168'>Get web address for forms and links</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#169'>Get Base URL of server</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#170'>Get version</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#171'>Get current, past or future time, including GMT</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#172'>Get current time</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#173'>Get application name</a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='#174'>Get environment variable (web or command shell)</a><br/>

<a id='0'>
<h1>About Cloudgizer</h1>
</a>
Cloudgizer is a tool for building web applications as Apache modules in C programming language. <br/>
<a id='1'>
<h2>Example source code - learn by example</h2>
</a>
<ul><li> The Example Application (also used as a smoke test for Cloudgizer) contains good amount of code used to test basic Cloudgizer functionality - these are small snippets of code demonstrating usage.<br/>
<br/>
<a href="#install">Install the Example application</a>. <br/>
<br/>
The Example application is also a starting point for your own applications.<br/>
<br/>
</li> <li>As a large-scale example, Rentomy is a business application written entirely with Cloudgizer (about 32,000 lines of code). <br/>
<br/>
Rentomy is a Free Open Source cloud software for Rental Property Managers - check out the <a href="https://dasoftver.bitbucket.io/rentomy/">documentation</a>.<br/>
<br/>
<a href="/rentomy/#install">Install Rentomy</a>, or if you need to, you can install from <a href="/rentomy/#source">source code</a>.<br/>
</li></ul><br/>
Browse the source code for both Example application and Rentomy to learn by example, get a feel for developing with Cloudgizer and to understand better the usage patterns of markups and API.<br/>
<a id='2'>
<h2>License</h2>
</a>
<br/>
Cloudgizer is licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.<br/>
<a id='3'>
<h2>Source code, reporting issues</h2>
</a>
<br/>
Source code is available at <a href="https://bitbucket.org/dasoftver/cloudgizer/">Cloudgizer git repository</a>.  <br/>
<br/>
Older Cloudgizer versions stable enough for download and installation are tagged in git.<br/>
<br/>
Report issues or questions - go to <a href="https://bitbucket.org/dasoftver/cloudgizer/issues?status=new&status=open">Issue tracker</a>.<br/>
<a id='4'>
<h2>Hello world</h2>
</a>
<br/>
Here is a program that outputs 'Hello World!' to the browser (and here' a <a href="#hello_world">database-enabled one</a>):<br/>
<div class="codestyle">
#include "<span style="color:blue">cld.h</span>"<br/>
<br/>
void home()<br/>
{<br/>
 &nbsp; &nbsp;<span style="color:blue">/*&lt;</span><br/>
 &nbsp; &nbsp; <span style="color:blue">output-http-header</span><br/>
<br/>
 &nbsp; &nbsp; Hello World!<br/>
 &nbsp; &nbsp;<span style="color:blue">&gt;*/</span><br/>
}<br/>
</div>
<a id='5'>
<h1>Basics</h1>
</a>
<a id='6'>
<h2>The big picture</h2>
</a>
<br/>
Cloudgizer is a tool for building web applications as Apache modules in C language enhanced with simple markup, with emphasis on performance, small-footprint, and more productive and safer programming in C. <br/>
<br/>
The programmer writes simple markup language mixed with C code, which is then translated entirely into C code and compiled natively as Apache module. The resulting application is fast and takes less memory, as there are no interpreters or virtual machines. <br/>
<br/>
Features include easy markups to use MariaDB database, HTML input parameters, cookies, simpler outputting of web pages, files storage and manipulation, encryption, encoding, program execution, web calls, safer and easier string manipulation etc. - the list is too long to place in one sentence. Overall Cloudgizer does a lot of stuff for you that you'd otherwise need to do yourself.<br/>
<br/>
A memory garbage collection system and memory overwrite/underwrite detection comes in handy for program stability. The same goes for string and memory handling markups to help write applications that won't crash.<br/>
<br/>
Also included is an application packaging system and an automated application installer. This makes rollout of products and release cycle more manageable.<br/>
<br/>
Cloudgizer source files have extension <span style="color:blue">.v</span>. <br/>
<br/>
Cloudgizer pre-compiler (<span style="color:blue">cld</span> program) will turn your .v files into .c files, ready for compilation as pure C programs.<br/>
<br/>
Then, your program will be compiled and linked with Apache web server on RH/Centos systems. It links with Apache as an Apache module in a "prefork" configuration. It does the work of communicating with Apache, and it makes it easier to write high-performance/small-footprint web programs in C. <br/>
<br/>
Cloudgizer is not designed to be thread-safe as it works in a "prefork" configuration of Apache.<br/>
<br/>
You can also build command-line programs. The same program can serve as both command-line utility and a web program linked with Apache.<br/>
<br/>
Cloudgizer works with RedHat/Centos 7 operating system, Apache web server and mariaDB database.<br/>
<a id='7'>
<h2>Basic components</h2>
</a>
<br/>
These are the files installed:<br/>
<br/>
<ul><li><span style="color:blue">cld</span> command line utility. Once installed, just type <span style="color:blue">cld</span> to get help for it. <span style="color:blue">cld</span> will turn the Cloudgizer code into C code you can view, and that is ready for compilation and linking.<br/>
<br/>
</li> <li><span style="color:blue">cld.h</span>: include file for Cloudgizer programs.<br/>
<br/>
</li> <li><span style="color:blue"> libacld</span>, <span style="color:blue"> libcld</span>: shared libraries that implement Cloudgizer features.<br/>
<br/>
</li> <li><span style="color:blue">cldmakefile</span>: common Makefile used for all Cloudgizer programs.<br/>
<br/>
</li> <li><span style="color:blue">cldbuild</span> script that will compile and link your program.<br/>
<br/>
</li> <li><span style="color:blue">cldpackapp</span> script that will create installation file for your application.<br/>
<br/>
</li> <li><span style="color:blue">cldgoapp</span> script that will install your application.<br/>
</li></ul><br/>
All scripts, the makefile and the command line utility are located in <span style="color:blue">/usr/bin</span> directory. Include file is in <span style="color:blue">/usr/local/include/cld</span> directory. Libraries are in <span style="color:blue">/usr/local/lib/cld</span> directory.<br/>
<a id='8'>
<h2>The architecture</h2>
</a>
<br/>
Apache server is the container which holds your Cloudgizer applications as Apache modules. The module mechanism allows for fast response times and very little overhead.<br/>
<br/>
Apache server can house many Cloudgizer applications, each being a separate Apache module. These separate modules are generally entirely different applications.<br/>
<br/>
Apache handles the infrastructure part while your Cloudgizer code makes up the applications themselves.<br/>
<br/>
All Cloudgizer applications are hosted under a single Linux user, with each application within its own subdirectory under the user's home directory. The Apache server user is set to this Linux user during the application installation - it is the currently logged-on user during installation. Make sure to install all applications under the same Linux user. Set the Apache's DocumentRoot to be accessible by this user. <br/>
<br/>
Each Cloudgizer application has its own database schema within a MariaDB database server.<br/>
<a id='9'>
<h2>Structure of an application</h2>
</a>
<br/>
Each application is installed in its own directory, known as the <span style="color:blue">application home directory</span>. If application name (given by <span style="color:blue">CLD_APP_NAME</span> in <span style="color:blue">appinfo</span> file during installation) is 'your_app_name', then application home directory is /home/user/your_app_name.<br/>
<br/>
The following are important files your project must have - they all have default implementation in the Example Application:<br/>
<ul><li><span style="color:blue">cld_handle_request.v</span> is a file that implements <span style="color:blue">cld_handle_request</span> function. This is the function called from the framework whenever there is a web request, or a command-line execution. The function doesn't return a value and has no parameters.<br/>
The implementation typically calls whatever handler you want to process the incoming request based on some input parameter. In the Example application we use 'page' input parameter in the URL. Typically an input parameter named 'page' signifies the request, and a given function is called to handle the request - a function that you implement.<br/>
<br/>
</li> <li><span style="color:blue">file_too_large.v</span> file contains implementation for what happens if uploaded file is too large. <br/>
<br/>
</li> <li><span style="color:blue">oops.v</span> file contains implementation for what happens when your program errors-out (i.e. when you call <span style="color:blue">report-error</span>) or when it crashes. The framework will call this function most of the times (sometimes the crash is too severe and it won't be called). By default, this will show a 'Oops' screen and it will email the details of the crash (including the stack) to the email address in the <span style="color:blue">config</span> file. <br/>
<br/>
</li> <li><span style="color:blue">cldbuild</span> will make your application. It uses <span style="color:blue">sourcelist</span> file to do that. <span style="color:blue">sourcelist</span> is provided so you can add your source files easily. Suppose you want to add a new handler for whatever functionality:<br/>
<ul><li>Add <span style="color:blue">your_file</span>.o to SOURCE_FILES list<br/>
<br/>
</li> <li>Below SOURCE_FILES, add line:<br/>
<div class="codestyle">
<span style="color:blue">your_file</span>.o: <span style="color:blue">your_file</span>.v $(CLDINCLUDE)/cld.h $(HEADER_FILES)<br/>
</div>
</li></ul><br/>
That's it. If you add an include file, add it to the list in HEADER_FILES variable (all in <span style="color:blue">sourcelist</span>).</li></ul><br/>
<br/>
In short, you must have the following implemented for an application to work:<br/>
<br/>
<ul><li><span style="color:blue">cld_handle_request</span> function which is called on every request and which routes requests to any number of your functions, each handling a different request, based on input parameters.<br/>
<br/>
</li> <li><span style="color:blue">file_too_large</span> and <span style="color:blue">oops</span> functions which handle what happens when uploaded file is too large or when an error or crash happens. You can keep default implementations.<br/>
</li></ul><br/>
The rest is you implementing the handler functions for different kinds of requests. To get started without writing everything from scratch, you should take the Example application and change it into your own.<br/>
<br/>
<a id="hello_world"></a>
<a id='10'>
<h2>Hello World</h2>
</a>
<br/>
This is the Hello World example that is included in the Example application. It reads data from the database and displays it in the browser. It exemplifies the coding style of Cloudgizer, which is C code with markup. Markup code is enclosed in <span style="color:blue">/*&lt;</span> and <span style="color:blue">&gt;*/</span> tags:<br/>
<div class="codestyle">
#include "<span style="color:blue">cld.h</span>"<br/>
<br/>
void home()<br/>
{<br/>
 &nbsp; &nbsp;<span style="color:blue">/*&lt;</span><br/>
<br/>
 &nbsp; &nbsp; <span style="color:blue">output-http-header</span><br/>
<br/>
 &nbsp; &nbsp; Hello World!<br/>
<br/>
 &nbsp; &nbsp; <span style="color:blue">run-query#</span>get_db="select hi from hello"<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">query-result#</span>get_db, hi <span style="color:blue">as</span> <span style="color:blue">define</span> db_result<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">print-web</span> db_result<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;br/&gt;<br/>
 &nbsp; &nbsp; <span style="color:blue">end-query</span><br/>
 &nbsp; &nbsp; &lt;hr/&gt;<br/>
<br/>
 &nbsp; &nbsp; <span style="color:blue">&gt;*/</span><br/>
}<br/>
</div>
<a id="install"></a>
<a id='11'>
<h1>Download and Installation</h1>
</a>
You need RedHat/Centos 7 on a dedicated server or a VPS (virtual private server) and Internet connectivity. <br/>
<br/>
You'll first get the source code from git repository, then create an installation file from it, and then use it to install Cloudgizer wherever you want. The benefit of source distribution like this is that you will get the highest possible performance by compiling on your specific hardware.<br/>
<br/>
<a id='12'>
<h2>Download source code and create installation file</h2>
</a>
First you need to install wget and git if they are not already:<br/>
<div class="codestyle">
sudo yum -y install git<br/>
sudo yum -y install wget<br/>
</div>
To make the installation file from source code:<br/>
<ul><li>Get the source code in a newly created empty directory:<br/>
<div class="codestyle">
mkdir -p src<br/>
cd src<br/>
git clone https://dasoftver@bitbucket.org/dasoftver/cloudgizer.git .<br/>
<br/>
# If you are getting a particular tagged version (for example version 1.2):<br/>
<br/>
git clone --branch 1.2 https://dasoftver@bitbucket.org/dasoftver/cloudgizer.git .<br/>
<br/>
# To see available tagged versions:<br/>
<br/>
git tag<br/>
</div>
</div>
</li> <li>Setup tools, libraries and the database:<br/>
<div class="codestyle">
sudo ./<span style="color:blue">setup_env</span><br/>
sudo ./<span style="color:blue">setup_maria</span><br/>
sudo ./<span style="color:blue">setup_postfix</span><br/>
</div>
</li> <li>Create Cloudgizer installation file:<br/>
<div class="codestyle">
./<span style="color:blue">pack_all</span><br/>
</div>
This will create <span style="color:blue">cloudgizer.tar.gz</span> installation file. You can use to install Cloudgizer, see <a href="#install_binary">Install Cloudgizer</a> below.<br/>
</li></ul><br/>
<a id="install_binary"></a>
<a id='13'>
<h2>Install Cloudgizer</h2>
</a>
As a result of the above <a href="#install">creation of the installation file</a> you now have <span style="color:blue">cloudgizer.tar.gz</span>.<br/>
<br/>
The following descibes installing from <span style="color:blue">cloudgizer.tar.gz</span> file.<br/>
 <div class="codestyle">
# Install wget if you don't already have it:<br/>
sudo yum -y install wget<br/>
<br/>
# Unpack installation file:<br/>
sudo rm -rf <span style="color:blue">cloudgizer</span><br/>
tar xvfzm <span style="color:blue">cloudgizer.tar.gz</span><br/>
cd <span style="color:blue">cloudgizer</span><br/>
<br/>
# Setup cloudgizer. You'll be asked questions (regarding database installation and Postfix install) - each stage of installation will be clearly marked:<br/>
sudo ./<span style="color:blue">setup</span><br/>
<br/>
# Verify installation, run cld tool - you should see help:<br/>
<span style="color:blue">cld</span><br/>
<br/>
# Check documentation, it's all in a single web page (like this one):<br/>
ls <span style="color:blue">docs</span>/index.html<br/>
 </div>
Note: Setup process will create MariaDB database and you will be asked to create root database password. The setup will also install other needed software and also setup Postfix for sending emails using TLS encryption. If you are only upgrading (for example due to a bug fix in Cloudgizer), then you may run <span style="color:blue">setup_cld</span> only instead of <span style="color:blue">setup</span> script above.<br/>
<br/>
To get started on writing your own application using Cloudgizer, first install the Example application and build on it. Once you create your own application, you would package it and then install it on customer's site. For these steps, see further in this documentation.<br/>
<a id="test_install"></a>
<a id='14'>
<h2>Create Example Application installation file</h2>
</a>
Follow these instructions to make the installation file from source code. You must have <a href="#install">Cloudgizer installed</a> first.<br/>
<br/>
<ul><li>Under home directory, create example directory, then get source code:<br/>
<div class="codestyle">
cd $HOME<br/>
mkdir -p example<br/>
cd example<br/>
git clone https://dasoftver@bitbucket.org/dasoftver/cloudgizer_example.git .<br/>
</div>
</li> <li>In mariaDB shell, do this:<br/>
<div class="codestyle">
# First enter mariaDB shell by logging in as root, we will assume root password is '<span style="color:blue">rootpwd</span>' - substitute for your root password:<br/>
<br/>
mysql -u root -p<span style="color:blue">rootpwd</span><br/>
<br/>
# Then execute the following (we will assume newly created user will have password '<span style="color:blue">pwd</span>' - substitute for your desired password)<br/>
<br/>
create database example;<br/>
use example;<br/>
create user example;<br/>
set password for example=password('<span style="color:blue">pwd</span>');<br/>
grant select,insert,update,delete on example.* to example;<br/>
source create.sql<br/>
</div>
</li> <li>Create file <span style="color:blue">.db</span> and add the following lines:<br/>
<div class="codestyle">
vi <span style="color:blue">.db</span><br/>
<br/>
# Put the following four lines in <span style="color:blue">.db</span> file, where '<span style="color:blue">pwd</span>' is the user password you created above (substitute for your own):<br/>
<br/>
localhost<br/>
example <br/>
<span style="color:blue">pwd</span><br/>
example<br/>
<br/>
# Set permissions on <span style="color:blue">.db</span> file:<br/>
<br/>
chmod 600 .db<br/>
</li></ul><br/>
</li> <li>Create installation file:<br/>
<div class="codestyle">
cldpackapp<br/>
</li></ul><br/>
</div>
Now you have <span style="color:blue">example.tar.gz</span> file that you can use to install Example Application anywhere. See <a href="#test">install the Example application</a>.<br/>
<a id="test"></a>
<a id='15'>
<h2>Install the Example application</h2>
</a>
Once you have <a href="#test_install">created Example application installation file</a> (i.e. <span style="color:blue">example.tar.gz</span> file), get started by installing the Example application. This is required to build an application of your own.<br/>
<br/>
The following descibes installing from <span style="color:blue">example.tar.gz</span> file.<br/>
 <div class="codestyle">
#Choose a user for Cloudgizer applications (create one if needed). We will use 'cld' as user name. Login as that user. Apache user will be changed to this user during installation.<br/>
su - cld<br/>
<br/>
# Unpack Example application<br/>
sudo rm -rf <span style="color:blue">deploy</span><br/>
tar xvfzm <span style="color:blue">example.tar.gz</span><br/>
cd <span style="color:blue">deploy</span><br/>
<br/>
#Open file <span style="color:blue">appinfo</span>. This file describes the application. Set these variables:<br/>
<ul><li><span style="color:blue">CLD_EMAIL</span> is the email address where crash reports will be sent, and it can be also used for any other application notifications.<br/>
<br/>
</li> <li><span style="color:blue">CLD_SERVER</span> is the web name of your server, by default set to your host name. <br/>
<br/>
</li> <li><span style="color:blue">CLD_DB_ROOT_PWD</span> is the root password of the MariaDb database.<br/>
<br/>
</li> <li><span style="color:blue">CLD_DB_APP_PWD</span> is the password of a new database schema that will be created for the application.<br/>
<br/>
</li></ul><br/>
#After setting these variables, run:<br/>
<span style="color:blue">cldgoapp create</span><br/>
 </div>
To test the installation, note the URLs displayed at the end of installation. They include examples and smoke tests.<br/>
<br/>
In general, for any URL your application may use, the URL's path is always <span style="color:blue">go.your_app_name</span>, where your_app_name is the application name, in this case 'example'. Application name is always the value of <span style="color:blue">CLD_APP_NAME</span> in <span style="color:blue">appinfo</span> file.<br/>
<br/>
After you have successfully installed the Example application, use it as a base code for your own. You'd probably remove all request handlers except Hello World and start from there.<br/>
<a id="deploy"></a>
<a id='16'>
<h2>Your own application</h2>
</a>
<a id='17'>
<h3>Developing and building application, Cloning applications</h3>
</a>
<br/>
If you are a developer, you'd <a href="#test">install the Example application</a> first and then build your application by modifying it to suit your needs.<br/>
<br/>
Once you install the Example application you would clone it into a new application, under the name of your choosing, and develop your application from there.<br/>
<br/>
You can clone any existing application (including the Example) by simply changing its name and then creating an installation file. <br/>
<br/>
To clone an existing application, you'd change <span style="color:blue">CLD_APP_NAME</span> in <span style="color:blue">appinfo</span> file and run <span style="color:blue">cldpackapp</span> to create an installation file for your new application. For example, if you change <span style="color:blue">CLD_APP_NAME</span> to <span style="color:blue">your_app_name</span> and then run <span style="color:blue">cldpackapp</span>, you'd create <span style="color:blue">your_app_name.tar.gz</span> installation file. <br/>
<br/>
See <a href="#packaging">Packaging and Deploying</a> for more information on <span style="color:blue">cldpackapp</span> and on deploying the installation file it produces.<br/>
<br/>
To build an already installed application, use <span style="color:blue">cldbuild</span> followed by restarting the web server:<br/>
 <div class="codestyle">
<span style="color:blue">cldbuild</span><br/>
sudo service httpd restart<br/>
 </div>
Use this if you're developing Cloudgizer applications, or in testing. <br/>
<br/>
You would use the above <span style="color:blue">cldbuild</span> followed by web server restart whenever you change your source code files, in order to test the changes. If you want to rebuild all source files, for example if you change database tables, use <span style="color:blue">cldbuild clean</span> to touch all source code files and then <span style="color:blue">cldbuild</span> to rebuild them.<br/>
<br/>
Most of the time you'd change your source files only (such as <span style="color:blue">.v</span> files). From time to time you'd make more structural changes as your application grows. For example, when changing the database tables, adding or removing files (such as CSS, images, cron jobs) etc., make sure you test your installation. This means your <span style="color:blue">create.sh</span> (and <span style="color:blue">update.sh</span> for upgrades) must be reflecting all those changes in the deployed application. Use <span style="color:blue">cldpackapp</span> to package your application, copy it to a test environment and test your application from scratch using <span style="color:blue">cldgoapp</span>.<br/>
<br/>
<a id="packaging"></a>
<a id='18'>
<h3>Packaging</h3>
</a>
Once your application is ready to be installed at customer site, package the application. The <span style="color:blue">appinfo</span> file is the configuration file for the installation process, and it should contain any variables your installation needs. Do not write <span style="color:blue">appinfo</span> from scratch - always start from the file provided in the Example application and build on it. Script <span style="color:blue">cldpackapp</span> will package your application by producing <span style="color:blue">your_app_name.tar.gz</span> file your customer can install by using <span style="color:blue">cldgoapp</span>. <br/>
<br/>
Most of the stuff done during installation is the same for any application. The application-specific part of installation is done through <span style="color:blue">create.sh</span> file. This is a script you provide in which you can setup anything that installation process can't do, for example you can create database tables or any other custom setup your application needs. If the application is being updated (as opposed to created for the very first time), you would create <span style="color:blue">update.sh</span> file instead and write your application-specific code there. You can use <span style="color:blue">CLD_APP_INSTALL_DIR</span> in these shell scripts to locate files in the installation.<br/>
<br/>
<span style="color:blue">appinfo</span> file is a configuration file for the installation. It always has these variables: <span style="color:blue">CLD_SERVER</span>, <span style="color:blue">CLD_APP_NAME</span>, <span style="color:blue">CLD_EMAIL</span>, <span style="color:blue">CLD_DB_ROOT_PWD</span> and <span style="color:blue">CLD_DB_APP_PWD</span> - these variables are set by the customer during installation. Your responsibility is to set the following variables in <span style="color:blue">appinfo</span>:<br/>
<ul> <li><span style="color:blue">CLD_APP_FILES</span>: the list of files you want to package. This could be anything: images, CSS stylesheets etc. If you distribute source code, this is where you put the list of source files too. Do not state again any files that are already in <span style="color:blue">CLD_REQUIRED_FILES</span> - these are files that installation must have to work anyways. Two of the required files are <span style="color:blue">mod.c</span> and <span style="color:blue">app.c</span> - never modify these files!<br/>
<br/>
</li> <li><span style="color:blue">CLD_APP_NAME</span>: the application name. Each application is housed in its own application home directory with this name under user's home directory.<br/>
<br/>
</li> <li>Any other variables you'd need to install the application. These would be used in <span style="color:blue">create.sh</span> and/or <span style="color:blue">update.sh</span>.<br/>
</ul><br/>
Once you have <span style="color:blue">appinfo</span> file as described above, as well as <span style="color:blue">create.sh</span>/<span style="color:blue">update.sh</span> files, create a deployment file:<br/>
 <div class="codestyle">
<span style="color:blue">cldpackapp</span><br/>
 </div>
This will create <span style="color:blue">your_app_name.tar.gz</span> installation file.<br/>
<br/>
<a href="https://dasoftver@bitbucket.org/dasoftver/cloudgizer_example">Check out the source code</a> of the Example application.<br/>
<a id='19'>
<h3>Deploying</h3>
</a>
At customer's site unpack the installation file:<br/>
 <div class="codestyle">
sudo rm -rf <span style="color:blue">deploy</span><br/>
tar xzvfm <span style="color:blue">your_app_name.tar.gz</span><br/>
cd <span style="color:blue">deploy</span><br/>
<br/>
# Edit <span style="color:blue">appinfo</span> file, set these variable to match customer's environment:<br/>
<ul><li><span style="color:blue">CLD_SERVER</span>: the name of the server. By default it's the hostname of the server.<br/>
<br/>
</li> <li><span style="color:blue">CLD_APP_NAME</span>: the application name. When application is installed, it will be put into directory with this name. Generally, multiple Cloudgizer applications on the same Apache server are hosted under the same user account, with each application encapsulated in its own directory that matches application name. Application name is also the name of Apache module that runs the application, and the database schema name used by the application.<br/>
<br/>
</li> <li><span style="color:blue">CLD_EMAIL</span>: email address to which error reports are sent. Other than that you can use this email for any other purpose (for instance to send notification emails).<br/>
<br/>
</li> <li><span style="color:blue">CLD_DB_ROOT_PWD</span>: root database password.<br/>
<br/>
</li> <li><span style="color:blue">CLD_DB_APP_PWD</span>: database password for the application database schema to be created during the installation.<br/>
<br/>
</li> <li>Anything else: you can specify any other variables of your own that you can use during installation. For example, if your application does backup you can specify a backup server location in a variable and use this variable in <span style="color:blue">create.sh</span> to setup backup.<br/>
</ul><br/>
#<br/>
# Use one of the following to install:<br/>
#<br/>
<br/>
# to create application<br/>
<span style="color:blue">cldgoapp create</span><br/>
<br/>
# to update application <br/>
<span style="color:blue">cldgoapp update</span><br/>
 </div>
Application is always deployed from binaries. If you distribute source code, then the end-user can recompile the source code by using <span style="color:blue">cldbuild</span> script.<br/>
<br/>
Any variable that has <span style="color:blue">PWD</span> in the name will be cleared upon installation for security reasons.<br/>
<a id='20'>
<h2>Smoke tests</h2>
</a>
A battery of tests designed to shake out any obvious issues is incorporated in the <a href="#test">Example application</a>. Install it and run as prescribed - all tests run and display results in web browser. Typically each test will show <span style="color:blue">OKAY</span> if succeeded, or otherwise describe what is the desired outcome.<br/>
<a id='21'>
<h1>Getting started</h1>
</a>
<a id='22'>
<h2>Configuration, database and debug files</h2>
</a>
These files direct Cloudgizer in some important aspects. Note that these are setup by <span style="color:blue">cldgoapp</span> script based on your <span style="color:blue">appinfo</span> file. <span style="color:blue">cldgoapp</span> script installs a Cloudgizer application. Your own <span style="color:blue">create.sh</span> script (a customizable part of installation) can further change these files.<br/>
<a id='23'>
<h3>Configuration file</h3>
</a>
A configuration file (named <span style="color:blue">config</span>) in the application home directory typically has something similar to this<br/>
 <div class="codestyle">
 &nbsp; &nbsp;<span style="color:blue">version</span>=7<br/>
 &nbsp; &nbsp;<span style="color:blue">web_address</span>=http://192.168.0.11<br/>
 &nbsp; &nbsp;<span style="color:blue">email_address</span>="Hellocld" &lt;root@localhost&gt;<br/>
 &nbsp; &nbsp;<span style="color:blue">application_name</span>=Hellocld<br/>
 &nbsp; &nbsp;<span style="color:blue">max_upload_size</span>=10000000<br/>
 &nbsp; &nbsp;<span style="color:blue">mariadb_socket</span>=/var/lib/mysql/mysql.sock<br/>
 &nbsp; &nbsp;<span style="color:blue">ignore_mismatch</span>=no<br/>
 </div>
<span style="color:blue">version</span> determines the application version. Typically it is used in constructed URL to force refreshment of cached files, but it can be used for any other versioning purpose. <br/>
<span style="color:blue">web_address</span> contains the server address where the application runs on, and is a base URL for Cloudgizer requests. You can use http:// or https://. <br/>
<span style="color:blue">email_address</span> is the email where status emails would be sent (for example in case of a program crash) and it can be used for any other emailing purpose by the application. <br/>
<span style="color:blue">application_name</span> is the name of application - it can be any name that is 16 bytes or smaller, composed of alphanumeric characters and &nbsp;underscore, cannot start with a digit and cannot be 'deploy'. <br/>
<span style="color:blue">max_upload_size</span> is the maximum size of an upload file - uploading larger file will invoke predefined &nbsp;<span style="color:blue">file_too_large</span> function, implemented by you. <br/>
<span style="color:blue">mariadb_socket</span> is the database identification, a means to connect to the database. <br/>
<span style="color:blue">ignore_mismatch</span> is by default "no", meaning that if shared library used to build application doesn't match what's installed on deployment server, stop the program. If "yes", skip this check and proceed. Use "yes" with caution and only if you know why you're doing it.<br/>
<br/>
You can also define user parameters, which are always precedeed by _ (an underscore).<br/>
<br/>
You can use all of these parameters in your code, see <a href="#configuration_parameters">configuration parameters API</a>.<br/>
If you need to use a Cloudgizer application home directory (for example in a user parameter), use tilde (&#126;) sign, for example:<br/>
 <div class="codestyle">
_my_user_directory = &#126;/user_dir<br/>
 </div>
<a id='24'>
<h3>Database file</h3>
</a>
<span style="color:blue">.db</span> file is located in the application's home directory and it contains database login information. By default its permissions are set to 600 - do not change this. It has these four lines:<br/>
 <div class="codestyle">
 &nbsp; &nbsp;localhost<br/>
 &nbsp; &nbsp;your_app_name (i.e. the <span style="color:blue">CLD_APP_NAME</span> from <span style="color:blue">appinfo</span>, the database user name)<br/>
 &nbsp; &nbsp;app_db_password ( i.e. the password you chose, &nbsp;<span style="color:blue">CLD_DB_APP_PWD</span>)<br/>
 &nbsp; &nbsp;your_app_name (i.e. the name of the database created, which is the same as the database user name, which is <span style="color:blue">CLD_APP_NAME</span> in <span style="color:blue">appinfo</span>)<br/>
 </div>
<a id='25'>
<h3>Debug file</h3>
</a>
A debug file (named <span style="color:blue">debug</span> in <span style="color:blue">trace</span> directory) determines the application behavior with respect to debugging. Take a look at <a href="#debug_file">debug file options</a> for more details.<br/>
<a id='26'>
<h2>How to write code</h2>
</a>
<a id='27'>
<h3>Markup code block</h3>
</a>
Markup code block is written between <span style="color:blue">/*&lt;</span> and <span style="color:blue">&gt;*/</span>. It is a comment technically, but <span style="color:blue">cld</span> utility will parse it and generate C code for it. For example:<br/>
<div class="codestyle">
void my_func ()<br/>
{<br/>
 &nbsp; &nbsp;char *my_var = "hello";<br/>
<br/>
<span style="color:green"> &nbsp; &nbsp;// <br/></span>
<span style="color:green"> &nbsp; &nbsp;// The following comment-block is Cloudgizer code.<br/></span>
<span style="color:green"> &nbsp; &nbsp;// It is processed by <span style="color:blue">cld</span> command line tool to create C code.<br/></span>
<span style="color:green"> &nbsp; &nbsp;// In this case very simple text outputting.<br/></span>
<span style="color:green"> &nbsp; &nbsp;//<br/></span>
 &nbsp; &nbsp;<span style="color:blue">/*&lt;</span><br/>
 &nbsp; &nbsp;Any free text that's not a markup is output.<br/>
 &nbsp; &nbsp;&lt;hr/&gt;<br/>
 &nbsp; &nbsp;<span style="color:blue">print-web</span> my_var<br/>
 &nbsp; &nbsp;&lt;hr/&gt;<br/>
 &nbsp; &nbsp;<span style="color:blue">&gt;*/</span><br/>
}<br/>
</div>
In this example, the output of the program (meaning output to web browser) is:<br/>
<br/>
Any free text that's not a markup is output.
<hr/>
hello<br/>
<hr/>
<br/>
The actual C code generated by Cloudgizer for this will look like:<br/>
<div class="codestyle">
void my_func ()<br/>
{<br/>
 &nbsp; &nbsp;char *my_var = "hello";<br/>
<br/>
 &nbsp; &nbsp;<span style="color:blue">cld_printf</span> (<span style="color:blue">CLD_NOENC</span>, "Any free text that's not a markup is output.");<br/>
 &nbsp; &nbsp;<span style="color:blue">cld_printf</span> (<span style="color:blue">CLD_NOENC</span>, "&lt;hr/&gt;\n");<br/>
 &nbsp; &nbsp;<span style="color:blue">cld_printf</span> (<span style="color:blue">CLD_NOENC</span>, "%s", my_var);<br/>
 &nbsp; &nbsp;<span style="color:blue">cld_printf</span> (<span style="color:blue">CLD_NOENC</span>, "&lt;hr/&gt;\n");<br/>
}<br/>
</div>
So you can write the web output by simply writing the HTML code (or any other code, such as Javascript, or anything else that works for you). In this documentation, we'll talk about "HTML code" for simplicity, but when we say "HTML code" it means <b>any kind</b> of web code.<br/>
<br/>
Anything else that is not HTML code, you will use markups such as <span style="color:blue">print-web</span> to output variables, <span style="color:blue">run-query#</span> to run database queries, <span style="color:blue">input-param</span> to get URL GET/POST input parameters etc.<br/>
<br/>
If <span style="color:blue">/*&lt;</span> and <span style="color:blue">&gt;*/</span> are not feasible, you can use <span style="color:blue">/*CLD_BEGIN</span> and <span style="color:blue">CLD_END*/</span> as markup boundaries.<br/>
<br/>
The markup beginning (i.e. <span style="color:blue">/*&lt;</span>) must be the beginning of the line and markup ending (i.e. <span style="color:blue">&gt;*/</span>) must be the ending of the line.<br/>
<a id='28'>
<h3>Markup usage</h3>
</a>
<br/>
The markup (such as <span style="color:blue">print-web</span>) can be used in-between <span style="color:blue">&lt;?</span> and <span style="color:blue">?&gt;</span> or without them in most cases, but not all. For example:<br/>
<div class="codestyle">
<span style="color:blue">print-web</span> my_var<br/>
</div>
is just fine on a single line. But if you want to combine it with other output on the same line, as in:<br/>
<div class="codestyle">
This is variable <span style="color:blue">&lt;?print-web</span> my_var<span style="color:blue">?&gt;</span><br/>
</div>
then you must write the markup within <span style="color:blue">&lt;?</span> and <span style="color:blue">?&gt;</span>. You can also always use these brackets if you prefer - if you are starting with Cloudgizer, it may help you catch errors sooner. Consider if you wrote:<br/>
<div class="codestyle">
<span style="color:blue">printa-web</span> my_var<br/>
</div>
In this case, <span style="color:blue">printa-web</span> is not a valid markup, even though you intended it to be. The output from this will be:<br/>
<br/>
printa-web my_var<br/>
<br/>
i.e. the literal output of what you wrote. &nbsp;But if you wrote:<br/>
<div class="codestyle">
<span style="color:blue">&lt;?printa-web</span> my_var<span style="color:blue">?&gt;</span><br/>
</div>
you would get an error. One might say that seeing your code in the output is a good enough way to find the error in fix it, but using markup will detect an error earlier - however the code might look a little less verbose. &nbsp;<br/>
<a id='29'>
<h3>Line continuation and whitespaces</h3>
</a>
<br/>
To continue a line of code over several lines, use a backslash (<span style="color:blue">\</span>). It can be used anywhere on the line, including in the middle of a string. Example:<br/>
<div class="codestyle">
<span style="color:blue">run-query#</span>my_query <span style="color:blue">=</span> "select name \<br/>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;from employee \<br/>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;where name like '%'"<br/>
</div>
is the same as:<br/>
<div class="codestyle">
<span style="color:blue">run-query#</span>my_query <span style="color:blue">=</span> "select name from employee where name like '%'"<br/>
</div>
Use only spaces as separators in markup code, i.e. do not use tabs and other whitespaces. A line may begin and end with tabs but do not use tabs within markup code itself.<br/>
<a id='30'>
<h3>A typical program</h3>
</a>
<br/>
Example application provided with installation provides a good starting point. You can take it and grow it into your application, it is meant to be used that way.<br/>
<br/>
Generally, you will get a request via <span style="color:blue">cld_handle_request</span> function. You implement this function (example is provided), and based on some input parameter (typically a page name specified in a URL), you'd call other functions. Most of these other functions would be implemented in their own separate files, thus typically each page would have its own implementation file.<br/>
<br/>
These other functions are conceptually just like Hello World example. They usually query database and do some work for you. They may write files, read files, process data, generate HTML output, show images and documents and anything else you need. <br/>
<br/>
You will notice that you generally shouldn't free the memory you allocate - it will be safely freed at the end of a request. Most of the time you won't need to allocate any memory at all, and that's a good thing. The markups chosen are what's usually needed. If something isn't there, you can use the API provided. If that's not enough, write your own C code for it - you can do just about anything in C.<br/>
<br/>
If you allocate memory on your own <b>always</b> use Cloudgizer memory allocation API such as <span style="color:blue">cld_malloc</span> for example, since all memory allocated this way is automatically released at the end of the request.<br/>
<a id='31'>
<h3>Errors in your program</h3>
</a>
<br/>
Cloudgizer tries to find as many errors in your program as possible. This also means uncovering some errors that might otherwise find their way into run-time. For example, all your non-dynamic SQL (which hopefully is all the SQL you'd ever use) is checked at run-time with the database, so for example syntax errors and using columns that do not exist are likely to be caught at compile time. Cloudgizer will try to figure out if you forgot to use <span style="color:blue">c</span> markup for the C code within the markup, which can cause code not to execute (and instead display) if you've forgotten it. <br/>
<br/>
The code compiled by C compiler is generated from your original <span style="color:blue">.v</span> file. The error reporting from the C compiler (gcc) will show line numbers from your original code, not the generated code, sparing you the hunt for the actual line in <span style="color:blue">.v</span> file that caused an error. <br/>
<br/>
At run-time, you'll have a number of facilities available for debugging, which is <a href="#debugging_and_tracing">explained here</a> in this documentation. You can learn how to use gdb to debug your program, how to check the validity of your generated XHTML at run-time, how to use tracing etc.
<a id='32'>
<h2>CLD utility</h2>
</a>
<br/>
<span style="color:blue">cld</span> utility translates your .v file into .c file which is then compiled and linked with your program. If you type cld at the command line, you will get this help:<br/>
<br/>
 &nbsp; &nbsp;Name<br/>
 &nbsp; &nbsp;<br/>
 &nbsp; &nbsp;Cloudgizer code generator, markup language and application server API, version [1.2]<br/>
 &nbsp; &nbsp;<br/>
 &nbsp; &nbsp;Description<br/>
 &nbsp; &nbsp;<br/>
 &nbsp; &nbsp;Cloudgizer is a tool for building Web applications in C that run as modules on Apache web server on RedHat/Centos. It supports mariaDB database by using LGPL mariaDB client that enables connectivity to mariaDB database. Each application runs under the same Apache web server user, under its own directory (i.e. application's home directory).<br/>
 &nbsp; &nbsp;<br/>
 &nbsp; &nbsp;Synopsis<br/>
 &nbsp; &nbsp;<br/>
 &nbsp; &nbsp;cld [&lt;input-file-name.v&gt;] [&lt;command-line-options&gt;]<br/>
 &nbsp; &nbsp;<br/>
 &nbsp; &nbsp;Options<br/>
 &nbsp; &nbsp;<br/>
 &nbsp; &nbsp;-help<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;Display this help.<br/>
 &nbsp; &nbsp;<br/>
 &nbsp; &nbsp;-out &lt;output-file-name.c&gt;<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;Write generated code to output file &lt;output-file-name.c&gt;. If this option is not used, generated code is written to stdout (standard output).<br/>
 &nbsp; &nbsp;<br/>
 &nbsp; &nbsp;-main<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;Generate main C code. This option cannot be used when &lt;input-file-name.c&gt; is specified, i.e. either C code is generated for input-file-name.c or the main() function C code is generated.<br/>
 &nbsp; &nbsp;<br/>
 &nbsp; &nbsp;-cmd<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;Generate C code for use as a standalone program (a command line program), rather than as an Apache module (Apache Mod) program which is the default. This option can only be used together with -main.<br/>
 &nbsp; &nbsp;<br/>
 &nbsp; &nbsp;-mariasock &lt;socket-file-location&gt;<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;Specify the location of the mariaDB socket file, used by the database server (socket option in my.cnf).<br/>
 &nbsp; &nbsp;<br/>
 &nbsp; &nbsp;-v<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;Print out verbose information about what is being done.<br/>
 &nbsp; &nbsp;<br/>
 &nbsp; &nbsp;-urlencode &lt;string&gt;<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;Prints URL encoded &lt;string&gt;.<br/>
 &nbsp; &nbsp;<br/>
 &nbsp; &nbsp;-webencode &lt;string&gt;<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;Prints web encoded &lt;string&gt;.<br/>
 &nbsp; &nbsp;<br/>
<br/>
 &nbsp; &nbsp;COPYRIGHT AND LICENSE<br/>
 &nbsp; &nbsp;<br/>
 &nbsp; &nbsp;Copyright (c) 2017 Zigguro LLC (on the Web at https://zigguro.org/cloudgizer).<br/>
 &nbsp; &nbsp;Cloudgizer is free Open Source Software licensed under Apache License 2. Cloudgizer is "AS IS" without warranties or guarantees of any kind.<br/>
<br/>
<a id='33'>
<h1>Processing of requests</h1>
</a>
<br/>
The <span style="color:blue">cld_handle_request</span> function (the "request processor") is called from generated code to handle incoming requests and it must be implemented. The Example application already has an implementation.<br/>
<br/>
A simple implementation may look like:<br/>
<div class="codestyle">
void <span style="color:blue">cld_handle_request</span>()<br/>
{<br/>
 &nbsp; &nbsp;<span style="color:blue">/*&lt;</span><br/>
 &nbsp; &nbsp;<span style="color:blue">input-param</span> page<br/>
 &nbsp; &nbsp;<br/>
 &nbsp; &nbsp;<span style="color:blue">if-string</span> page="home"<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">c</span> home ();<br/>
 &nbsp; &nbsp;<span style="color:blue">else-if-string</span> page="other"<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">c</span> other ();<br/>
 &nbsp; &nbsp;<span style="color:blue">else</span><br/>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">report-error</span> "Unrecognized page %s", page<br/>
 &nbsp; &nbsp;<span style="color:blue">end-if</span><br/>
 &nbsp; &nbsp;<span style="color:blue">&gt;*/</span><br/>
}<br/>
</div>
<br/>
The request processor function is called both for web requests (through Apache module mechanism), or for command line program execution. You can use any input parameters to differentiate input requests ('page' is used here as an example only).<br/>
<br/>
Typically file <span style="color:blue">cld_handle_request.v</span> is created to hold the request processor code.<br/>
<a id='34'>
<h1>Constructs</h1>
</a>
<br/>
The markups are always within <span style="color:blue">/*&lt; &nbsp;... &gt;*/</span> - that's a markup block. They are parsed by <span style="color:blue">cld</span> utility and C code is produced where comment was before. You will see that you can also have pure C code within <span style="color:blue">/*&lt; ... &gt;*/</span>, so while <span style="color:blue">/*&lt; ... &gt;*/</span> is within a C code already, you can have C code again within it. It's useful because it's easier to write code this way - sometimes you'll need to have small snippets of C code (such as function calls or small blocks of code) to augment your markups.<br/>
<a id='35'>
<h2>Comments</h2>
</a>
<br/>
There are a few ways to comment your code while in a markup block.<br/>
<br/>
Use either:<br/>
<ul><li><span style="color:blue">start-comment</span> / <span style="color:blue">end-comment</span>:<br/>
<div class="codestyle">
<span style="color:blue">start-comment</span><br/>
This is a comment.<br/>
<span style="color:blue">end-comment</span><br/>
</div>
In this case, both <span style="color:blue">start-comment</span> and <span style="color:blue">end-comment</span> must be alone on a line.<br/>
<br/>
</li> <li>Line comment: <br/>
<div class="codestyle">
<span style="color:blue">//</span> This is a comment<br/>
</div>
The comment must take the entire line.<br/>
</li></ul><br/>
<a id='36'>
<h2>Outputting data</h2>
</a>
<a id='37'>
<h3>Whitespaces and empty lines</h3>
</a>
<ul><li>Whitespaces are not output for programming markups that do not output anything. For example:<br/>
<div class="codestyle">
&lt;hr/&gt;<br/>
<span style="color:blue">define-string</span> my_str<br/>
&lt;hr/&gt;<br/>
</div>
will output<br/>
<br/>
&lt;hr/&gt;<br/>
&lt;hr/&gt;<br/>
<br/>
There is no empty line in place of <span style="color:blue">define-string</span> my_str, because this markup does not output anything.<br/>
<br/>
</li> <li>However if a line has output in addition:<br/>
<div class="codestyle">
&lt;hr/&gt;<br/>
<span style="color:blue">&lt;?</span><span style="color:blue">define-string</span> my_str<span style="color:blue">?&gt;</span>Hi<br/>
&lt;hr/&gt;<br/>
</div>
or <br/>
<div class="codestyle">
&lt;hr/&gt;<br/>
<span style="color:blue">&lt;?</span><span style="color:blue">define-string</span> my_str<span style="color:blue">?&gt;</span><span style="color:blue">&lt;?print-web</span> "Hi\n"<span style="color:blue">?&gt;</span><br/>
&lt;hr/&gt;<br/>
</div>
will output<br/>
<br/>
&lt;hr/&gt;<br/>
Hi<br/>
&lt;hr/&gt;<br/>
<br/>
</li> <li>The outputting markups do so precisely, i.e. if there is no specific new line, it won't be output:<br/>
<div class="codestyle">
&lt;hr/&gt;<br/>
<span style="color:blue">&lt;?</span><span style="color:blue">define-string</span> my_str<span style="color:blue">?&gt;</span><span style="color:blue">&lt;?print-web</span> "Hi"<span style="color:blue">?&gt;</span><br/>
&lt;hr/&gt;<br/>
</div>
will output:<br/>
<br/>
&lt;hr/&gt;<br/>
Hi&lt;hr/&gt;<br/>
<br/>
</li> <li>Empty lines are not output. This makes it easier to write readable programs. Comment lines are not output, as you'd expect. </li></ul><br/>
<a id='38'>
<h3>Semicolon</h3>
</a>
<br/>
If semicolon is the last outputted character on the line, it must be escaped:<br/>
<div class="codestyle">
Hello world<span style="color:blue">&lt;?</span>;<span style="color:blue">?&gt;</span><br/>
</div>
This is because any line that ends with semicolon is expected to be C code.<br/>
<br/>
If you have lots of semicolons (for example in Javascript code), you can use <span style="color:blue">start-verbatim</span>/<span style="color:blue">end-verbatim</span> markups, in which case nothing in the output (including semicolon) is interpreted.<br/>
<a id='39'>
<h3>Encoding output</h3>
</a>
<br/>
You can output data without any encoding, by web encoding or URL encoding:<br/>
<ul> <li>No encoding (<span style="color:blue">print-noenc</span>), the data is ready to be output as-is:<br/>
<div class="codestyle">
<span style="color:blue">define-string</span> my_string="Hello world!&lt;hr/&gt;"<br/>
<span style="color:blue">print-noenc</span> my_string<br/>
</div>
The output is:<br/>
<br/>
Hello world!
<hr/>
<br/>
</li> <li>Any data that is free floating, i.e. that is not a part of a command is output as not encoded (<span style="color:blue">print-noenc</span>), for example:<br/>
<div class="codestyle">
This is the non-encoded output&lt;br/&gt;<br/>
&lt;hr/&gt;<br/>
</div>
is the same as:<br/>
<div class="codestyle">
<span style="color:blue">print-noenc</span> "This is the non-encoded output&lt;br/&gt;"<br/>
<span style="color:blue">print-noenc</span> "&lt;hr/&gt;"<br/>
</div>
</li> <li>Web encoding, the data may contain characters such as &lt; or &gt;:<br/>
<div class="codestyle">
<span style="color:blue">define-string</span> my_string="Hello &lt;world&gt;!"<br/>
<span style="color:blue">print-web</span> my_string<br/>
&lt;hr/&gt;<br/>
</div>
The output is:<br/>
<br/>
Hello &lt;world&gt;!<br/>
<hr/>
<br/>
</li> <li>URL encoding, the data is used in URL strings, such as links or images:<br/>
<div class="codestyle">
<span style="color:blue">define-string</span> my_url_data="="<br/>
&lt;a href="https://my_web_site.com/go.your_app_name?param1=<span style="color:blue">&lt;?</span><span style="color:blue">print-url</span> "&amp;"<span style="color:blue">?&gt;</span>&amp;amp;param2=<span style="color:blue">&lt;?</span><span style="color:blue">print-url</span> my_url_data<span style="color:blue">?&gt;</span>" &gt;<br/>
</div>
The output is:<br/>
<br/>
&lt;a href="https://my_web_site.com/go.your_app_name?param1=%26&amp;param2=%3D" &gt;</li></ul><br/>
<a id='40'>
<h3>Ignoring markup</h3>
</a>
<br/>
Common outputting of HTML code is just to write it without any markup, as in this code:<br/>
<div class="codestyle">
Hello&lt;hr/&gt;<br/>
This is HTML&lt;br/&gt;<br/>
</div>
will produce:<br/>
<br/>
Hello<hr/>
This is HTML<br/>
<br/>
If your output happens to coincide with a markup, such as for example, if it begins with <span style="color:blue">if</span>, then you could either output with a <span style="color:blue">print-web</span> (for example):<br/>
<div class="codestyle">
<span style="color:blue">print-web</span> "if here won't be treated as if markup"<br/>
</div>
or use <span style="color:blue">w</span> markup, which does nothing, but it positions whatever comes next as not being the first on the line, which precludes it from being interpreted as markup, for example:<br/>
<div class="codestyle">
<span style="color:blue">w</span> if here won't be treated as if markup<br/>
</div>
resulting in output:<br/>
<br/>
if here won't be treated as if markup<br/>
<br/>
If you have a large segment of text such as JavaScript that you just want to output to web page without worrying about any Cloudgizer markups being interpreted, or about trailing semicolons, use <span style="color:blue">start-verbatim</span> and <span style="color:blue">end-verbatim</span>:<br/>
<div class="codestyle">
<span style="color:blue">start-verbatim</span><br/>
if here won't be treated as if markup&lt;br/&gt;<br/>
for here won't be treated as for markup&lt;br/&gt;<br/>
<span style="color:blue">end-verbatim</span><br/>
</div>
resulting in output:<br/>
<br/>
if here won't be treated as if markup<br/>
for here won't be treated as for markup<br/>
<br/>
When <span style="color:blue">start-verbatim</span> is used, anything up to <span style="color:blue">end-verbatim</span> is output as if with <span style="color:blue">print-noenc</span>.<br/>
<a id='41'>
<h3>Outputting preprocessor data to a file</h3>
</a>
Use <span style="color:blue">preprocessor-output#</span> to output data during processing of source code files. For example:<br/>
<div class="codestyle">
<span style="color:blue">preprocessor-output#</span>indexes employee:name<br/>
<span style="color:blue">run-query#</span>my_query="select name, extract(year from dateOfHire) yearOfHire from employee where name='John'"<br/>
<span style="color:blue">end-query</span><br/>
</div>
This will write to 'indexes<span style="color:blue">.clo</span>' file the line after the file name, in this case 'employee:name'. Such output can be used to determine what indexes are needed on each table used. In general any information can be added to any file. The purpose is to help with static analysis of code as in aforementioned example.<br/>
<a id='42'>
<h3>Outputting HTTP header for a typical web page</h3>
</a>
<br/>
Before outputting any text to a web page, HTTP headers need to be sent out:<br/>
<div class="codestyle">
<span style="color:blue">output-http-header</span><br/>
<span style="color:blue">print-web</span> "Hello world"<br/>
&lt;hr/&gt;<br/>
</div>
The header will contain any cookies that are present, meaning that had been received from the client, added and have not been deleted. Because this is the dynamic output from the program, the client is instructed not to cache.<br/>
<br/>
If you want to send custom headers (for instance change content type, caching, status or any other options), you can use <a href="#header">custom header API</a>.<br/>
<a id='43'>
<h3>Defining, setting and outputting integers</h3>
</a>
Integers can be used via following markups:<br/>
<div class="codestyle">
<span style="color:green">// define integer with default value of 0<br/></span>
<span style="color:blue">define-int</span> new_int<br/>
<br/>
<span style="color:blue">set-int</span> new_int=10<br/>
<br/>
<span style="color:green">// define and set the value of integer with any expression<br/></span>
<span style="color:blue">define-int</span> my_int=4*new_int<br/>
<br/>
<span style="color:blue">set-int</span> my_int=my_int+10<br/>
</div>
To output an integer:<br/>
<div class="codestyle">
<span style="color:blue">print-int</span> my_int<br/>
</div>
To output a long:<br/>
<div class="codestyle">
<span style="color:blue">print-long</span> my_long<br/>
</div>
<a id='44'>
<h3>Outputting data from a command line program</h3>
</a>
To output to standard output, use:<br/>
<div class="codestyle">
<span style="color:blue">print-out</span> "Today is a good %s", "day"<br/>
</div>
To output to standard error, use:<br/>
<div class="codestyle">
<span style="color:blue">print-error</span> "Today is a good %s", "day"<br/>
</div>
These constructs can be used only from a command line program. The syntax of the format and the data output is the same as for C printf() function.<br/>
<a id='45'>
<h2>Embedded C code</h2>
</a>
Use either:<br/>
<br/>
<ul><li><span style="color:blue">c</span> markup:<br/>
<div class="codestyle">
<span style="color:blue">c</span> int x=1;<br/>
</div>
or<br/>
</li> <li><span style="color:blue">start-c</span> markup: <br/>
<div class="codestyle">
<span style="color:blue">start-c</span><br/>
int x = 1;<br/>
x++;<br/>
<span style="color:blue">end-c</span><br/>
</div>
</li></ul><br/>
<br/>
With <span style="color:blue">c</span>, only one line of C code can be written that accompanies <span style="color:blue">c</span>.<br/>
With <span style="color:blue">start-c...end-c</span>, multiple lines of C code can be written. This C code is NOT placed in curly braces.<br/>
<a id='46'>
<h2>URL input parameters (GET and POST)</h2>
</a>
Input parameters from an incoming request are obtained by using <span style="color:blue">input-param</span>:<br/>
<div class="codestyle">
<span style="color:blue">input-param</span> par1<br/>
<span style="color:blue">input-param</span> par2<br/>
<br/>
Input parameter par1 has value<br/>
<span style="color:blue">print-web</span> par1<br/>
, and input parameter par2 has value<br/>
<span style="color:blue">print-web</span> par2<br/>
</div>
This will create two string variables par1 and par2 and store input parameters par1 and par2 into them, respectively. For example, if URL that led here was:<br/>
<div class="codestyle">
https://mywebsite.com/go.your_app_name?par1=value1&amp;par2=value2<br/>
</div>
then string variable par1 will have value "value1" and par2 will have value "value2", and the output from the above code is:<br/>
<br/>
Input parameter par1 has value value1, and input parameter par2 has value value2<br/>
<br/>
<span style="color:blue">input-param</span> works the same for both GET and POST requests. Input parameters are trimmed for whitespace (both on left and right).<br/>
<br/>
Input parameter name can be made up of alphanumeric characters or underscore only and cannot start with a digit.<br/>
<a id='47'>
<h2>Cookies, setting and getting</h2>
</a>
<ul><li>Cookies can be obtained from an incoming request by using <span style="color:blue">get-cookie</span>:<br/>
<div class="codestyle">
<span style="color:blue">define-string</span> my_cookie_value<br/>
<br/>
<span style="color:blue">get-cookie</span> my_cookie_value<span style="color:blue">=</span>"my_cookie_name"<br/>
</div>
or to define the cookie value string within the markup:<br/>
<div class="codestyle">
<span style="color:blue">get-cookie</span> <span style="color:blue">define</span> my_cookie_value<span style="color:blue">=</span>"my_cookie_name"<br/>
</div>
If an incoming request had a cookie from the browser named "my_cookie_name", then the value of that cookie will be stored in string variable my_cookie_value.<br/>
<br/>
</li> <li> To set a cookie that will go with the reply (back to browser), use:<br/>
<div class="codestyle">
<span style="color:blue">set-cookie</span> "my_cookie_name"<span style="color:blue">=</span>my_cookie_value <span style="color:blue">expires</span> time_of_expiration <span style="color:blue">path</span> "/"<br/>
</div>
When setting a cookie, you specify cookie name, its value, time of expiration and its path. You must set a cookie before outputting the HTTP header, such as in <span style="color:blue">output-http-header</span>, or otherwise it won't be set.<br/>
<br/>
</li> <li>To delete a cookie, so it is sent back in the reply telling the browser to delete it, use <span style="color:blue">delete-cookie</span>:<br/>
<div class="codestyle">
<span style="color:blue">delete-cookie</span> "my_cookie_name"<br/>
</div>
This also must be done before outputting the HTTP header, such as in <span style="color:blue">output-http-header</span>, or otherwise it won't be deleted.<br/>
</ul><br/>
Use <span style="color:blue">cld_time</span> API function to produce time suitable for cookies.<br/>
<a id='48'>
<h2>Database queries</h2>
</a>
<br/>
You can SELECT, INSERT, UPDATE or DELETE database table, retrieve results, check for errors. You can not perform any other SQL statements with markups, for example DDL statements - if you want that, <a href="#ddl">use the API</a>.<br/> 
<br/>
You can connect to a single database, specified in <span style="color:blue">.db</span> file. <br/>
<br/>
Writing queries, especially when many queries have common text, is supported with additional features such as query fragments and query shards.<br/>
<a id='49'>
<h3>Basic usage of queries</h3>
</a>
<br/>
<ul><li> Execute a query:<br/>
<div class="codestyle">
<span style="color:blue">run-query#</span>my_query="select name, extract(year from dateOfHire) yearOfHire from employee"<br/>
<span style="color:blue">end-query</span><br/>
</div>
Note that all query column names must be unique. In this case column names are 'name' and 'yearOfHire'. Duplicate column names will cause a Cloudgizer error.<br/>
<br/>
</li> <li> To output results from a query:<br/>
<div class="codestyle">
<span style="color:blue">run-query#</span>my_query="select name, extract(year from dateOfHire) yearOfHire from employee"<br/>
 &nbsp; &nbsp;<span style="color:blue">query-result#</span>my_query<span style="color:blue">,</span> name<br/>
 &nbsp; &nbsp;,<br/>
 &nbsp; &nbsp;<span style="color:blue">query-result#</span>my_query<span style="color:blue">,</span> yearOfHire<br/>
 &nbsp; &nbsp;&lt;br/&gt;<br/>
<span style="color:blue">end-query</span><br/>
</div>
This produces output:<br/>
<br/>
Linda,2001<br/>
John,2003<br/>
<br/>
</li> <li> To get column data into string variables: <br/>
<div class="codestyle">
<span style="color:blue">run-query#</span>my_query="select name, extract(year from dateOfHire) yearOfHire from employee"<br/>
 &nbsp; &nbsp;<span style="color:blue">query-result#</span>my_query<span style="color:blue">,</span> name <span style="color:blue">as define</span> name<br/>
 &nbsp; &nbsp;<span style="color:blue">define-string</span> year_of_hire<br/>
 &nbsp; &nbsp;<span style="color:blue">query-result#</span>my_query<span style="color:blue">,</span> yearOfHire <span style="color:blue">as</span> year_of_hire<br/>
 &nbsp; &nbsp;<span style="color:blue">print-web</span> name<br/>
 &nbsp; &nbsp;,<br/>
 &nbsp; &nbsp;<span style="color:blue">print-web</span> year_of_hire<br/>
 &nbsp; &nbsp;&lt;br/&gt;<br/>
<span style="color:blue">end-query</span><br/>
</div>
This produces the same output as the previous example, the only difference is that we get column values into string variables first. Variable can be defined on the spot using <span style="color:blue">as define</span> &nbsp;in <span style="color:blue">query-result</span>, or by defining string first via <span style="color:blue">define-string</span> and then using <span style="color:blue">as</span> to store column value in it.<br/>
<br/>
</li> <li> To create a table output:<br/>
<div class="codestyle">
&lt;table style='border:1px solid black'&gt;<br/>
<span style="color:blue">run-query#</span>my_query="select name, extract(year from dateOfHire) yearOfHire from employee"<br/>
 &nbsp; &nbsp;&lt;tr&gt;<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;td style='border:1px solid black'&gt;<br/>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">query-result#</span>my_query<span style="color:blue">,</span> name<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;/td&gt;<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;td style='border:1px solid black'&gt;<br/>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">query-result#</span>my_query<span style="color:blue">,</span> yearOfHire<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;/td&gt;<br/>
 &nbsp; &nbsp;&lt;/tr&gt;<br/>
<span style="color:blue">end-query</span><br/>
&lt;/table&gt;<br/>
</div>
This produces output:<br/>
<br/>
<table style='border:1px solid black'><tr><td style='border:1px solid black'>Linda</td><td style='border:1px solid black'>2001</td></tr><tr><td style='border:1px solid black'>John</td><td style='border:1px solid black'>2003</td></tr></table>
</li></ul><br/>
<span style="color:blue">query-result#</span> can be used with <span style="color:blue">noencode</span> (no encoding), <span style="color:blue">urlencode</span> (URL encoding) or <span style="color:blue">webencode</span> (web encoding), depending on where it used. For example, if it is used in construction of a &lt;a href ..&gt; link in the list of parameters, <span style="color:blue">urlencode</span> should be used. Default is <span style="color:blue">webencode</span>. These can be combined with <span style="color:blue">define</span> to store the value into it.<br/>
<div class="codestyle">
<span style="color:blue">query-result#</span>my_query<span style="color:blue">,</span>name <span style="color:blue">define</span> my_var <span style="color:blue">urlencode</span><br/>
</div>
This will URL encode value of column 'name', then create string variable my_var and store the value into the string variable.<br/>
<a id='50'>
<h3>Database transactions</h3>
</a>
<ul><li> Start transaction, execute DML, COMMIT transaction:<br/>
<div class="codestyle">
<span style="color:blue">begin-transaction</span><br/>
<span style="color:blue">run-query#</span>my_query="insert into employee (name, dateOfHire) values ('Terry', now())"<br/>
<span style="color:blue">end-query</span><br/>
<span style="color:blue">commit-transaction</span><br/>
</div>
</li> <li> Start transaction, execute DML, ROLLBACK transaction:<br/>
<div class="codestyle">
<span style="color:blue">begin-transaction</span><br/>
<span style="color:blue">run-query#</span>my_query="insert into employee (name, dateOfHire) values ('Terry', now())"<br/>
<span style="color:blue">end-query</span><br/>
<span style="color:blue">rollback-transaction</span><br/>
</div>
</li></ul><br/>
Once you start transaction with <span style="color:blue">begin-transaction</span>, you must either commit it with <span style="color:blue">commit-transaction</span> or rollback with <span style="color:blue">rollback-transaction</span>. If you do neither, your transaction will be rolled back once control is passed out of your request handler. Opening a transaction and leaving without committing or a rollback is a bug in your program. &nbsp;If you want to catch this kind of situation and possibly either commit or rollback, use <span style="color:blue">cld_check_transaction()</span> API function (possibly within a function dispatcher in <span style="color:blue">cld_handle_request()</span>, after the request handling), where you can detect this and either rollback, commit, or error out.<br/>
<a id='51'>
<h3>Column Length</h3>
</a>
<br/>
To output column length for a column in a table:<br/>
<div class="codestyle">
&lt;input name="my_column" type="text" value="" size="30" maxlength="<span style="color:blue">&lt;?</span><span style="color:blue">column-length</span> employee.name<span style="color:blue">?&gt;</span>"&gt;<br/>
<br/>
<span style="color:green">// To get column column length into a string variable:<br/></span>
<span style="color:blue">column-length</span> employee.name <span style="color:blue">as define</span> my_column_length<br/>
<span style="color:green">// Or define a string variable first:<br/></span>
<span style="color:blue">define-string</span> my_column_length<br/>
<span style="color:blue">column-length</span> employee.name <span style="color:blue">as</span> my_column_length<br/>
<br/>
&lt;input name="my_column" type="text" value="" size="30" maxlength="<span style="color:blue">&lt;?</span><span style="color:blue">print-web</span> my_column_length<span style="color:blue">?&gt;</span>"&gt;<br/>
</div>
The length obtained is the maximum number of characters in a column when it is output as a string. The supported database types for use in this markup are varchar, char and number types.<br/>
<a id='52'>
<h3>When query has no results</h3>
</a>
If your query returns no rows and you want still to get a single row made of empty strings for each column, use <span style="color:blue">use-no-result</span>:<br/>
<div class="codestyle">
<span style="color:blue">define-query#</span>my_query<br/>
<span style="color:blue">use-no-result#</span>my_query<br/>
<span style="color:blue">run-query#</span>my_query="select name, extract(year from dateOfHire) yearOfHire from employee where 1=2"<br/>
 &nbsp; &nbsp;<span style="color:blue">query-result#</span>my_query<span style="color:blue">,</span> name<br/>
 &nbsp; &nbsp;,<br/>
 &nbsp; &nbsp;<span style="color:blue">query-result#</span>my_query<span style="color:blue">,</span> yearOfHire<br/>
<span style="color:blue">end-query</span><br/>
</div>
This will produce output:<br/>
<br/>
,<br/>
<br/>
meaning empty name, then a comma, and then an empty year of hire.<br/>
<a id='53'>
<h3>Force query to produce a single empty row</h3>
</a>
Sometimes you may want to get a single row made of empty strings for each column, in which case use <span style="color:blue">create-empty-row</span>:<br/>
<div class="codestyle">
<span style="color:blue">define-query#</span>my_query<br/>
<span style="color:blue">create-empty-row#</span>my_query<br/>
<span style="color:blue">run-query#</span>my_query="select name, extract(year from dateOfHire) yearOfHire from employee"<br/>
 &nbsp; &nbsp;<span style="color:blue">query-result#</span>my_query<span style="color:blue">,</span> name<br/>
 &nbsp; &nbsp;,<br/>
 &nbsp; &nbsp;<span style="color:blue">query-result#</span>my_query<span style="color:blue">,</span> yearOfHire<br/>
<span style="color:blue">end-query</span><br/>
</div>
This will produce output:<br/>
<br/>
,<br/>
<br/>
meaning empty name, then a comma, and then an empty year of hire. Even though query would have produced some rows, you will still get a single empty row. The query is not actually executed to do this.<br/>
<br/>
You may want to use this to conditionally either execute the query, or just produce an empty row, for example:<br/>
<div class="codestyle">
...<br/>
<span style="color:blue">define-query#</span>my_query<br/>
<span style="color:blue">if</span> execute_query!=1<br/>
 &nbsp; &nbsp;<span style="color:blue">create-empty-row#</span>my_query<br/>
<span style="color:blue">end-if</span><br/>
<span style="color:blue">run-query#</span>my_query="select name, extract(year from dateOfHire) yearOfHire from employee"<br/>
 &nbsp; &nbsp;<span style="color:blue">query-result#</span>my_query<span style="color:blue">,</span> name<br/>
 &nbsp; &nbsp;,<br/>
 &nbsp; &nbsp;<span style="color:blue">query-result#</span>my_query<span style="color:blue">,</span> yearOfHire<br/>
<span style="color:blue">end-query</span><br/>
</div>
In this case, the same code is used to either show the data from the database or an empty row, such as if you wanted to present a blank form to be filled out.<br/>
<a id='54'>
<h3>Current row in a query result set</h3>
</a>
Use <span style="color:blue">current-row#</span> to get the current row number, starting with 1.<br/>
<div class="codestyle">
<span style="color:blue">run-query#</span>my_query="select name, extract(year from dateOfHire) yearOfHire from employee"<br/>
 &nbsp; &nbsp;Row #<span style="color:blue">&lt;?</span><span style="color:blue">current-row#</span>my_query<span style="color:blue">?&gt;</span>&lt;br/&gt;<br/>
 &nbsp; &nbsp;<span style="color:blue">query-result#</span>my_query<span style="color:blue">,</span> name<br/>
 &nbsp; &nbsp;,<br/>
 &nbsp; &nbsp;<span style="color:blue">query-result#</span>my_query<span style="color:blue">,</span> yearOfHire<br/>
 &nbsp; &nbsp;&lt;br/&gt;<br/>
<span style="color:blue">end-query</span><br/>
</div>
This produces output:<br/>
Row #1<br/>
Linda,2001<br/>
Row #2<br/>
John,2003<br/>
<br/>
You can also store current row in a string variable first:<br/>
<div class="codestyle">
<span style="color:blue">run-query#</span>my_query="select name, extract(year from dateOfHire) yearOfHire from employee"<br/>
<span style="color:green"> &nbsp; &nbsp;// You can define variable on the spot<br/></span>
 &nbsp; &nbsp;<span style="color:blue">current-row#</span>my_query <span style="color:blue">as define</span> curr_row<br/>
<span style="color:green"> &nbsp; &nbsp;// Or you can define it first:<br/></span>
 &nbsp; &nbsp;<span style="color:blue">define-string</span> curr_row<br/>
 &nbsp; &nbsp;<span style="color:blue">current-row#</span>my_query <span style="color:blue">as</span> curr_row<br/>
<br/>
 &nbsp; &nbsp;Row #<span style="color:blue">&lt;?</span><span style="color:blue">print-web</span> curr_row<span style="color:blue">?&gt;</span>&lt;br/&gt;<br/>
 &nbsp; &nbsp;<span style="color:blue">query-result#</span>my_query<span style="color:blue">,</span> name<br/>
 &nbsp; &nbsp;,<br/>
 &nbsp; &nbsp;<span style="color:blue">query-result#</span>my_query<span style="color:blue">,</span> yearOfHire<br/>
 &nbsp; &nbsp;&lt;br/&gt;<br/>
<span style="color:blue">end-query</span><br/>
</div>
The output produced is the same.<br/>
<a id='55'>
<h3>Number of rows and columns in a query result set</h3>
</a>
Use <span style="color:blue">row-count#</span> and <span style="color:blue">column-count#</span> to get the number of rows and columns returned by the query.<br/>
<div class="codestyle">
<span style="color:blue">run-query#</span>my_query="select name, extract(year from dateOfHire) yearOfHire from employee"<br/>
 &nbsp; &nbsp;Data is <span style="color:blue">&lt;?</span><span style="color:blue">query-result#</span>my_query<span style="color:blue">,</span> name<span style="color:blue">?&gt;</span>, <span style="color:blue">&lt;?</span><span style="color:blue">query-result#</span>my_query<span style="color:blue">,</span> yearOfHire<span style="color:blue">?&gt;</span> (row <span style="color:blue">&lt;?</span><span style="color:blue">current-row#</span>my_query<span style="color:blue">?&gt;</span> out of <span style="color:blue">&lt;?</span><span style="color:blue">row-count#</span>my_query<span style="color:blue">?&gt;</span> with <span style="color:blue">&lt;?column-count#</span>my_query<span style="color:blue">?&gt;</span> columns) &lt;br/&gt;<br/>
<span style="color:blue">end-query</span><br/>
Number of rows: <span style="color:blue">&lt;?</span><span style="color:blue">row-count#</span>my_query<span style="color:blue">?&gt;</span>&lt;br/&gt;<br/>
Number of columns: <span style="color:blue">&lt;?</span><span style="color:blue">column-count#</span>my_query<span style="color:blue">?&gt;</span>&lt;br/&gt;<br/>
</div>
This produces output:<br/>
Data is Linda, 2001 (row 1 out of 2 with 2 columns)<br/>
Data is John, 2003 (row 2 out of 2 with 2 columns)<br/>
Number of rows: 2<br/>
Number of columns: 2<br/>
<br/>
You can also store number of rows and columns in a string variable:<br/>
<div class="codestyle">
<span style="color:blue">run-query#</span>my_query="select name, extract(year from dateOfHire) yearOfHire from employee"<br/>
<span style="color:blue">end-query</span><br/>
<span style="color:green">// Define variable on the spot<br/></span>
<span style="color:blue">row-count#</span>my_query <span style="color:blue">as define</span> row_count<br/>
<span style="color:blue">column-count#</span>my_query <span style="color:blue">as define</span> col_count<br/>
<span style="color:green">// Or define a string variable first<br/></span>
<span style="color:blue">define-string</span> row_count<br/>
<span style="color:blue">define-string</span> col_count<br/>
<span style="color:blue">row-count#</span>my_query <span style="color:blue">as</span> row_count<br/>
<span style="color:blue">column-count#</span>my_query <span style="color:blue">as</span> col_count<br/>
<br/>
<span style="color:blue">if</span> atol(row_count)!=2<br/>
 &nbsp; &nbsp;&lt;div&gt;Number of rows is not 2, but rather it is <span style="color:blue">&lt;?</span><span style="color:blue">print-web</span> row_count<span style="color:blue">?&gt;</span>!&lt;/div&gt;<br/>
<span style="color:blue">end-if</span><br/>
</div>
If number of rows in the table is 3, the following output is produced:<br/>
<br/>
Number of rows is not 2, but rather it is 3!<br/>
<br/>
Note that <span style="color:blue">row-count</span> and <span style="color:blue">column-count</span> can be used within <span style="color:blue">run-query</span> loop and also right outside of it as well.<br/>
<a id='56'>
<h3>Number of affected rows in DML</h3>
</a>
Use <span style="color:blue">query-result#</span>query_name<span style="color:blue">,affected_rows</span> to get the number of rows affected in INSERT, UPDATE or DELETE.<br/>
<div class="codestyle">
<span style="color:blue">run-query#</span>my_query="insert into employee (name, dateOfHire) values ('Terry', now())"<br/>
 &nbsp; &nbsp;Number of rows inserted is <span style="color:blue">&lt;?query-result#</span>my_query<span style="color:blue">,affected_rows?&gt;</span><br/>
<span style="color:green"> &nbsp; &nbsp;// You can also get number of rows into a string variable<br/></span>
 &nbsp; &nbsp;<span style="color:blue">query-result#</span>my_query<span style="color:blue">,affected_rows as define</span> nrows<br/>
 &nbsp; &nbsp;<span style="color:blue">if-string</span> nrows<span style="color:blue">!=</span>"1"<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">report-error</span> "Cannot insert data!"<br/>
 &nbsp; &nbsp;<span style="color:blue">end-if</span><br/>
<span style="color:blue">end-query</span><br/>
</div>
In the above example, we check the number of rows affected (in this case inserted). Consult database manual for more information about number of rows affected - it may not always be what you'd expect.<br/>
<a id='57'>
<h3>Input parameters to queries</h3>
</a>
<br/>
Query input parameters are specified via <span style="color:blue">&lt;?</span>...<span style="color:blue">?&gt;</span> markup. Do not confuse <b>query</b> input parameters (data used in SQL statements) with <b>web</b> input parameters (which are name/value pairs from input URL specified with <span style="color:blue">input-param</span>).<br/>
<div class="codestyle">
<span style="color:blue">input-param</span> employee_name<br/>
<span style="color:blue">input-param</span> year_of_hire<br/>
<br/>
<span style="color:blue">run-query#</span>my_query="insert into employee (name, yearOfHire) values (<span style="color:blue">&lt;?</span>employee_name<span style="color:blue">?&gt;</span>, <span style="color:blue">&lt;?</span>year_of_hire<span style="color:blue">?&gt;</span>)"<br/>
 &nbsp; &nbsp;New employee ID is <span style="color:blue">&lt;?query-result#</span>my_query,<span style="color:blue">insert_id</span><span style="color:blue">?&gt;</span><br/>
<span style="color:blue">end-query</span><br/>
</div>
In the above example, <b>web</b> input parameters employee_name and year_of_hire (specified in the URL such as yourserver/go.your_application?employee_name=...&amp;year_of_hire=...) are used as <b>query</b> input parameters in INSERT statements.<br/>
<br/>
Query input parameters are always strings (i.e. char*) by type and can be any C expression, for example:<br/>
<div class="codestyle">
<span style="color:blue">run-query#</span>my_query="insert into employee (name, yearOfHire) values (<span style="color:blue">&lt;?</span>by_employee==1 ? entity_name : employee_name<span style="color:blue">?&gt;</span>, <span style="color:blue">&lt;?</span>calculateYearOfHire() + 1<span style="color:blue">?&gt;</span>)"<br/>
</div>
In the above example, both employee name and year of hire are results of C expressions.<br/>
<br/>
Another example:<br/>
<div class="codestyle">
<span style="color:blue">run-query#</span>my_query="select yearOfHire from employee where name=<span style="color:blue">&lt;?</span>employee_name<span style="color:blue">?&gt;</span>"<br/>
 &nbsp; &nbsp;<span style="color:blue">query-result#</span>my_query,yearOfHire <span style="color:blue">as define</span> year_of_hire<br/>
 &nbsp; &nbsp;Employee found, hired in year: <span style="color:blue">&lt;?</span><span style="color:blue">print-web</span> year_of_hire<span style="color:blue">?&gt;</span><br/>
<span style="color:blue">end-query</span><br/>
</div>
Query input parameters are sanitized against SQL injection attacks, and they are also trimmed on both left and right if <span style="color:blue">trim-query-input</span> is in effect. <br/>
<br/>
To trim all query input parameters, use:<br/>
<div class="codestyle">
<span style="color:blue">trim-query-input</span><br/>
</div>
To not trim, use:<br/>
<div class="codestyle">
<span style="color:blue">no-trim-query-input</span><br/>
</div>
Any query occurring at run-time after either markup will be under its effect. By default, all query input parameters are not trimmed.<br/>
<a id='58'>
<h3>Column names</h3>
</a>
You can obtain the names of query columns by using <span style="color:blue">column-names#</span> markup:<br/>
<div class="codestyle">
<span style="color:blue">run-query#</span>some_query="select * from employee"<br/>
 &nbsp; &nbsp;<span style="color:blue">column-count#</span>some_query <span style="color:blue">as define</span> col_count<br/>
 &nbsp; &nbsp;<span style="color:blue">column-names#</span>some_query <span style="color:blue">as define</span> col_names<br/>
 &nbsp; &nbsp;<span style="color:blue">define-int</span> i<br/>
 &nbsp; &nbsp;<span style="color:blue">for</span> i = 0; i &lt; atoi(col_count); i++<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;Column #<span style="color:blue">&lt;?print-web</span> i<span style="color:blue">?&gt;</span> has name <span style="color:blue">&lt;?print-web</span> col_names[i]<span style="color:blue">?&gt;</span>) <br/>
 &nbsp; &nbsp;<span style="color:blue">end-for</span><br/>
<span style="color:blue">end-query</span><br/>
</div>
Note that <span style="color:blue">column-names#</span> means the names of query columns, which may or may not match any actual table column names, since query outputs can have aliases (and they should have them if the output is computed). In the following example, the output will be 'employeeFirstName' and 'employeeLastName' as they are aliases:<br/>
<div class="codestyle">
<span style="color:blue">run-query#</span>some_query="select firstName employeeFirstName, lastName employeeLastName from employee"<br/>
 &nbsp; &nbsp;<span style="color:blue">column-names#</span>some_query <span style="color:blue">as define</span> col_names<br/>
 &nbsp; &nbsp; Column names are <span style="color:blue">&lt;?print-web</span> col_names[0]<span style="color:blue">?&gt;</span> &nbsp;and <span style="color:blue">&lt;?print-web</span> col_names[1]<span style="color:blue">?&gt;</span><br/>
 &nbsp; &nbsp;<span style="color:blue">end-for</span><br/>
<span style="color:blue">end-query</span><br/>
</div>
<span style="color:blue">column-names#</span> must have <span style="color:blue">as</span> clause. In the above example, the variable 'col_names' is defined automatically, but you can also define it yourself and omit the <span style="color:blue">define</span> clause:<br/>
<div class="codestyle">
c char **col_names;<br/>
<span style="color:blue">column-names#</span>some_query <span style="color:blue">as</span> col_names<br/>
</div>
Note that <span style="color:blue">column-names</span> can be used within a query loop (like we did above, such as within <span style="color:blue">run-query</span>/<span style="color:blue">end-query</span> for example), or just outside of it.<br/>
<a id='59'>
<h3>Nesting queries</h3>
</a>
<br/>
Queries can be nested, for example:<br/>
<div class="codestyle">
<span style="color:blue">run-query#</span>query1="select id from user"<br/>
 &nbsp; &nbsp;<span style="color:blue">query-result#</span>query1,id <span style="color:blue">as define</span> id<br/>
 &nbsp; &nbsp;<span style="color:blue">run-query#</span>query2="select timeout from settings where id=<span style="color:blue">&lt;?</span>id<span style="color:blue">?&gt;</span>"<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">query-result#</span>query2,timeout<br/>
 &nbsp; &nbsp;<span style="color:blue">end-query</span><br/>
<span style="color:blue">end-query</span><br/>
</div>
In this example, query2 is nested within query1, using its results. Note that <span style="color:blue">query-result#</span> for a query can be used only directly within a query loop, and not within another query's loop. For instance, <span style="color:blue">query-result#</span>query1,id cannot be used within a query loop for query2. This restriction is solely in place to prevent errors that are hard to track, such as having same column names under different queries. It is always possible to use query results directly within the loop, and is a better programming practice.<br/>
<a id='60'>
<h3>Using multiple query texts at run-time (conditional queries)</h3>
</a>
A query can have different text depending on run-time conditions. The text of the query is still static though:<br/>
<div class="codestyle">
<span style="color:blue">input-param</span> my_name_filter<br/>
<span style="color:blue">input-param</span> my_action<br/>
<br/>
<br/>
<span style="color:blue">define-query#</span>my_query<br/>
<br/>
<span style="color:green">// depending on a run-time conditional, start two different queries<br/></span>
<span style="color:blue">if-string</span> my_action="show_all_records"<br/>
 &nbsp; &nbsp;<span style="color:blue">start-query#</span>my_query="select name, extract(year from dateOfHire) yearOfHire from employee"<br/>
<span style="color:blue">else</span><br/>
 &nbsp; &nbsp;<span style="color:blue">start-query#</span>my_query="select name, extract(year from dateOfHire) yearOfHire from employee where name like concat(<span style="color:blue">&lt;?</span>my_name_filter<span style="color:blue">?&gt;</span>,'%')"<br/>
<span style="color:blue">end-if</span><br/>
<br/>
<span style="color:green">// loop through a query, regardless of which one we will execute in <span style="color:blue">loop-query</span><br/></span>
<span style="color:blue">loop-query#</span>my_query<br/>
 &nbsp; &nbsp;Name is <span style="color:blue">&lt;?</span><span style="color:blue">query-result#</span>my_query<span style="color:blue">,</span> name<span style="color:blue">?&gt;</span>, year of hire is <span style="color:blue">&lt;?</span><span style="color:blue">query-result#</span>my_query<span style="color:blue">,</span> yearOfHire<span style="color:blue">?&gt;</span>&lt;br/&gt;<br/>
<span style="color:blue">end-query</span><br/>
</div>
If the input parameter for my_action is 'show_all_records' (for example URL is https://mysite.com/<span style="color:blue">go.your_app_name</span>?my_action=show_all_records), the output is:<br/>
<br/>
Name is Linda, year of hire is 2001<br/>
Name is John, year of hire is 2003<br/>
<br/>
If the input parameter for my_action is empty and input parameter for my_name_filter is 'L' (for example URL is https://mysite.com/<span style="color:blue">go.your_app_name</span>?my_name_filter=L), the output is:<br/>
<br/>
Name is Linda, year of hire is 2001<br/>
<br/>
For conditional queries with the same name, even though the query texts (the SQL texts) can be different and they can have different input parameters, they must have the same output, because the results sets of all such query texts are used in a single <span style="color:blue">loop-query</span> loop. For example, in the above conditional query my_query, one query text has no input parameters, and the other one has a single input parameter. However, both &nbsp;texts have the exact same output ('name' and 'yearOfHire').<br/>
<a id='61'>
<h3>Dynamic queries</h3>
</a>
A dynamic query has text that is not known at compile time, i.e. it is produced at run-time. Dynamic query cannot be checked at compile time. Dynamic query should be used rarely and only when absolutely necessary. The following is an example and would be normally written as a conditional query.<br/>
<div class="codestyle">
<span style="color:green">// Get input parameters<br/></span>
<span style="color:blue">input-param</span> employee_name<br/>
<span style="color:blue">input-param</span> employee_year<br/>
<br/>
<span style="color:green">// The base query that's present either way<br/></span>
<span style="color:blue">define-string</span> query_text="select name, extract(year from dateOfHire) from employee where dateOfHire&gt;<span style="color:blue">'%s'</span>-01-01 0:0:0' "<br/>
<br/>
<span style="color:green">// State that dynamic query comes from string variable query_text and specify what are output column names<br/></span>
<span style="color:blue">define-dynamic-query#</span>my_query=query_text <span style="color:blue">with-output</span> name, yearOfHire<br/>
<br/>
<span style="color:green">// Query text that's added to the base query if employee_name is specified<br/></span>
<span style="color:blue">define-string</span> where_clause=" and name=<span style="color:blue">'%s'</span>"<br/>
<br/>
<span style="color:green">// Construct the query text at run-time. Add appropriate parameters.<br/></span>
<span style="color:blue">if-string</span> employee_name!=""<br/>
 &nbsp; &nbsp;<span style="color:blue">append-string</span> where_clause <span style="color:blue">to</span> query_text<br/>
<span style="color:green"> &nbsp; &nbsp;// We have two input parameters in this case<br/></span>
 &nbsp; &nbsp;<span style="color:blue">add-query-input#</span>my_query: employee_year, employee_name<br/>
else<br/>
<span style="color:green"> &nbsp; &nbsp;// We have one input parameter in this case<br/></span>
 &nbsp; &nbsp;<span style="color:blue">add-query-input#</span>my_query: employee_year<br/>
<span style="color:blue">end-if</span><br/>
<br/>
<span style="color:green">// Execute query. Only at this point do we actually use the dynamic text of the query.<br/></span>
<span style="color:blue">run-query#</span>my_query<br/>
 &nbsp; &nbsp;Employee <span style="color:blue">&lt;?</span><span style="color:blue">query-result#</span>my_query<span style="color:blue">,</span> name<span style="color:blue">?&gt;</span> was hired in year <span style="color:blue">&lt;?</span><span style="color:blue">query-result#</span>my_query<span style="color:blue">,</span>yearOfHire<span style="color:blue">?&gt;</span>&lt;br/&gt;<br/>
<span style="color:blue">end-query</span><br/>
</div>
The text of query is a variable query_text. This variable is constructed at run-time based on whether input parameter employee_name is provided or not. Clause <span style="color:blue">with-output</span> is used to specify what are the names of output columns - their order and names must match the query's output columns. <br/>
<br/>
Since the query is dynamic, the query's input variables are not known and must be specified. Input variable is specified with <span style="color:blue">'%s'</span>. The actual input variables are provided in <span style="color:blue">add-query-input#</span> clause. <br/>
<br/>
If the input parameter for employee_name is Linda (for example URL is https://mysite.com/<span style="color:blue">go.your_app_name</span>?employee_year=1990&amp;employee_name=Linda), the output is:<br/>
<br/>
Employee Linda was hired in year 2001<br/>
<br/>
If the input parameter for employee_name is empty (for example URL is https://mysite.com/<span style="color:blue">go.your_app_name</span>?employee_year=1990&amp;employee_name= &nbsp; or just &nbsp; &nbsp;https://mysite.com/<span style="color:blue">go.your_app_name</span>?employee_year=1990), the output is:<br/>
<br/>
Employee Linda was hired in year 2001<br/>
Employee John was hired in year 2003<br/>
<a id='62'>
<h3>Dynamic queries when table structure is unknown</h3>
</a>
<br/>
In some cases, you would not know the output columns of a dynamic query. For example, a dynamic query could be constructed in form of 'SELECT * from ...'. In general it may be beneficial in certain situations to obtain query results even if you don't know (or is cumbersome to obtain) the query output columns. In these cases you can use <span style="color:blue">with-unknown-output</span> markup, as in this example:<br/>
<div class="codestyle">
<span style="color:green">// Get all tables from current database<br/></span>
<span style="color:blue">run-query#</span>all_tabs="select table_name from information_schema.tables where table_schema=database()"<br/>
 &nbsp; &nbsp;<span style="color:blue">query-result#</span>all_tabs, table_name <span style="color:blue">as define</span> table_name<br/>
<br/>
<span style="color:green"> &nbsp; &nbsp;// Construct the run-time text of a dynamic query<br/></span>
 &nbsp; &nbsp;<span style="color:blue">write-string</span> <span style="color:blue">define</span> qry_txt <br/>
 &nbsp; &nbsp;select * from <span style="color:blue">&lt;?print-noenc</span> table_name<span style="color:blue">?&gt;</span><br/>
 &nbsp; &nbsp;<span style="color:blue">end-write-string</span><br/>
<br/>
<span style="color:green"> &nbsp; &nbsp;// Define dynamic query to be the text above and specify that we don't know column names<br/></span>
 &nbsp; &nbsp;<span style="color:blue">define-dynamic-query#</span>get_tab = qry_txt <span style="color:blue">with-unknown-output</span><br/>
<br/>
<span style="color:green"> &nbsp; &nbsp;// Run query<br/></span>
 &nbsp; &nbsp;<span style="color:blue">run-query#</span>get_tab<br/>
 &nbsp; &nbsp;<span style="color:blue">end-query</span><br/>
<br/>
<span style="color:green"> &nbsp; &nbsp;// Get some table metadata and also the actual table data<br/></span>
 &nbsp; &nbsp;<span style="color:blue">row-count#</span>get_tab <span style="color:blue">as define</span> row_count<br/>
 &nbsp; &nbsp;<span style="color:blue">column-count#</span>get_tab <span style="color:blue">as define</span> col_count<br/>
 &nbsp; &nbsp;<span style="color:blue">column-names#</span>get_tab </span>as define</span> col_names<br/>
 &nbsp; &nbsp;<span style="color:blue">column-data#</span>get_tab <span style="color:blue">as define</span> col_data<br/>
<br/>
<span style="color:green"> &nbsp; &nbsp;// Display data<br/></span>
 &nbsp; &nbsp;<span style="color:blue">define-int</span> i<br/>
 &nbsp; &nbsp;<span style="color:blue">define-int</span> j<br/>
 &nbsp; &nbsp;<span style="color:blue">for</span> j = 0; j &lt;atol(row_count); j++<br/>
<span style="color:green"> &nbsp; &nbsp; &nbsp; &nbsp;// Display columns for each row<br/></span>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">for</span> i = 0; i &lt;atol(col_count); i++<br/>
<span style="color:green"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Show column names and column data (which is a flat array that spans all column and all rows)<br/></span>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">print-out</span> "colname %s, coldata %s\n", col_names[i], col_data[j*atol(col_count)+i]<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">end-for</span><br/>
 &nbsp; &nbsp;<span style="color:blue">end-for</span><br/>
<span style="color:blue">end-query</span><br/>
</div>
In this example, we don't know table names (or their columns) because we get the list of tables from the current database. Query text is constructed on the fly and we define dynamic query <span style="color:blue">with-unknown-output</span> because we don't know the output column names. After running the query we obtain the number of rows (<span style="color:blue">row-count#</span>), the number of columns (<span style="color:blue">column-count#</span>), the output column names (<span style="color:blue">column-names#</span>) and the actual data (<span style="color:blue">column-data#</span>).<br/>
<br/>
The example above is typical for applications that export data or move it around while massaging the data in some ways. <br/>
<a id='63'>
<h3>Result-set data array</h3>
</a>
<br/>
Normally you'd obtain query results using <span style="color:blue">query-result#</span> as in:<br/>
<div class="codestyle">
<span style="color:blue">run-query#</span>some_query="select firstName, lastName from employee"<br/>
 &nbsp; &nbsp;<span style="color:blue">query-result#</span>some_query, firstName <span style="color:blue">as define</span> first_name<br/>
 &nbsp; &nbsp;<span style="color:blue">query-result#</span>some_query, lastName <span style="color:blue">as define</span> last_name<br/>
 &nbsp; &nbsp;Employee (<br/>
 &nbsp; &nbsp;<span style="color:blue">print-web</span> first_name<br/>
 &nbsp; &nbsp;,<br/>
 &nbsp; &nbsp;<span style="color:blue">print-web</span> last_name<br/>
 &nbsp; &nbsp;) found&lt;br/&gt;<br/>
<span style="color:blue">end-query</span><br/>
</div>
In some cases, it may be better to not refer to result data set in this fashion, meaning by column name. For instance, in a dynamic query you may not know the table name, nor column names. In these cases, you can use <span style="color:blue">column-data#</span> markup:<br/>
<div class="codestyle">
void get_table_data (const char *table_name)<br/>
{<br/>
 &nbsp; &nbsp;<span style="color:blue">/*&lt;</span><br/>
<span style="color:green"> &nbsp; &nbsp;//<br/></span>
<span style="color:green"> &nbsp; &nbsp;// Construct the run-time text of dynamic SQL<br/></span>
<span style="color:green"> &nbsp; &nbsp;//<br/></span>
 &nbsp; &nbsp;<span style="color:blue">write-string</span> <span style="color:blue">define</span> qry_txt <br/>
 &nbsp; &nbsp;select * from <span style="color:blue">&lt;?print-noenc</span> table_name<span style="color:blue">?&gt;</span><br/>
 &nbsp; &nbsp;<span style="color:blue">end-write-string</span><br/>
<br/>
<span style="color:green"> &nbsp; &nbsp;//<br/></span>
<span style="color:green"> &nbsp; &nbsp;// Connect dynamic query with the run-time text of SQL<br/></span>
<span style="color:green"> &nbsp; &nbsp;// We use <span style="color:blue">with-unknown-output</span> to demonstrate a solution if we don't know<br/></span>
<span style="color:green"> &nbsp; &nbsp;// (or is difficult) to obtain output columns of a query<br/></span>
<span style="color:green"> &nbsp; &nbsp;//<br/></span>
 &nbsp; &nbsp;<span style="color:blue">define-dynamic-query#</span>get_tab = qry_txt <span style="color:blue">with-unknown-output</span><br/>
<br/>
<span style="color:green"> &nbsp; &nbsp;//<br/></span>
<span style="color:green"> &nbsp; &nbsp;// Run the dynamic query<br/></span>
<span style="color:green"> &nbsp; &nbsp;//<br/></span>
 &nbsp; &nbsp;<span style="color:blue">run-query#</span>get_tab<br/>
 &nbsp; &nbsp;<span style="color:blue">end-query</span><br/>
<br/>
<span style="color:green"> &nbsp; &nbsp;//<br/></span>
<span style="color:green"> &nbsp; &nbsp;// Obtain number of rows, number of columns, column names, the actual column data<br/></span>
<span style="color:green"> &nbsp; &nbsp;//<br/></span>
 &nbsp; &nbsp;<span style="color:blue">row-count#</span>get_tab <span style="color:blue">as define</span> row_count<br/>
 &nbsp; &nbsp;<span style="color:blue">column-count#</span>get_tab <span style="color:blue">as define</span> col_count<br/>
 &nbsp; &nbsp;<span style="color:blue">column-names#</span>get_tab </span>as define</span> col_names<br/>
<br/>
<span style="color:green"> &nbsp; &nbsp;//<br/></span>
<span style="color:green"> &nbsp; &nbsp;// Get actual table data<br/></span>
<span style="color:green"> &nbsp; &nbsp;//<br/></span>
 &nbsp; &nbsp;<span style="color:blue">column-data#</span>get_tab <span style="color:blue">as define</span> col_data<br/>
<br/>
 &nbsp; &nbsp;<br/>
<span style="color:green"> &nbsp; &nbsp;//<br/></span>
<span style="color:green"> &nbsp; &nbsp;// In a loop, go through all rows, and for each row, display all column info as well<br/></span>
<span style="color:green"> &nbsp; &nbsp;// as the actual column data from the table.<br/></span>
<span style="color:green"> &nbsp; &nbsp;//<br/></span>
 &nbsp; &nbsp;<span style="color:blue">define-int</span> i<br/>
 &nbsp; &nbsp;<span style="color:blue">define-int</span> j<br/>
 &nbsp; &nbsp;<span style="color:blue">for</span> j = 0; j &lt;atol(row_count); j++<br/>
<span style="color:green"> &nbsp; &nbsp; &nbsp; &nbsp;// <br/></span>
<span style="color:green"> &nbsp; &nbsp; &nbsp; &nbsp;// Display columns for each row<br/></span>
<span style="color:green"> &nbsp; &nbsp; &nbsp; &nbsp;//<br/></span>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">for</span> i = 0; i &lt;atol(col_count); i++<br/>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">print-out</span> "colname %s, coldata %s\n", col_names[i], col_data[j*atol(col_count)+i]<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">end-for</span><br/>
 &nbsp; &nbsp;<span style="color:blue">end-for</span><br/>
 &nbsp; &nbsp;<span style="color:blue">&gt;*/</span><br/>
}<br/>
</div>
In the above, a C function get_table_data prints out (to stdout) a list of columns, and a column value (note that this would have to be a command-line program since that's where we'd use <span style="color:blue">print-out</span>).<br/>
<br/>
<span style="color:blue">column-data</span> lets us obtain all table's data in a <span style="color:blue">char**</span>, i.e. in an array of strings, where all table's data is laid out in a single data array, organized by repeating rows. For instance, suppose that table name in our example has 2 columns. In that case, col_data[0] and col_data[1] would be the two columns' values from the first row, col_data[2] and col_data[3] would be the two columns' values from the second row, col_data[4] and col_data[5] would be the the columns' values from the third row etc.<br/>
<br/>
<span style="color:blue">column-data#</span> must be used with <span style="color:blue">as</span> - in other words a suitable <span style="color:blue">char**</span> variable must be provided, either defined with <span style="color:blue">as define</span> or provided as in:<br/>
<div class="codestyle">
c char **col_data;<br/>
<span style="color:blue">column-data#</span>get_tab <span style="color:blue">as</span> col_data<br/>
</div>
<a id='64'>
<h3>Using query results more than once</h3>
</a>
<br/>
A query result set can be looped through again:<br/>
<div class="codestyle">
<span style="color:blue">run-query#</span>my_query="select name, extract(year from dateOfHire) yearOfHire from employee"<br/>
 &nbsp; &nbsp;<span style="color:blue">query-result#</span>my_query<span style="color:blue">,</span> name &lt;br/&gt;<br/>
<span style="color:blue">end-query</span><br/>
<br/>
<span style="color:blue">loop-query#</span>my_query<br/>
 &nbsp; &nbsp;Again: <span style="color:blue">query-result#</span>my_query<span style="color:blue">,</span> name &lt;br/&gt;<br/>
<span style="color:blue">end-query</span><br/>
</div>
<br/>
<span style="color:blue">loop-query#</span> will go through the entire result set again, producing this output:<br/>
<br/>
Linda<br/>
John<br/>
Linda<br/>
John<br/>
<br/>
Note that <span style="color:blue">loop-query#</span> does not execute a query again, but rather only uses the already obtained results.<br/>
<a id='65'>
<h3>Copying query text in multiple places safely (query shards)</h3>
</a>
<br/>
<ul><li>To copy a query text segment in multiple places, use query shards:<br/>
<div class="codestyle">
<span style="color:blue">input-param</span> find_name<br/>
<br/>
<span style="color:blue">define-shard#</span>my_shard<br/>
<br/>
<span style="color:blue">define-query#</span>my_query<br/>
<br/>
<span style="color:blue">if-string</span> find_name=""<br/>
 &nbsp; &nbsp;<span style="color:blue">start-query#</span>my_query="<span style="color:blue">&lt;?</span><span style="color:blue">shard#</span>my_shard<span style="color:blue">?&gt;</span>select name, extract(year from dateOfHire) yearOfHire from employee <span style="color:blue">&lt;?</span><span style="color:blue">end-shard</span><span style="color:blue">?&gt;</span>"<br/>
<span style="color:blue">else</span><br/>
 &nbsp; &nbsp;<span style="color:blue">start-query#</span>my_query="<span style="color:blue">&lt;?</span><span style="color:blue">shard#</span>my_shard<span style="color:blue">?&gt;</span>select name, extract(year from dateOfHire) yearOfHire from employee <span style="color:blue">&lt;?</span><span style="color:blue">end-shard</span><span style="color:blue">?&gt;</span> where name=<span style="color:blue">&lt;?</span>find_name<span style="color:blue">?&gt;</span>"<br/>
<span style="color:blue">end-if</span><br/>
</div>
If you change the text between <span style="color:blue">shard#</span> and <span style="color:blue">end-shard</span> tags in any one shard, and you forget to do so in others, you will get an error. Shards allow safe replication of query segments. Shards make it easy to not use dynamic queries which have serious drawbacks. Query text segment is easiest to read within a query itself - and the text of a query is known at compile time, allowing for a compile time check.<br/>
<br/>
</li> <li>If your query has input parameters in a shard, you can enforce shard equality with <span style="color:blue">define-soft-shard#</span>:<br/>
<div class="codestyle">
<span style="color:blue">define-soft-shard#</span>my_shard<br/>
<br/>
<span style="color:blue">run-query#</span>my_query="<span style="color:blue">&lt;?</span><span style="color:blue">shard#</span>my_shard<span style="color:blue">?&gt;</span>select name, extract(year from dateOfHire) yearOfHire from employee where name=<span style="color:blue">&lt;?</span><span style="color:red">variable_one</span><span style="color:blue">?&gt;</span><span style="color:blue">&lt;?</span><span style="color:blue">end-shard</span><span style="color:blue">?&gt;</span>"<br/>
<br/>
...<br/>
<br/>
<span style="color:blue">run-query#</span>my_query="<span style="color:blue">&lt;?</span><span style="color:blue">shard#</span>my_shard<span style="color:blue">?&gt;</span>select name, extract(year from dateOfHire) yearOfHire from employee where name=<span style="color:blue">&lt;?</span><span style="color:red">variable_two</span><span style="color:blue">?&gt;</span><span style="color:blue">&lt;?</span><span style="color:blue">end-shard</span><span style="color:blue">?&gt;</span> <br/>
</div>
In this case, the literal texts of shards are not compared. Rather, shard texts without input parameters are compared. <br/>
<br/>
</li> <li>Shards can be nested, i.e. shard within a shard, up to 5 levels can be specified, for instance:<br/>
<div class="codestyle">
 &nbsp; &nbsp;<span style="color:blue">define-shard#</span>my_shard<br/>
 &nbsp; &nbsp;<span style="color:blue">define-shard#</span>another_shard<br/>
<br/>
 &nbsp; &nbsp;<span style="color:blue">start-query#</span>my_query="<span style="color:blue">&lt;?</span><span style="color:blue">shard#</span>my_shard<span style="color:blue">?&gt;</span>select name, extract(year from dateOfHire) yearOfHire from employee <span style="color:blue">&lt;?</span><span style="color:blue">shard#</span>another_shard<span style="color:blue">?&gt;</span>where name=<span style="color:blue">&lt;?</span>find_name<span style="color:blue">?&gt;</span><span style="color:blue">&lt;?</span><span style="color:blue">end-shard</span><span style="color:blue">?&gt;</span> order by name<span style="color:blue">&lt;?</span><span style="color:blue">end-shard</span><span style="color:blue">?&gt;</span>"<br/>
</div>
 &nbsp; &nbsp;Shards nested within other shards can be used as such, or as standalone queries. For example, a nested shard can be a SELECT subquery that can be used as a standalone query elsewhere in the application.<br/>
<br/>
</li> <li>Shards can be global, i.e. across multiple files. For that, create a file named <span style="color:blue">shard</span> with content like this:<br/>
<div class="codestyle">
<span style="color:blue">define-shard#</span>shard_name_one="select name from employee"<br/>
<span style="color:blue">define-shard#</span>shard_name_two="select name, extract(year from yearOfHire) from employee"<br/>
...<br/>
</div>
As long as shard file is in the current directory, you can use these shards as if they were defined in a file you use.</li></ul><br/>
<a id='66'>
<h3>Re-using query text in multiple places (query fragments)</h3>
</a>
<br/>
To reuse the text of query segment, use <span style="color:blue">query-fragment#</span>:<br/>
<div class="codestyle">
<span style="color:blue">input-param</span> find_name<br/>
<span style="color:blue">input-param</span> find_year<br/>
<br/>
<span style="color:blue">query-fragment#</span>my_fragment="select name, extract(year from dateOfHire) yearOfHire from employee "<br/>
<br/>
<span style="color:blue">if-string</span> find_name!=""<br/>
 &nbsp; &nbsp;<span style="color:blue">run-query#</span>my_query_one="<span style="color:blue">&lt;?</span><span style="color:blue">query-fragment#</span>my_fragment<span style="color:blue">?&gt;</span> where name=<span style="color:blue">&lt;?</span>find_name<span style="color:blue">?&gt;</span>"<br/>
<span style="color:blue">else-if-string</span> find_year!=""<br/>
 &nbsp; &nbsp;<span style="color:blue">run-query#</span>my_query_one="<span style="color:blue">&lt;?</span><span style="color:blue">query-fragment#</span>my_fragment<span style="color:blue">?&gt;</span> where dateOfHire &gt; '<span style="color:blue">&lt;?</span>find_year<span style="color:blue">?&gt;</span>-01-01 0:0:0' "<br/>
<span style="color:blue">end-if</span><br/>
</div>
Query fragment is a string constant that can be used within a query text. It is useful where shards are not practical, such as if a query fragment is too long, or used in too many places. Each query is still static because the text is known at compile time. A fragment can have other constructs in it, such as input parameters, other fragments or shards.<br/>
<a id='67'>
<h3>Loop control in result set</h3>
</a>
<br/>
When looping through the result set, you can use <span style="color:blue">continue-query</span> and <span style="color:blue">exit-query</span> to continue at the top of the loop or exit the loop, respectively:<br/>
<br/>
This will print only the first employee name:<br/>
<div class="codestyle">
<span style="color:blue">c</span> int i = 0;<br/>
<span style="color:blue">run-query#</span>my_query="select name, extract(year from dateOfHire) yearOfHire from employee"<br/>
 &nbsp; &nbsp;<span style="color:blue">query-result#</span>my_query<span style="color:blue">,</span> name<br/>
 &nbsp; &nbsp;<span style="color:blue">c</span> i++;<br/>
 &nbsp; &nbsp;<span style="color:blue">if</span> i&gt;0<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">exit-query</span><br/>
 &nbsp; &nbsp;<span style="color:blue">end-if</span><br/>
<span style="color:blue">end-query</span><br/>
</div>
This will skip the first employee name and print the rest:<br/>
<div class="codestyle">
<span style="color:blue">c</span> int i = 0;<br/>
<span style="color:blue">run-query#</span>my_query="select name, extract(year from dateOfHire) yearOfHire from employee"<br/>
 &nbsp; &nbsp;<span style="color:blue">c</span> i++;<br/>
 &nbsp; &nbsp;<span style="color:blue">if</span> i==1<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">continue-query</span><br/>
 &nbsp; &nbsp;<span style="color:blue">end-if</span><br/>
 &nbsp; &nbsp;<span style="color:blue">query-result#</span>my_query<span style="color:blue">,</span> name<br/>
<span style="color:blue">end-query</span><br/>
</div>
<a id='68'>
<h3>Error handling in executing queries</h3>
</a>
<br/>
For INSERT, DELETE and UPDATE statements, <span style="color:blue">error</span> value is available in the result set:<br/>
<div class="codestyle">
<span style="color:blue">run-query#</span>my_query="insert into employee (name, yearOfHire) values ('Terry', 2017)"<br/>
 &nbsp; &nbsp;<span style="color:blue">query-result#</span>my_query<span style="color:blue">,</span> <span style="color:blue">error</span> <span style="color:blue">as define</span> err<br/>
 &nbsp; &nbsp;<span style="color:blue">if</span> atol(err)!=0<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">report-error</span> "Error in adding employee, error %s", err<br/>
 &nbsp; &nbsp;<span style="color:blue">end-if</span><br/>
<span style="color:blue">end-query</span><br/>
</div>
SELECT statements must succeed (with or without results). If not, it is an irrecoverable error.<br/>
<a id='69'>
<h3>Getting auto_increment value</h3>
</a>
<br/>
To obtain auto_increment value after insert, use <span style="color:blue">insert_id</span> value:<br/>
<div class="codestyle">
<span style="color:blue">run-query#</span>my_query="insert into employee (name, yearOfHire) values ('Terry', 2017)"<br/>
 &nbsp; &nbsp;<span style="color:blue">query-result#</span>my_query<span style="color:blue">,</span> <span style="color:blue">insert_id</span> <span style="color:blue">as define</span> employee_id<br/>
 &nbsp; &nbsp;<span style="color:blue">if</span> atol(err)!=0<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">report-error</span> "Error in adding employee, error %s", err<br/>
 &nbsp; &nbsp;<span style="color:blue">end-if</span><br/>
 &nbsp; &nbsp;New employee added, with an ID of<br/>
 &nbsp; &nbsp;<span style="color:blue">print-web</span> employee_id<br/>
 &nbsp; &nbsp;&lt;br/&gt;<br/>
<span style="color:blue">end-query</span><br/>
</div>
Just like with most other markups, you can define the string as you're getting it, or use the string you already defined:<br/>
<div class="codestyle">
 &nbsp; &nbsp;<span style="color:blue">query-result#</span>my_query<span style="color:blue">,</span> <span style="color:blue">insert_id</span> <span style="color:blue">as define</span> employee_id<br/>
<br/>
<span style="color:green"> &nbsp; &nbsp;// or:<br/></span>
<br/>
 &nbsp; &nbsp;<span style="color:blue">define-string</span> employee_id<br/>
 &nbsp; &nbsp;<span style="color:blue">query-result#</span>my_query<span style="color:blue">,</span> <span style="color:blue">insert_id</span> <span style="color:blue">as</span> employee_id<br/>
</div>
<a id='70'>
<h3>NULL and result column data types</h3>
</a>
<br/>
All results from the database come as a string type (i.e. char*). NULL value is always an empty string (""). If you want to know if a value is NULL (versus an actual empty value), use a function such as ISNULL() in the database queries.<br/>
<a id='71'>
<h2>Executing Cloudgizer program from command line</h2>
</a>
See <a href="#execute">this chapter in API</a> on more information about building and executing Cloudgizer program from command line.
<a id='72'>
<h2>Executing external programs</h2>
</a>
For most use cases, use <span style="color:blue">exec-program</span>:<br/>
<div class="codestyle">
<span style="color:blue">define-int</span> st<br/>
<span style="color:blue">define-int</span> out_var_len=2000<br/>
<span style="color:blue">define-string</span> out_var<br/>
<span style="color:blue">define-string</span> program_path="/usr/bin/some_program"<br/>
<br/>
<span style="color:blue">exec-program</span> program_path <span style="color:blue">program-args</span> "-flag1", arg1, "-flag2" <span style="color:blue">program-status</span> st <span style="color:blue">program-output</span> out_var <span style="color:blue">program-output-length</span> out_var_len<br/>
</div>
This will execute program specified by program_path with arguments specified under <span style="color:blue">program-args</span>. Program arguments are separated by a comma. If a comma is a part of an argument, it must be escaped, as in \, and if double quote is a part of an argument it should be escaped as in \" as well.<br/>
<br/>
On return, the exit status will be st, and any output (stdout and stderr) will be in out_var. Note that out_var is allocated inside the execution function, and the length used to allocate it is out_var_len. <br/>
<br/>
If <span style="color:blue">program-output-length</span> is not specified, the out_var output variable is allocated with a default 256 bytes. Either way, any output in excess of what's available is truncated.<br/>
<br/>
You can also define the status of execution and the output buffer in the markup itself:<br/>
<div class="codestyle">
<span style="color:blue">exec-program</span> "/usr/bin/some_prog" <span style="color:blue">program-args</span> "-flag1", arg1, "-flag2" <span style="color:blue">program-status</span> <span style="color:blue">define</span> st <span style="color:blue">program-output</span> <span style="color:blue">define</span> out_var<br/>
</div>
If you want more complex use cases, such as redirecting file to stdin, and redirecting stdout/stderr to a file, or if you want to create a "pipe", i.e. execute two programs where output of one is the input of another use <a href="#program_execution_functions">program execution functions</a>.
<a id='73'>
<h2>Loading URL content (calling a web page) programmatically</h2>
</a>
Use <span style="color:blue">web-call</span> to get the result of loading the content of a URL via GET method:<br/>
<div class="codestyle">
<span style="color:blue">web-call</span> "https://mysite.com/any-url" <span style="color:blue">with-response</span> <span style="color:blue">define</span> webres <span style="color:blue">with-error</span> <span style="color:blue">define</span> weberr &nbsp;<span style="color:blue">with-cert</span> "/home/dasoftver/ca.crt" <span style="color:blue">cookie-jar</span> "/home/dasoftver/cookies"<br/>
</div>
A web response to a given URL is loaded into a string variable that is defined with a mandatory <span style="color:blue">with-response</span> clause. In this case variable webres is defined via <span style="color:blue">define</span> clause, but it could be defined prior to <span style="color:blue">web-call</span>. Other clauses are not mandatory. <span style="color:blue">with-error</span> specifies a string variable to hold an error text, if any. <span style="color:blue">with-cert</span> is used to specify the location of HTTPS certificate. You can also use <span style="color:blue">with-no-cert</span> if the certificate is not to be checked. <br/>
<br/>
<span style="color:blue">cookie-jar</span> specifies the location of a file holding cookies. Cookies are read from this file (which can be empty or non-existent to begin with) before making a web-call and any changes to cookies are reflected in this file after the call. This way, multiple calls to the same server maintain cookies the same way browser would do. Make sure the same <span style="color:blue">cookie-jar</span> file is not used across different application spaces. <br/>
<br/>
A simple use of <span style="color:blue">web-call</span>:<br/>
<div class="codestyle">
<span style="color:blue">define-string</span> webres<br/>
<span style="color:blue">web-call</span> "http://mysite.com/any-url" <span style="color:blue">with-response</span> webres<br/>
</div>
or without checking HTTPS certificate:<br/>
<div class="codestyle">
<span style="color:blue">define-string</span> weberr<br/>
<span style="color:blue">web-call</span> "https://mysite.com/any-url" <span style="color:blue">with-response</span> <span style="color:blue">define</span> webres <span style="color:blue">with-error</span> weberr &nbsp;<span style="color:blue">with-no-cert</span> <br/>
</div>
Response that redirects to another URL will be followed up to 4 times. The response is the body message, not the headers.<br/>
<br/>
This function does not return length of a response, because it is meant to be used as a text-based (i.e. null-terminated string based) messaging system. For uploading or downloading files, a more encapsulated method would be to use command-line utilities (such as curl or rcopy) via <a href="#program_execution_functions">program execution functions</a>.
<a id='74'>
<h2>Strings</h2>
</a>
<br/>
Strings are 'char *' variables that are allocated by Cloudgizer's memory allocation system. Typically you never free them. They are freed at the end of each request.<br/>
<br/>
If you are using any <span style="color:blue">cld_*</span> function that alters strings (i.e. as an output parameter) or in markup constructs that alter strings (such as <span style="color:blue">append-string</span> or <span style="color:blue">write-string</span>), then such strings <b>must</b> be defined using one of the following methods, or by means of API functions such as <span style="color:blue">cld_malloc</span>, <span style="color:blue">cld_calloc</span> or <span style="color:blue">cld_realloc</span>. Usage of other kinds of 'char *' variables will likely be detected by Cloudgizer and program halted.<br/>
<a id='75'>
<h3>Defining and copying strings</h3>
</a>
<ul><li>To define a string, use <span style="color:blue">define-string</span>:<br/>
<div class="codestyle">
<span style="color:green">// Initialize string to be empty ("")<br/></span>
<span style="color:blue">define-string</span> my_str<br/>
<br/>
<span style="color:green">// Initialize string to some expression<br/></span>
<span style="color:blue">define-string</span> my_str="some string expression"<br/>
</div>
</li> <li>To copy string from another string expression, use <span style="color:blue">copy-string</span>:<br/>
<div class="codestyle">
<span style="color:blue">define-string</span> my_str<br/>
<span style="color:blue">copy-string</span> my_str=other_string<br/>
</div>
When you copy into a string with <span style="color:blue">copy-string</span>, the string must have been defined with <span style="color:blue">define-string</span>.<br/>
<br/>
</li> <li>To convert an integer into a string and then copy:<br/>
<div class="codestyle">
<span style="color:blue">define-int</span> my_int=10<br/>
<span style="color:blue">define-string</span> my_str<br/>
<span style="color:blue">copy-string-from-int</span> my_str=my_int<br/>
</div>
</li></ul><br/>
You should not assign NULL value to a string. Use empty strings (as described above) instead.<br/>
<a id='76'>
<h3>Appending string</h3>
</a>
Use <span style="color:blue">append-string</span>:<br/>
<div class="codestyle">
<span style="color:blue">define-string</span> str1<span style="color:blue">=</span>"Hello "<br/>
<span style="color:blue">define-string</span> str2<span style="color:blue">=</span>"world!"<br/>
<br/>
<span style="color:blue">append-string</span> str2 <span style="color:blue">to</span> str1<br/>
<br/>
<span style="color:blue">print-web</span> str1<br/>
</div>
The output is:<br/>
<br/>
Hello world!<br/>
<a id='77'>
<h3>Search and replace string</h3>
</a>
Use <span style="color:blue">subst-string</span> and <span style="color:blue">subst-string-all</span>:<br/>
<div class="codestyle">
<span style="color:blue">define-string</span> my_str = "Have a good day and good night!"<br/>
<span style="color:blue">subst-string</span> "good" <span style="color:blue">with</span> "great" <span style="color:blue">in</span> my_str<br/>
<br/>
<span style="color:blue">print-web</span> my_str<br/>
</div>
In the above example, the very first occurance of 'good' is replaced with 'great', producing the output:<br/>
<br/>
Have a great day and good night!<br/>
<br/>
If you wish to replace all occurances, use <span style="color:blue">subst-string-all</span>:<br/>
<div class="codestyle">
<span style="color:blue">define-string</span> my_str = "Have a good day and good night!"<br/>
<span style="color:blue">subst-string-all</span> "good" <span style="color:blue">with</span> "great" <span style="color:blue">in</span> my_str<br/>
<br/>
<span style="color:blue">print-web</span> my_str<br/>
</div>
The above will produce the output:<br/>
<br/>
Have a great day and great night!<br/>
<br/>
The string where replacement takes place (in this case 'my_str') must have been defined with <span style="color:blue">define-string</span>.<br/>
<a id='78'>
<h3>Constructing complex strings</h3>
</a>
Instead of output being sent to the Web client, it can be directed into a string. &nbsp;Use <span style="color:blue">write-string</span> and <span style="color:blue">end-write-string</span> to do this:<br/>
<ul><li>A simple example:<br/>
<div class="codestyle">
<span style="color:blue">define-string</span> my_str<span style="color:blue">=</span>"world"<br/>
<span style="color:blue">define-string</span> my_str1<span style="color:blue">=</span>"and have a nice day too!"<br/>
<br/>
<span style="color:blue">write-string</span> <span style="color:blue">define</span> result_str<br/>
Hello <span style="color:blue">&lt;?</span><span style="color:blue">print-web</span> my_str<span style="color:blue">?&gt;</span> (<span style="color:blue">&lt;?</span><span style="color:blue">print-web</span> my_str1<span style="color:blue">?&gt;</span>)<br/>
<span style="color:blue">end-write-string</span><br/>
<br/>
<span style="color:blue">print-web</span> result_str<br/>
</div>
The output is:<br/>
<br/>
Hello world (and have a nice day too!)<br/>
<br/>
</li> <li>Using code inside <span style="color:blue">write-string</span> markup:<br/>
<div class="codestyle">
<span style="color:blue">input-param</span> selector<br/>
<br/>
<span style="color:blue">define-string</span> my_str<span style="color:blue">=</span>"world"<br/>
<br/>
<span style="color:blue">write-string</span> <span style="color:blue">define</span> result_str<br/>
 &nbsp; &nbsp;<span style="color:blue">if-string</span> selector<span style="color:blue">=</span>"simple"<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;Hello <span style="color:blue">&lt;?</span><span style="color:blue">print-web</span> my_string<span style="color:blue">?&gt;</span> (and have a nice day too!)<br/>
 &nbsp; &nbsp;<span style="color:blue">else-if-string</span> selector<span style="color:blue">=</span>"database"<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">run-query#</span>my_query="select name from employee"<br/>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Hello <span style="color:blue">&lt;?query-result#</span>my_query<span style="color:blue">,</span>name<span style="color:blue">?&gt;</span><br/>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;br/&gt;<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">end-query</span><br/>
 &nbsp; &nbsp;<span style="color:blue">else</span><br/>
 &nbsp; &nbsp; &nbsp; &nbsp;No message<br/>
 &nbsp; &nbsp;<span style="color:blue">end-if</span><br/>
<span style="color:blue">end-write-string</span><br/>
<br/>
<span style="color:blue">print-web</span> result_str<br/>
</div>
If selector variable is "simple" (as in URL https://mysite.com/<span style="color:blue">go.your_app_name</span>?selector=simple), the result is:<br/>
<br/>
Hello world (and have a nice day too!)<br/>
<br/>
If selector variable is "database" (as in URL https://mysite.com/<span style="color:blue">go.your_app_name</span>?selector=database), the result is:<br/>
<br/>
Hello Linda<br/>
Hello John<br/>
<br/>
If selector variable is anything else (as in URL https://mysite.com/<span style="color:blue">go.your_app_name</span>?selector=something_else), the result is:<br/>
<br/>
No message<br/>
<br/>
In the above example, result_str variable is defined on the spot, but it can also be defined elsewhere without using <span style="color:blue">define</span>.<br/>
<br/>
</li> <li>Use functions inside <span style="color:blue">write-string</span>:<br/>
<div class="codestyle">
void func1 ()<br/>
{<br/>
 &nbsp; &nbsp;/*&lt;<br/>
 &nbsp; &nbsp;<span style="color:blue">define-string</span> result_str<br/>
<br/>
 &nbsp; &nbsp;<span style="color:blue">write-string</span> result_str<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">&lt;?print-web</span> "Result from func2()"<span style="color:blue">?&gt;</span> is <span style="color:blue">&lt;?c</span> func2();<span style="color:blue">?&gt;</span><br/>
 &nbsp; &nbsp;<span style="color:blue">end-write-string</span><br/>
 &nbsp; &nbsp;&gt;*/<br/>
}<br/>
<br/>
void func2()<br/>
{<br/>
 &nbsp; &nbsp;/*&lt;<br/>
 &nbsp; &nbsp;<span style="color:blue">print-web</span> "Hello from func2"<br/>
 &nbsp; &nbsp;&gt;*/<br/>
}<br/>
</div>
The output from func1() is:<br/>
<br/>
Result from func2() is Hello from func2<br/>
<br/>
</li> <li>Nest <span style="color:blue">write-string</span>s, directly:<br/>
<div class="codestyle">
<span style="color:blue">write-string</span> <span style="color:blue">define</span> str1<br/>
 &nbsp; &nbsp;Hi!<br/>
 &nbsp; &nbsp;<span style="color:blue">write-string</span> <span style="color:blue">define</span> str2<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;Hi Again!<br/>
 &nbsp; <span style="color:blue">end-write-string</span><br/>
 &nbsp; <span style="color:blue">print-web</span> str2<br/>
<span style="color:blue">end-write-string</span><br/>
<span style="color:blue">print-web</span> str1<br/>
</div>
The result is:<br/>
<br/>
Hi! Hi Again!<br/>
<br/>
</li> <li>An example of nesting through function calls:<br/>
<div class="codestyle">
void func1 ()<br/>
{<br/>
 &nbsp; &nbsp;/*&lt;<br/>
 &nbsp; &nbsp;<span style="color:blue">define-string</span> result_str<br/>
<br/>
 &nbsp; &nbsp;<span style="color:blue">write-string</span> result_str<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">define-string</span> func2_result<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">&lt;?print-web</span> "Result from func2()"<span style="color:blue">?&gt;</span> is <span style="color:blue">&lt;?c</span> func2(&amp;func2_result);<span style="color:blue">?&gt;</span><br/>
 &nbsp; &nbsp;<span style="color:blue">end-write-string</span><br/>
 &nbsp; &nbsp;&gt;*/<br/>
}<br/>
<br/>
void func2(char **result)<br/>
{<br/>
 &nbsp; &nbsp;/*&lt;<br/>
 &nbsp; &nbsp;<span style="color:blue">write-string</span> *result<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;hr/&gt;<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">run-query#</span>my_query="select name from employee"<br/>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Hello <span style="color:blue">&lt;?query-result#</span>my_query<span style="color:blue">,</span>name<span style="color:blue">?&gt;</span><br/>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;br/&gt;<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">end-query</span><br/>
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;hr/&gt;<br/>
 &nbsp; &nbsp;<span style="color:blue">end-write-string</span><br/>
 &nbsp; &nbsp;&gt;*/<br/>
}<br/>
</div>
The output from func1() is:<br/>
<br/>
Result from func2() is<br/>
<hr/>
Hello Linda<br/>
Hello John<br/>
<hr/>
<br/>
</li> <li>Because <span style="color:blue">define</span>d string (be it in <span style="color:blue">define-string</span> or via <span style="color:blue">define</span> in any other markup) allocates new heap space, the result can be returned as well, as in this example:<br/>
<div class="codestyle">
void func1 ()<br/>
{<br/>
 &nbsp; &nbsp;/*&lt;<br/>
 &nbsp; &nbsp;<span style="color:blue">write-string</span> result_str<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">define-string</span> func2_result<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">&lt;?print-web</span> "Result from func2()"<span style="color:blue">?&gt;</span> is <span style="color:blue">&lt;?print-web</span> func2();<span style="color:blue">?&gt;</span><br/>
 &nbsp; &nbsp;<span style="color:blue">end-write-string</span><br/>
 &nbsp; &nbsp;&gt;*/<br/>
}<br/>
<br/>
char *func2()<br/>
{<br/>
 &nbsp; &nbsp;/*&lt;<br/>
 &nbsp; &nbsp;<span style="color:blue">write-string</span> <span style="color:blue">define</span> result<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;hr/&gt;<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">run-query#</span>my_query="select name from employee"<br/>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Hello <span style="color:blue">&lt;?query-result#</span>my_query<span style="color:blue">,</span>name<span style="color:blue">?&gt;</span><br/>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;br/&gt;<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">end-query</span><br/>
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;hr/&gt;<br/>
 &nbsp; &nbsp;<span style="color:blue">end-write-string</span><br/>
 &nbsp; &nbsp;&gt;*/<br/>
 &nbsp; &nbsp;return result;<br/>
}<br/>
</div>
The output is the same.</li></ul><br/>
<br/>
All leading and trailing whitespaces are trimmed from each line. Only the whitespaces within each line are output. Text is output as non-encoded (as opposed to URL or web encoded), unless you specifically output something encoded otherwise.<br/>
<a id='79'>
<h2>Program flow</h2>
</a>
<a id='80'>
<h3>Loops</h3>
</a>
Use <span style="color:blue">for</span> and <span style="color:blue">end-for</span> markups:<br/>
<div class="codestyle">
<span style="color:blue">define-int</span> it<br/>
<span style="color:blue">for</span> it=0; it &lt; 10; it++<br/>
 &nbsp; &nbsp;Outputting #<span style="color:blue">&lt;?print-int</span> it<span style="color:blue">?&gt;</span>&lt;br/&gt;<br/>
<span style="color:blue">end-for</span><br/>
</div>
In the above example, a simple loop outputs this to the web page:<br/>
<br/>
Outputting #0<br/>
Outputting #1<br/>
Outputting #2<br/>
Outputting #3<br/>
Outputting #4<br/>
Outputting #5<br/>
Outputting #6<br/>
Outputting #7<br/>
Outputting #8<br/>
Outputting #9<br/>
<a id='81'>
<h3>Conditional statements (if, else...)</h3>
</a>
Conditional statements can be used as follows:<br/>
<ul><li><span style="color:blue">if</span> statement uses any C expression, without parenthesis needed:<br/>
<div class="codestyle">
<span style="color:blue">if</span> x==2 &amp;&amp; y==2 || !(z==3 &amp;&amp; w==4)<br/>
 &nbsp; &nbsp;<span style="color:blue">print-web</span> "Something"<br/>
<br/>
<span style="color:blue">else-if</span> w==4 &amp;&amp; !strcmp(t,"...")<br/>
 &nbsp; &nbsp;<span style="color:blue">print-web</span> "Something else"<br/>
<br/>
<span style="color:blue">else</span> <br/>
 &nbsp; &nbsp;<span style="color:blue">print-web</span> "Anything else"<br/>
<br/>
<span style="color:blue">end-if</span> <br/>
</div>
</li> <li><span style="color:blue">if-string</span> statement is used for comparing strings only. With <span style="color:blue">if-string</span>, single equal sign (<span style="color:blue">=</span>) is used for equal condition, and negative equal (<span style="color:blue">!=</span>) for negative condition. <br/>
<div class="codestyle">
<span style="color:blue">define-string</span> my_str<br/>
<span style="color:blue">define-string</span> my_str1<br/>
<br/>
<span style="color:blue">if-string</span> my_str<span style="color:blue">=</span>"abc"<br/>
 &nbsp; &nbsp;<span style="color:blue">print-web</span> "Something"<br/>
<br/>
<span style="color:blue">else-if-string</span> my_str<span style="color:blue">=</span>"def" <span style="color:blue">or</span> my_string<span style="color:blue">!=</span>"klm"<br/>
 &nbsp; &nbsp;<span style="color:blue">print-web</span> "Something else "<br/>
<br/>
<span style="color:blue">else-if-string</span> my_str<span style="color:blue">=</span>"gef" <span style="color:blue">and</span> my_str1<span style="color:blue">!=</span>"..."<br/>
 &nbsp; &nbsp;<span style="color:blue">print-web</span> "Something else entirely"<br/>
<br/>
<span style="color:blue">else</span><br/>
 &nbsp; &nbsp;<span style="color:blue">print-web</span> "Anything else"<br/>
<br/>
<span style="color:blue">end-if</span><br/>
</div>
With <span style="color:blue">if-string</span> markups, <span style="color:blue">and</span> and <span style="color:blue">or</span> can be used in simple conditional logic with no parenthesis allowed, except when escaped with a backslash in cases when more complex expressions are used in string comparision. <br/>
<br/>
In general, use variables and multiple <span style="color:blue">if-string</span>s to break down the logic and write simpler constructs. The intention of <span style="color:blue">if-string</span> is to make complex decision making process easier to read, and not to enable short and obfuscated code.<br/>
<br/>
Use <span style="color:blue">if</span> for more complex conditional expressions, if needed. To compare strings case-insensitive, use <span style="color:blue">if-string-case</span> and <span style="color:blue">else-if-string-case</span>.</li></ul><br/>
<a id='82'>
<h2>Files</h2>
</a>
<a id="file_storage"></a>
<a id='83'>
<h3>File storage</h3>
</a>
<br/>
You can store your files anywhere you like and use either standard C file mechanism to handle them or Cloudgizer API (such as reading/writing files etc.). Cloudgizer however, also provides a file storage mechanism that you can use for any general purpose. This file storage is used for automatic upload of files as well. <br/>
<br/>
In this file storage, files are generally stored in <span style="color:blue">file</span> directory under application's home directory. Your application may use this storage for any documents you create, see <a href="#file_create">the API you can use to create your own files</a>. This storage is also used for uploading of files from web clients (such as uploading files from web browsers or mobile device cameras) - the uploading is handled automatically by Cloudgizer.<br/>
<br/>
About 30,000 files will be stored in a single subdirectory (i.e. /home/user/file/d&lt;number&gt;) before moving to the next subdirectory. This number of files may increase in the future, however that will not affect files in existing installations, i.e. they will stay where they are. <br/>
<br/>
The number of actual subdirectories and files is in theory limited only by the filesystem used, and Cloudgizer's choice of the number of files is not a hard limit, hence it may increase in the future. The number chosen currently is reflective of the common device storage available at present and the subjective typical file size distribution across typical business applications, so clearly the choice is not related to theoretical limits or considerations. <br/>
<br/>
Modern filesystems can support great many files. For example, if you had 120 million files, they would be spread across some 40,000 directories with 30,000 files each. For example, files might be named /home/user/file/d0/f31881, /home/user/file/d10/f321214, etc.<br/>
<br/>
File names are always based on the ID number, so that changing the number of files per subdirectory will never overwrite files. This scheme also allows for faster access to file nodes due to relatively low number of files per subdirectory, and also might allow for hardware or network partitioning.<br/>
<br/>
Typically, an application will store file names in the database and actual files in file storage in <span style="color:blue">file</span> directory. Each file has a unique ID, and you can use this ID to reference a file in the database, see an example in <a href="#file_create">file creation API</a>.<br/>
<br/>
The table <span style="color:blue">cldDocumentIDGenerator</span> is used to create unique file names across the application, even when multiple requests are made at the same time. This table is created as part of Cloudgizer's installation and used internally to deliver this functionality - you don't have to ever deal with it.<br/>
<a id='84'>
<h3>Permissions and ownership</h3>
</a>
<br/>
Any files created by Cloudgizer (i.e. through uploading from web clients, writing files etc.) are owned by Cloudgizer user and have 700 access permission (owner-only reading, writing and accessing). Group has no privileges, and neither have other users. The Cloudgizer user's home directory is also set up with 700 access permission. <br/>
<a id='85'>
<h3>Uploading files</h3>
</a>
<br/>
Cloudgizer will upload files for you automatically. The file will be stored in <span style="color:blue">file</span> directory by using the document ID generator as a basis for subdirectory and file name under the <span style="color:blue">file</span> directory.<br/>
<br/>
For example, files uploaded might be named /home/user/file/d0/f31881, /home/user/file/d10/f321214, etc. See <a href="#file_storage">File storage</a> for more details on how files are stored.
<br/>
<ul> <li>If your upload file is named 'myfile' in the HTML form you're using to upload the file, you will get the following input parameters when upload happens: myfile_filename, myfile_location, myfile_ext, myfile_size and myfile_id. They are as follows:<br/>
<ul><li>myfile<span style="color:blue">_filename</span> is the name of the file as provided by the client.<br/>
<br/>
</li> <li>myfile<span style="color:blue">_location</span> is the full path to the location on the server where file is stored (such as /home/user/file/d10/f214 for example)<br/>
<br/>
</li> <li>myfile<span style="color:blue">_ext</span> is the extension of the file, for example ".jpg" or ".pdf". Note that ".jpeg" is always showing as ".jpg". The extension is always lower case.<br/>
<br/>
</li> <li>myfile<span style="color:blue">_size</span> is the size of the file uploaded.<br/>
<br/>
</li> <li>myfile<span style="color:blue">_id</span> is the ID of the file, as obtained from <span style="color:blue">cldDocumentIDGenerator</span>, which is used to generate the file's path and name on the server.<br/>
</li></ul><br/>
For example, for an HTML form which is uploading a file with a input HTML file of type "file" that is named "myfile" (such as &lt;input type="file" name="myfile"&gt;), your code that handles this POST might be:<br/>
<div class="codestyle">
<span style="color:blue">input-param</span> myfile<span style="color:blue">_filename</span><br/>
<span style="color:blue">input-param</span> myfile<span style="color:blue">_location</span><br/>
<span style="color:blue">input-param</span> myfile<span style="color:blue">_ext</span><br/>
<span style="color:blue">input-param</span> myfile<span style="color:blue">_size</span><br/>
<span style="color:blue">input-param</span> myfile<span style="color:blue">_id</span><br/>
<br/>
You have uploaded file <span style="color:blue">&lt;?print-web</span> myfile<span style="color:blue">_filename</span><span style="color:blue">?&gt;</span> to a server file at <span style="color:blue">&lt;?print-web</span> myfile<span style="color:blue">_location</span><span style="color:blue">?&gt;</span> &nbsp;...<br/>
</div>
</li></ul><br/>
<a id='86'>
<h3>Reading a whole file</h3>
</a>
Use <span style="color:blue">read-file</span> to read a whole file:<br/>
<div class="codestyle">
<span style="color:blue">read-file</span> "/home/user/some_file" <span style="color:blue">to define</span> file_content <span style="color:blue">status define</span> st<br/>
<span style="color:blue">if</span> st&gt;=0<br/>
 &nbsp; &nbsp;Read:<br/>
 &nbsp; &nbsp;&lt;hr/&gt;<br/>
 &nbsp; &nbsp;<span style="color:blue">print-web</span> file_content<br/>
 &nbsp; &nbsp;&lt;hr/&gt;<br/>
<span style="color:blue">else</span><br/>
 &nbsp; &nbsp;Could not read (<span style="color:blue">&lt;?print-int</span> st<span style="color:blue">?&gt;</span>)<br/>
<span style="color:blue">end-if</span><br/>
</div>
The above example will read a file /home/user/some_file and store the result into a variable file_content and the status into variable st. &nbsp;Variable st would be -1 if cannot open the file, -2 if cannot read the file, and the size of the file read (0, or a positive number) if reading succeeded. &nbsp;<br/>
<br/>
<span style="color:blue">define</span> in both the content variable and the status are optional, so it could be:<br/>
<div class="codestyle">
<span style="color:blue">define-int</span> st<br/>
<span style="color:blue">define-string</span> file_content<br/>
<br/>
<span style="color:blue">read-file</span> "/home/user/some_file" <span style="color:blue">to</span> file_content <span style="color:blue">status</span> st<br/>
</div>
<a id='87'>
<h3>Writing a whole file or appending to a file</h3>
</a>
Use <span style="color:blue">write-file</span> to write to a file:<br/>
<br/>
<ul><li>Create a file and write to it:<br/>
<div class="codestyle">
<span style="color:blue">define-string</span> my_string<span style="color:blue">=</span>"Hello world!"<br/>
<span style="color:blue">write-file</span> "/home/myuser/file_name" <span style="color:blue">from</span> my_string<br/>
</div>
This will write string "Hello world!" to file "/home/myuser/file_name".<br/>
<br/>
</li> <li>Append to an existing file:<br/>
<div class="codestyle">
<span style="color:blue">write-file</span> "/home/myuser/file_name" <span style="color:blue">from</span> "Some string expression" <span style="color:blue">append</span><br/>
</div>
This will append string "Some string expression" (without quotes) to the file.<br/>
<br/>
</li> <li>Specify length of the buffer being written:<br/>
<div class="codestyle">
<span style="color:blue">define-string</span> file_name="myFile"<br/>
<span style="color:blue">write-file</span> file_name <span style="color:blue">from</span> "Some string expression" <span style="color:blue">length</span> 7 <span style="color:blue">append</span><br/>
</div>
This will append string "Some st" (length 7) to the file.<br/>
<br/>
</li> <li>Get status from writing:<br/>
<div class="codestyle">
<span style="color:blue">write-file</span> "/home/myuser/file_name" <span style="color:blue">from</span> "Some string expression" <span style="color:blue">length</span> 7 <span style="color:blue">status define</span> my_status <span style="color:blue">append</span><br/>
</div>
This will also return the status of file writing to integer variable my_status. Return values are 1 if succeeded, -1 if could not open file, -2 if could not write file. <br/>
<br/>
<br/>
</li> <li>Status variable is defined in the above example, or without defining it:<br/>
<div class="codestyle">
<span style="color:blue">define-int</span> my_status<br/>
<span style="color:blue">write-file</span> "/home/myuser/file_name" <span style="color:blue">from</span> "Some string expression" <span style="color:blue">length</span> 7 <span style="color:blue">status</span> my_status <span style="color:blue">append</span><br/>
</div>
This is the same as above, only with explicitly defining my_status variable.</li></ul><br/>
<a id='88'>
<h3>Copying a file</h3>
</a>
Use <span style="color:blue">copy-file</span> to copy a file to another file. The target file is created if it does not exist.<br/>
<div class="codestyle">
<span style="color:blue">copy-file</span> "/home/user/source_file" <span style="color:blue">to</span> "/home/user/target_file" <span style="color:blue">status define</span> st<br/>
<span style="color:blue">print-int</span> st<br/>
</div>
This copies from file source_file to file target_file. The result is -1 if cannot open source_file, -2 if cannot open target_file, -3 if cannot read source_file, -4 if cannot write target_file, and 1 on success.<br/>
<br/>
You can omit <span style="color:blue">define</span> for status:<br/>
<div class="codestyle">
<span style="color:blue">define-int</span> st<br/>
<br/>
<span style="color:blue">copy-file</span> "/home/user/source_file" <span style="color:blue">to</span> "/home/user/target_file" <span style="color:blue">status</span> st<br/>
</div>
<a id='89'>
<h2>Web address of server</h2>
</a>
Web address is the URL specified in <span style="color:blue">config</span> file in <span style="color:blue">web_address</span> variable.<br/>
<br/>
Use <span style="color:blue">web-address</span> to get the base URL for server. Use it for links and forms:<br/>
<br/>
<ul><li>Web address used in a form:<br/>
<div class="codestyle"> 
&lt;form action="<span style="color:blue">&lt;?web-address?&gt;</span>"&gt;<br/>
</div>
will produce for example:<br/>
<br/>
&lt;form action="https://myserver.com/go.your_app_name"&gt;<br/>
<br/>
</li> <li>Web address used in a URL:<br/>
<div class="codestyle">
&lt;a href="<span style="color:blue">&lt;?web-address?&gt;</span>?page=abc&amp;amp;action=do_something"&gt;<br/>
</div>
will produce for example:<br/>
<br/>
&lt;a href="https://myserver.com/go.your_app_name?page=abc&amp;action=do_something"&gt;</li></ul><br/>
<a id='90'>
<h2>Error handling in general</h2>
</a>
<br/>
If an irrecoverable error occurs, then <span style="color:blue">oops</span> function will be called. Irrecoverable error is an error that cannot be handled, it always means the end of a request. Examples of such errors are invalid SQL statements or an invalid URL request. <span style="color:blue">oops</span> function is like this:<br/>
<div class="codestyle">
#include "cld.h"<br/>
..<br/>
void <span style="color:blue">oops</span>(<span style="color:blue">input_req</span> *req, const char *err);<br/>
</div>
<span style="color:blue">input_req</span> is a type that contains information relating to the current request. err is an error message itself. <br/>
<br/>
You can change the implementation of <span style="color:blue">oops</span> function from what it is by default.<br/>
<br/>
When checking errors in your application (i.e. errors that are recoverable), and if upon the examination of the error, your code decides it is still unrecoverable, do not call <span style="color:blue">oops</span> directly. Rather use report-error:<br/>
<div class="codestyle">
<span style="color:blue">if</span> cannot_recover==1<br/>
 &nbsp; &nbsp;<span style="color:blue">report-error</span> "Error in processing, error %s, details %s", err, details<br/>
<span style="color:blue">end-if</span><br/>
</div>
<span style="color:blue">report-error</span> takes arguments the same way as standard printf function. &nbsp;<br/>
<a id='91'>
<h2>Include files</h2>
</a>
<br/>
Do not use Cloudgizer markup code in include files. Instead place all of it in .v files, which are translated into .c files. Use inline code if you need to avoid function calls.<br/>
<a id="debugging_and_tracing"></a>
<a id='92'>
<h2>Debugging your code</h2>
</a>
Generally, you can debug Apache server by forcing it into a single-process mode, running it in gdb and hunting for problems there. A good tutorial on this can be found at <a href="https://httpd.apache.org/dev/debugging.html" target="_blank">https://httpd.apache.org/dev/debugging.html</a>. Once in debugger, you'd want to break in <span style="color:blue">cld_main</span> function, which is the root function for any Cloudgizer application. If for some reason this doesn't work, you have another option, described here.<br/>
<br/>
<a id="debug_file"></a>
<a id='93'>
<h3>Tracing and debugging options</h3>
</a>
These options are located in the <span style="color:blue">trace/debug</span> file, meaning <span style="color:blue">debug</span> file in the <span style="color:blue">trace</span> directory under application's home directory. Typically, you'd have this in it during development:<br/>
<div class="codestyle">
<span style="color:blue">sleep</span>=-1<br/>
<span style="color:blue">trace</span>=1<br/>
<span style="color:blue"> lint</span>=1<br/>
<span style="color:blue">memorycheck</span>=1<br/>
<span style="color:blue">tag</span>=&lt;anything you like&gt;<br/>
</div>
Here is the breakdown of what these do:<br/>
<ul><li><span style="color:blue">sleep</span> is the number of seconds your code will sleep before processing a request. For example, if you set it to 50, this is 50 seconds sleeping before processing the request. You now have the time to find the PID of your process and attach to it. You might do this:<br/>
<div class="codestyle">
ls -aslrt &#126;/trace/*<br/>
</div>
This will list all trace files, with the latest ones in at the bottom. Trace file names look something like trace-9833-2017-05-15-16-57-06. What this means is that PID (process ID) is 9833, and that it was created on 2017-05-16 at 16:57:06. So by looking at the last trace file and getting a PID, you can now call the debugger:<br/>
<div class="codestyle">
sudo gdb /usr/sbin/httpd<br/>
</div>
(you are attaching to httpd process, because that's Apache and that's where your code is running!)<br/>
<br/>
Type in the 'att' command to attach to httpd process in the debugger, and replace 9833 with your actual PID:<br/>
<div class="codestyle">
att 9833 &nbsp;<br/>
</div>
Now if you did all this within 50 seconds (choose the number of seconds to match how long you need), you will be in the middle of a sleep call. Type:<br/>
<div class="codestyle">
next<br/>
</div>
and wait until you get out of it. Now you will be in the generated code, and you can step through (with 's' or 'n' commands) as you like. At this point you haven't reached <span style="color:blue">cld_handle_request</span> yet, so you might create a break point there:<br/>
<div class="codestyle">
br <span style="color:blue">cld_handle_request</span><br/>
</div>
or you may do something else entirely, depending on where you suspect the problem with your code it. Note that all requests will have this sleep, so things will be slow to startup, and once you find and fix the issue, don't forget to turn <span style="color:blue">sleep</span> back to -1 (i.e. no delay):<br/>
<div class="codestyle">
<span style="color:blue">sleep</span>=-1<br/>
</div>
</li> <li><span style="color:blue">trace</span> parameter creates trace files. If it's zero, trace files won't be written. Each trace file name has a timestamp and a PID (process ID) of the process writing it, making it easier to identify the moment and identity of the process writing the trace, as well as to attach to it via gdb. Trace files take a little bit of time to be written (they will probably be cached in memory most of the time), but you can choose not to write them for extra speed. However, then you won't have the history of traces in case something goes wrong - however, you will still have the <span style="color:blue">backtrace</span> and/or <span style="color:blue">web-page-crash</span> files that are generated on program error that should have the source code stack where the problem happened. So even if you don't enable trace files, in case of error there should be file(s) available to assist you in debugging. Cloudgizer will also email the report of error to administration email (<span style="color:blue">email_address</span> in <span style="color:blue">config</span> file) at the moment it happens. <br/>
<br/>
</li> <li><span style="color:blue"> lint</span> parameter. If set to 1, the HTML output your program creates dynamically will be checked in real-time with xmllint. If any error is detected (such as bad HTML tags), this will display at the top of the page as an error. You'll also see a path to a file that contains the error. The actual file with HTML code (that your program generated) is in the file with the same name, only without an <span style="color:blue">.err</span> extension. Go there and check it out, then fix your code. <br/>
<br/>
</li> <li><span style="color:blue">memorycheck</span> parameter. If set to 1, every tracing call (<span style="color:blue">CLD_TRACE</span> API call) will perform memory check of all allocated memory and likely detect any overwrites or underwrites. Since tracing calls are generally well interspersed throughout typical code, this provides higher confidence level that any hard-to-find bugs will be found early on. Set this to 0 in production.<br/>
<br/>
</li> <li><span style="color:blue">tag</span> is a parameter than can have any one-line string. This will be accessible &nbsp;in <span style="color:blue">cld_get_config()-&gt;debug.tag</span> variable and you can use it for any debugging purposes you'd like.<br/>
</li></ul> <br/>
<br/>
Make sure not to use <span style="color:blue">sleep</span>, <span style="color:blue"> lint</span>, <span style="color:blue">memorycheck</span> and <span style="color:blue">tag</span> in your production code.<br/>
<a id='94'>
<h3>Finding where program crashed</h3>
</a>
<br/>
When your program crashes, your best bets are to look in:<br/>
<br/>
<ul><li><span style="color:blue">trace</span> directory and read the trace file, see where it crashed. Use <span style="color:blue">CDL_TRACE()</span> in your code to pinpoint the location.<br/>
<br/>
</li> <li>Check <span style="color:blue">trace/web-page-crash</span> file for more information. This file is generated whenever possible. You'd look here if your program caught the error via <span style="color:blue">report-error</span> or <span style="color:blue">cld_report_error()</span>.<br/>
<br/>
</li> <li>Check <span style="color:blue">trace/backtrace</span> file for more information, especially if your program crashed due to a signal such as SIGSEGV for instance. <br/>
<br/>
</li> <li>Check the core dump. Enabling the core dump and locating it are beyond the scope of this documentation. See your OS documentation.<br/>
</li></ul><br/>
Both <span style="color:blue">web-page-crash</span> and <span style="color:blue">backtrace</span> file will attempt to show the full stack dump, and there you can see function names and line numbers (if available and if you compiled with debugging information included). Cloudgizer will analyze your executable and attempt to show the exact line in your source where the problem happened (meaning the exact line in .v code, and not in the generated .c code, alleviating the need to connect the two files!). <br/>
<br/>
For example, you'd see a report like this that exactly pinpoints the location of the crash (in this case due to segmentation fault) - you'd look for the source code just before entering <span style="color:blue">signal_handler</span> and you'll also see the entire stack leading up to invocation of the function where the problem is:<br/>
<div class="codestyle">
START STACK DUMP ***********<br/>
28014: 2018-06-01-20-54-04: Caught SIGSEGV: segmentation fault<br/>
 last known tracing file/line: [cldrt.c][2697]<br/>
 -----<br/>
 cld_get_stack<br/>
 /home/hellocld/src/chandle.c:165<br/>
 /usr/local/lib/cld/libacld.so(cld_get_stack+0x50) [0x7f4cd747016c]<br/>
 -----<br/>
 posix_print_stack_trace<br/>
 /home/hellocld/src/chandle.c:136<br/>
 /usr/local/lib/cld/libacld.so(posix_print_stack_trace+0x10) [0x7f4cd7470101]<br/>
 -----<br/>
 signal_handler<br/>
 /home/hellocld/src/chandle.c:264<br/>
 /usr/local/lib/cld/libacld.so(signal_handler+0x1f0) [0x7f4cd7470504]<br/>
 -----<br/>
 __restore_rt<br/>
 sigaction.c:?<br/>
 /lib64/libpthread.so.0(+0xf370) [0x7f4cdd086370]<br/>
 -----<br/>
 home_landlord<br/>
 <span style="color:blue">/home/hellocld/rentomy/home_landlord.v:199</span><br/>
 /usr/lib64/httpd/modules/libcldapp_rentomy.so(+0xab200) [0x7f4cd7752200]<br/>
 -----<br/>
 home<br/>
 /home/hellocld/rentomy/<span style="color:blue">home.v:155</span><br/>
 /usr/lib64/httpd/modules/libcldapp_rentomy.so(+0xa05f2) [0x7f4cd77475f2]<br/>
 -----<br/>
 pass_reset<br/>
 /home/hellocld/rentomy/<span style="color:blue">pass_reset.v:359</span><br/>
 /usr/lib64/httpd/modules/libcldapp_rentomy.so(+0x9ed87) [0x7f4cd7745d87]<br/>
 -----<br/>
 cld_handle_request<br/>
 /home/hellocld/rentomy/<span style="color:blue">cld_handle_request.v:291</span><br/>
 /usr/lib64/httpd/modules/libcldapp_rentomy.so(+0x57e6) [0x7f4cd76ac7e6]<br/>
 -----<br/>
 cld_main<br/>
 /home/hellocld/rentomy/a_cldapp.c:69<br/>
 /usr/lib64/httpd/modules/libcldapp_rentomy.so(+0x4248) [0x7f4cd76ab248]<br/>
 -----<br/>
 cld_handler<br/>
 /home/hellocld/rentomy/mod.c:52<br/>
 /usr/lib64/httpd/modules/libcldapp_rentomy.so(+0xad4d4) [0x7f4cd77544d4]<br/>
</div>
<a id='95'>
<h3>Enabling debugging information</h3>
</a>
To enable debugging with gdb, set <span style="color:blue">CLDDEBUG</span> variable in supplied <span style="color:blue">cldmakefile</span> to 1 when making your application. This will turn on debug code generation for gdb.<br/>
<a id='96'>
<h3>Which shared libraries are loaded?</h3>
</a>
<br/>
Check the beginning of the request's trace file - it shows all shared objects loaded, their names and their address ranges. This is useful when figuring out the configuration of Apache server, and otherwise.<br/>
<a id='97'>
<h1>API</h1>
</a>
<br/>
The following is the list of publicly available data types and functions.<br/>
<br/>
Do not use API for common markups provided otherwise. For example, do not use input parameters API, but rather use <span style="color:blue">input-param</span> markup. If underlying API and types change, you'll have to change your code.<br/>
<br/>
Use API only if there is no alternative. The same goes for any other C code you may write, be in direct C code or through <span style="color:blue">c</span> and <span style="color:blue">start-c</span> markups.<br/>
<a id='98'>
<h2>Memory allocation</h2>
</a>
<a id='99'>
<h3>Allocation and garbage collection</h3>
</a>
The following memory allocation functions are available:<br/>
<div class="codestyle">
void *<span style="color:blue">cld_malloc</span> (size_t size);<br/>
void *<span style="color:blue">cld_calloc</span> (size_t nmemb, size_t size);<br/>
void *<span style="color:blue">cld_realloc</span> (void *ptr, size_t size);<br/>
void <span style="color:blue">cld_free</span> (void *ptr);<br/>
char *<span style="color:blue">cld_strdup</span> (const char *s);<br/>
</div>
The above have the same interface as the standard library functions without the 'cld_' prefix. <br/>
<br/>
Always use <span style="color:blue">define-string</span> to allocate memory - only if otherwise necessary, use above cld_* functions for memory allocation. <br/>
<br/>
Most all markups and API will automatically create or expand/shrink memory when needed. <br/>
<br/>
Never use <span style="color:blue">cld_free</span> unless absolutely needed, for example if your request allocates lots of memory in a loop and needs to release it in each pass during a single request. <br/>
<br/>
Memory garbage collector is provided and will release all allocated memory at the end of request. <br/>
<br/>
Do not try to minimize memory usage of a request unless you have a very good reason to, because most requests take relatively short time to complete and memory will be released shortly. Great many bugs and crashes come out of using free()-like functions improperly.<br/>
<br/>
Never use library functions malloc(), free() etc. unless you have an extremely compelling reason, for example if you need to allocate memory and some library frees it. Do not use pointers obtained from Cloudgizer with library functions such as free() or realloc(), and vice versa.<br/>
<a id='100'>
<h3>Get size of memory allocated for variable</h3>
</a>
When variable is allocated by means of <span style="color:blue">define-string</span> or <span style="color:blue">cld_malloc</span> (or such) functions, you can determine at run-time how many bytes are currently allocated for this variable:<br/>
<div class="codestyle">
int sz;<br/>
char *ptr = <span style="color:blue">cld_malloc</span> (200);<br/>
<span style="color:blue">cld_check_memory</span> (ptr, &amp;sz);<br/>
</div>
Variable 'sz' will have value of somewhat over 200 (accounting for overhead in allocating memory). If pointer 'ptr' was not allocated by Cloudgizer functions or markup, program will error out. <br/>
<a id='101'>
<h3>Check if allocated memory is valid, overwritten or underwritten</h3>
</a>
If you want to check if memory pointer is valid and if memory hasn't been overwritten or underwritten, use <span style="color:blue">cld_check_memory</span>:<br/>
<div class="codestyle">
int i = <span style="color:blue">cld_check_memory</span> (p, NULL);<br/>
</div>
p is a pointer returned from <span style="color:blue">define-string</span>, <span style="color:blue">cld_malloc</span> or other such functions. This is an assertive function, i.e. your program will report an error if the memory block is invalid. If memory is okay, it returns an index into an internal memory array that holds information about allocated pointers. This index is for internal purposes only, do not use it in any way.<br/>
<br/>
<a id="configuration_parameters"></a>
<a id='102'>
<h2>Configuration parameters</h2>
</a>
<br/>
Configuration parameters are filled from <span style="color:blue">config</span> file, located in the application's home directory.<br/>
<br/>
Use members of <span style="color:blue">cld_get_config()-&gt;app</span> structure to get the following:<br/>
<br/>
<ul><li>Version of the software:<br/>
<div class="codestyle">
<span style="color:blue">print-web</span> <span style="color:blue">cld_get_config()-&gt;app-&gt;version</span><br/>
</div>
Version is stated in the <span style="color:blue">version</span> field in the <span style="color:blue">config</span> file.<br/>
<br/>
</li> <li> Tracing and logging files directory<br/>
<div class="codestyle">
<span style="color:blue">print-web</span> <span style="color:blue">cld_get_config()-&gt;app-&gt;log_directory</span><br/>
</div>
</li> <li>Temporary directory<br/>
<div class="codestyle">
<span style="color:blue">print-web</span> <span style="color:blue">cld_get_config()-&gt;app-&gt;tmp_directory</span><br/>
</div>
Use temporary directory for any temporary files your application creates.<br/>
<br/>
</li> <li>Uploads directory<br/>
<div class="codestyle">
<span style="color:blue">print-web</span> <span style="color:blue">cld_get_config()-&gt;app-&gt;file_directory</span><br/>
</div>
This is where uploaded files are stored (within enumerated subdirectories). This is also where Cloudgizer file system is located, see <a href="#file_storage">file storage</a> - you can use it for any files your application creates.<br/>
<br/>
</li> <li>Maximum upload size<br/>
<div class="codestyle">
<span style="color:blue">print-web</span> <span style="color:blue">cld_get_config()-&gt;app.max_upload_size</span><br/>
</div>
This is the maximum file size that can be uploaded.<br/>
<br/>
</li> <li>Web directory<br/>
<div class="codestyle">
<span style="color:blue">print-web</span> <span style="color:blue">cld_get_config()-&gt;app-&gt;html_directory</span><br/>
</div>
Typically html, css, image files etc. are stored here.<br/>
<br/>
</li> <li>Administrative email<br/>
<div class="codestyle">
<span style="color:blue">print-web</span> <span style="color:blue">cld_get_config()-&gt;app-&gt;email</span><br/>
</div>
This is <span style="color:blue">email_address</span> field in the <span style="color:blue">config</span> file. It should be an email that your application uses for contact and other purposes. This email is also used by default to email crash information to you.<br/>
<br/>
</li> <li>Server web address<br/>
<div class="codestyle">
<span style="color:blue">print-web</span> <span style="color:blue">cld_get_config()-&gt;app-&gt;web</span><br/>
</div>
This is <span style="color:blue">web_address</span> field in the <span style="color:blue">config</span> file. This is the submit URL for forms and links.<br/>
<br/>
</li> <li>Custom config parameters<br/>
<br/>
You can add any parameters to <span style="color:blue">config</span> file that you like. They must be prefixed with underscore ('_'). Those parameters are stored in the following data structure:<br/>
<div class="codestyle">
<span style="color:blue">cld_get_config()-&gt;app-&gt;user_params</span><br/>
</div>
To obtain them in C code:<br/>
<div class="codestyle">
<span style="color:blue">cld_config</span> *pc = <span style="color:blue">cld_get_config</span> ();<br/>
char *user_option = NULL;<br/>
char *user_option_value = NULL;<br/>
<br/>
<span style="color:blue">cld_rewind</span> (&amp;(<span style="color:blue">pc-&gt;app.user_params</span>));<br/>
while (1)<br/>
{<br/>
 &nbsp; &nbsp;<span style="color:blue">cld_retrieve</span> (&amp;(<span style="color:blue">pc-&gt;app.user_params</span>), &amp;user_option, &amp;user_option_value);<br/>
 &nbsp; &nbsp; if (user_option != NULL)<br/>
 &nbsp; &nbsp; {<br/>
<span style="color:green"> &nbsp; &nbsp; &nbsp; &nbsp; // make use of user_option and user_option value. For example, if in config file:<br/></span>
<span style="color:green"> &nbsp; &nbsp; &nbsp; &nbsp; //<br/></span>
<span style="color:green"> &nbsp; &nbsp; &nbsp; &nbsp; // _my_option = some option value<br/></span>
<span style="color:green"> &nbsp; &nbsp; &nbsp; &nbsp; //<br/></span>
<span style="color:green"> &nbsp; &nbsp; &nbsp; &nbsp; // then user option would be "_my_option" and user_option_value would be "some option value"<br/></span>
 &nbsp; &nbsp; &nbsp; &nbsp; ...<br/>
 &nbsp; &nbsp; }<br/>
 &nbsp; &nbsp; else <br/>
 &nbsp; &nbsp; &nbsp; &nbsp; break;<br/>
}<br/>
</div>
</li></ul><br/>
<a id='103'>
<h2>Tracing and debugging</h2>
</a>
<a id='104'>
<h3>Write to trace file</h3>
</a>
<br/>
Trace call allows you to write to current process' trace file:<br/>
<div class="codestyle">
<span style="color:blue">CLD_TRACE</span>("Entering new employee, id %s", id);) <br/>
</div>
Trace call uses printf syntax to output data. &nbsp;<br/>
<br/>
Trace will be written only if <span style="color:blue">trace</span> parameter in <span style="color:blue">debug</span> file is 1. <br/>
<a id='105'>
<h3>Which trace file is being written to?</h3>
</a>
<br/>
The name of current trace file is:<br/>
<div class="codestyle">
<span style="color:blue">cld_get_config()-&gt;app-&gt;trace.fname</span><br/>
</div>
<a id='106'>
<h3>Using custom tag value for debugging</h3>
</a>
<br/>
Use <span style="color:blue">cld_get_config()-&gt;debug.tag</span> to access <span style="color:blue">tag</span> field in the <span style="color:blue">debug</span> file. This field can have any value you want. Use it to control some aspect of debugging process, in a conditional fashion:<br/>
<div class="codestyle">
<span style="color:blue">if-string</span> <span style="color:blue">cld_get_config()-&gt;debug.tag</span> <span style="color:blue">=</span> "$debug_check$"<br/>
 &nbsp; &nbsp;...<br/>
end-if<br/>
</div>
In production, you would clear the <span style="color:blue">tag</span> value. &nbsp;<br/>
<a id='107'>
<h3>Linting your HTML code dynamically</h3>
</a>
Use <span style="color:blue">cld_lint_text</span> to check validity of HTML code generated dynamically at run-time (for example check HTML emails before sending or check snippets of generated code not directly displayed):<br/>
<div class="codestyle">
<span style="color:blue">write-string define</span> html_code<br/>
 &nbsp; &nbsp;&lt;!DOCTYPE html&gt;<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;html&gt;<br/>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;body&gt;<br/>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Hello&lt;br/&gt;<br/>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; This is html code.&lt;br/&gt;<br/>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;hr/&gt;<br/>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/body&gt;<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;/html&gt;<br/>
<span style="color:blue">end-write-string</span><br/>
<br/>
<span style="color:blue">c cld_lint_text</span> (html_code);<br/>
</div>
In this example, Cloudgizer will check validity of HTML in html_code (as XHTML) by using xmllint utility. <span style="color:blue"> lint</span> in <span style="color:blue">debug</span> file must be set to 1 in order for <span style="color:blue">cld_lint_text</span> to do this. If <span style="color:blue"> lint</span> is 0, nothing will be done.<br/>
<br/>
If there is an error, program will stop and you can see more information in program's trace file (under <span style="color:blue">trace</span> directory).<br/>
<br/>
Note that Cloudgizer will lint your web output automatically if <span style="color:blue"> lint</span> is 1. Use this function to check snippets of HTML that are not output directly by your program.<br/>
<a id='108'>
<h2>URL input</h2>
</a>
<a id='109'>
<h3>URL input parameters</h3>
</a>
<br/>
Input parameters are stored in <br/>
<div class="codestyle">
<span style="color:blue">cld_get_config()-&gt;ctx.req-&gt;ip</span><br/>
</div>
Total number of input parameters is:<br/>
<div class="codestyle">
<span style="color:blue">cld_get_config()-&gt;ctx.req-&gt;ip.num_of_input_params</span><br/>
</div>
Names and values of input parameters are:<br/>
<div class="codestyle">
<span style="color:blue">cld_get_config()-&gt;ctx.req-&gt;ip.names</span>[0], <span style="color:blue">cld_get_config()-&gt;ctx.req-&gt;ip.values</span>[0]<br/>
<span style="color:blue">cld_get_config()-&gt;ctx.req-&gt;ip.names</span>[1], <span style="color:blue">cld_get_config()-&gt;ctx.req-&gt;ip.values</span>[1]<br/>
...<br/>
</div>
etc. up to the total number of input parameters<br/>
<a id='110'>
<h3>Is URL referrer from the same site?</h3>
</a>
<br/>
Use <span style="color:blue">cld_get_config()-&gt;ctx.req-&gt;from_here</span> to determine if the current web request originated from the same site or not. For example, you may not want to spend bandwidth on images not shown from your application, if that's how it's designed. This flag is 1 if the current web request originated from the same site, otherwise 0.<br/>
<br/>
Note that <span style="color:blue">from_here</span> will be 1 if the URL is opened from a web client directly by the end-user.<br/>
<a id='111'>
<h3>URL string that is being processed</h3>
</a>
<br/>
The URL of current request is:<br/>
<div class="codestyle">
<span style="color:blue">cld_get_config()-&gt;ctx.req-&gt;url</span><br/>
</div>
and the referring URL is:<br/>
<div class="codestyle">
<span style="color:blue">cld_get_config()-&gt;ctx.req-&gt;referring_url</span><br/>
</div>
<a id='112'>
<h3>URL parameters manipulation</h3>
</a>
<br/>
There is a <span style="color:blue">cld_input_params</span> data type that can hold input parameters. You can manipulate URL parameters directly by using <span style="color:blue">cld_replace_input_param</span> function with <span style="color:blue">cld_get_config()-&gt;ctx.req-&gt;ip</span> as input.<br/>
<br/>
You can use the following:<br/>
<br/>
<ul><li>Copy URL parameters to <span style="color:blue">cld_input_params</span> type variable:<br/>
<div class="codestyle">
<span style="color:blue">cld_input_params</span> ip;<br/>
<br/>
<span style="color:blue">cld_get_input_params</span> (<span style="color:blue">cld_get_config()-&gt;ctx.req</span>, &amp;ip );<br/>
</div>
<span style="color:blue">cld_input_params</span> has the same members (as far as input parameters go) as <span style="color:blue">input_req</span> type, i.e. you can access:<br/>
<br/>
ip.<span style="color:blue">names</span>[0], ip.<span style="color:blue">values</span>[0] up to ip.<span style="color:blue">num_of_input_params</span>.<br/>
<br/>
<span style="color:blue">cld_get_input_params</span> does not return a result (i.e. it's return type is void).<br/>
<br/>
</li> <li>Replace input parameters' value<br/>
<br/>
An example of replacing value of an input parameter, from above example:<br/>
<div class="codestyle">
<span style="color:blue">cld_input_params</span> ip;<br/>
...<br/>
<span style="color:blue">cld_replace_input_param</span> (&amp;ip, "param1", "new value 1");<br/>
</div>
If parameter "param1" already exists, this will replace the value of existing parameter "param1" with new value "new value 1", and the function returns 1.<br/>
<br/>
If parameter "param1" does not already exists, this will add new parameter "param1" with value "new value 1", and the function returns 2.<br/>
<br/>
You can also directly manipulate input parameters before <span style="color:blue">input-param</span> is used, for instance:<br/>
<div class="codestyle">
<span style="color:blue">cld_replace_input_param</span> (&amp;(cld_get_config()-&gt;ctx.req-&gt;ip), "param1", "new value 1");<br/>
</div>
<br/>
</li> <li>Generate URL from an <span style="color:blue">cld_input_params</span> type variable<br/>
<br/>
An example:<br/>
<div class="codestyle">
<span style="color:blue">cld_input_params</span> ip;<br/>
...<br/>
char *new_url = <span style="color:blue">cld_construct_url</span> (&amp;ip);<br/>
</div>
new_url variable will contain valid URL made out of base URL address of the server and all the parameters, for example 'https://myserver.com/cld.do?param1=value1&amp;param2=value2'<br/>
<br/>
If you need URL part without the server web address, use <span style="color:blue">cld_construct_input_params</span>:<br/>
<div class="codestyle">
char *new_url = <span style="color:blue">cld_construct_input_params</span> (&amp;ip);<br/>
</div>
new_url variable will now contain 'param1=value1&amp;param2=value2'<br/>
<br/>
</li> <li>Simulate input request from a URL<br/>
<br/>
If you have a URL (perhaps saved or constructed URL) that you'd like to manipulate, use first <span style="color:blue">cld_get_input</span> to get the <span style="color:blue">input_req</span> type variable for this URL:<br/>
<div class="codestyle">
<span style="color:blue">input_req</span> my_req;<br/>
const char *my_URL = "https://myserver.com/cld.do?param1=value1&amp;param2=value2";<br/>
<span style="color:blue">cld_get_input</span> (&amp;my_req, "GET", my_URL);<br/>
</div>
Now my_req contains information about this URL, including its input parameters. Other information, such as cookies, is obtained as if the URL came from the client.<br/>
<br/>
Then you can manipulate this URL, for example:<br/>
<div class="codestyle">
<span style="color:blue">cld_input_params</span> ip;<br/>
<br/>
<span style="color:blue">cld_get_input_params</span> (&amp;my_req, &amp;ip );<br/>
<br/>
<span style="color:blue">cld_replace_input_param</span> (&amp;ip, "param1", "new value 1");<br/>
<br/>
char *new_url = <span style="color:blue">cld_construct_url</span> (&amp;ip);<br/>
</div>
Variable new_url now has value "https://myserver.com/cld.do?param1=new%20value%201&amp;param2=value2". </li></ul><br/>
<a id='113'>
<h2>Cookies</h2>
</a>
<a id='114'>
<h3>Data type for storing</h3>
</a>
Cookies passed from HTTP are in:<br/>
<div class="codestyle">
<span style="color:blue">cld_get_config()-&gt;ctx.req-&gt;cookies[0].data</span><br/>
<span style="color:blue">cld_get_config()-&gt;ctx.req-&gt;cookies[1].data</span><br/>
....<br/>
</div>
up to the number of cookies, which is:<br/>
<div class="codestyle">
<span style="color:blue">cld_get_config()-&gt;ctx.req-&gt;num_of_cookies</span><br/>
</div>
<a id='115'>
<h3>Cookies: get, set, delete, find</h3>
</a>
<br/>
<ul><li>Cookies can be obtained by using <span style="color:blue">cld_find_cookie</span>:<br/>
<div class="codestyle">
<span style="color:blue">input_req</span> *req = <span style="color:blue">cld_get_config()-&gt;ctx.req</span>;<br/>
<br/>
int cookie_index;<br/>
char *path;<br/>
char *exp;<br/>
<br/>
char *cookie_value = <span style="color:blue">cld_find_cookie</span> (req, "my_cookie", &amp;cookie_index, &nbsp;&amp;path, &amp;exp);<br/>
</div>
In this example, we search for cookie "my_cookie" in the input request. If it doesn't exist, variable cookie_value will be empty ("").<br/>
<br/>
If it does exist, variable cookie_value will have its value, and variable cookie_index will point to cookie's entry in <span style="color:blue">cld_get_config()-&gt;ctx.req-&gt;cookies[]</span> array. Variable path will have the path for the cookie, and variable exp will have its expiration date.<br/>
<br/>
</li> <li>To set cookie (for a response to client):<br/>
<div class="codestyle">
<span style="color:blue">input_req</span> *req = <span style="color:blue">cld_get_config()-&gt;ctx.req</span>;<br/>
<br/>
<span style="color:blue">cld_set_cookie</span> (req, "my_cookie", "some value", "/", "Wed, 31 May 2012 00:00:01 GMT");<br/>
</div>
The above sets values for a cookie, including path ("/") and the expiration date. Path and expiration date can be NULL in which case they are not set. This function does not return a value. Use <span style="color:blue">cld_time</span> API function to produce time suitable for cookies.<br/>
<br/>
You must set a cookie before outputting the HTTP header, such as in <span style="color:blue">output-http-header</span>, or otherwise it won't be set.<br/>
<br/>
</li> <li>To delete a cookie:<br/>
<div class="codestyle">
<span style="color:blue">input_req</span> *req = <span style="color:blue">cld_get_config()-&gt;ctx.req</span>;<br/>
<br/>
int deleted = <span style="color:blue">cld_delete_cookie</span> (req, "my_cookie");<br/>
</div>
This will delete cookie "my_cookie" (cookie can still be found, but it is set to a value that will delete it in the web client such as browser). If it is not found, this function returns -1, otherwise it returns index into <span style="color:blue">cld_get_config()-&gt;ctx.req-&gt;cookies[]</span> array where it was found. </li></ul><br/>
<a id='116'>
<h2>Global data</h2>
</a>
<br/>
If you need global data in your program (data accessible to any function) and share it between different parts of your program, you can use:<br/>
<div class="codestyle">
<span style="color:blue">cld_get_config()-&gt;ctx.req-&gt;data</span><br/>
</div>
This is a global void* pointer you can use any way you like for sharing global data unrelated to the current request data.<br/>
<a id='117'>
<h2>Encoding and Decoding, URL encoding, Web encoding, Base64 encoding</h2>
</a>
<br/>
<ul><li>To URL encode a string, for use in URL links, images etc.:<br/>
<div class="codestyle">
char *result = NULL:<br/>
int enc_len = <span style="color:blue">cld_encode</span> (<span style="color:blue">CLD_URL</span>, "some text to URL encode", &amp;result);<br/>
</div>
Variable 'result' will be &nbsp;"some%20text%20to%20URL%20encode" and enc_len will be its length.<br/>
<br/>
</li> <li>To web-encode a string, for displaying data in web pages: <br/>
<div class="codestyle">
char *result = NULL:<br/>
int enc_len = <span style="color:blue">cld_encode</span> (<span style="color:blue">CLD_WEB</span>, "some &lt;text&gt; to web encode", &amp;result);<br/>
</div>
Variable 'result' will be &nbsp;"some &amp;lt;text&amp;gt; to web encode" and enc_len will be its length.<br/>
<br/>
</li> <li>Decoding URL encoded data:<br/>
<div class="codestyle">
char *str = "some%20text";<br/>
int str_len = <span style="color:blue">cld_decode</span> (<span style="color:blue">CLD_URL</span>, str);<br/>
</div>
After this, str will be "some text" and str_len will be the length of decoded string.<br/>
<br/>
</li> <li>Decoding web encoded data:<br/>
<div class="codestyle">
char *str = "some&amp;amp;text";<br/>
int str_len = <span style="color:blue">cld_decode</span> (<span style="color:blue">CLD_WEB</span>, str);<br/>
</div>
After this, str will be "some&amp;text" and str_len will be the length of decoded string.<br/>
<br/>
</li> <li>Encode data to Base64<br/>
<br/>
To encode data (for example binary jpg image), you can use:<br/>
<div class="codestyle">
char *data = NULL;<br/>
int file_size = &nbsp;<span style="color:blue">cld_read_whole_file</span> ("/home/user/myimage.jpg", &amp;data);<br/>
<br/>
char *result = NULL;<br/>
int result_len = 0;<br/>
<span style="color:blue">cld_b64_encode</span> (data, file_size, &amp;result, &amp;result_len);<br/>
</div>
In this example, we read the whole file of an image. We pass the data and its length ('data' and 'file_size') to <span style="color:blue">cld_b64_encode</span> and get base64 encoded string in 'result' variable with result_len being its length.<br/>
The <span style="color:blue">cld_b64_encode</span> does not return a value.<br/>
<br/>
</li> <li>Decode base64 data<br/>
<br/>
Data already encoded in base64 can be decoded, if we take from above example:<br/>
<div class="codestyle">
char *original_data = NULL;<br/>
int original_data_len = 0;<br/>
<br/>
<span style="color:blue">cld_b64_decode</span> (result, result_len, &amp;original_data, &amp;original_data_len);<br/>
</div>
In this example, original_data will match data, and original_data_len will match file_size.</li></ul><br/>
<a id='118'>
<h2>Numbers</h2>
</a>
<a id='119'>
<h3>Create string from integer</h3>
</a>
<br/>
To get a new string from an integer, use <span style="color:blue">cld_i2s</span> function:<br/>
<div class="codestyle">
<span style="color:blue">print-web</span> <span style="color:blue">cld_i2s</span> (55, NULL);<br/>
</div>
The result will be:<br/>
<br/>
55<br/>
<br/>
To store the value in a string:<br/>
<div class="codestyle">
<span style="color:blue">define-string</span> val<br/>
<br/>
<span style="color:blue">c</span> <span style="color:blue">cld_i2s</span> (55, &amp;val);<br/>
<br/>
<span style="color:blue">print-web</span> val<br/>
</div>
The result is the same. &nbsp;<br/>
<a id='120'>
<h3>Check if string is a positive integer or a number</h3>
</a>
<br/>
<ul><li>To check if string is a positive number:<br/>
<div class="codestyle">
int is_positive = &nbsp;<span style="color:blue">cld_is_positive_int</span> ("-23");<br/>
</div>
The above returns 0, while:<br/>
<div class="codestyle">
int is_positive = &nbsp;<span style="color:blue">cld_is_positive_int</span> ("23");<br/>
</div>
returns 1. The function returns 1 if it is an integer number comprised of digits only and 0 in any other case.<br/>
<br/>
</li> <li>Check if string is a number and get sign, precision and scale:<br/>
<div class="codestyle">
int prec;<br/>
int scale;<br/>
int positive;<br/>
<br/>
int is_number = &nbsp;<span style="color:blue">cld_is_number</span> ("-24.335", &amp;prec, &amp;scale, &amp;positive);<br/>
</div>
If string is not a number, <span style="color:blue">cld_is_number</span> returns 0, otherwise 1. If positive, variable positive is 1, otherwise 0. Total number of digits is precision and is stored in variable prec. Scale is the number of digits after the decimal point, and is stored in variable scale. Any of variables prec, scale and positive can be NULL if you don't want that information.<br/>
<br/>
In the above example, prec is 5, scale is 3 and positive is 0. </li></ul><br/>
<a id="program_execution_functions"></a>
<a id='121'>
<h2>Execution of external programs, piping from one program to another</h2>
</a>
<br/>
You can execute external programs by using several functions. All of these functions return the status of program (typically 0 if okay, non-zero otherwise).<br/>
<br/>
Typical use cases are:<br/>
<br/>
<ul><li>If you just want to execute a program with command line arguments and capture its exit status (and you don't care about stdin, stdout and stderr), the simplest one for this purpose is <span style="color:blue">cld_exec_program_out_data</span>. This is the simplest use case, and good amount of programs are executed this way.<br/>
<br/>
</li> <li>If you want to execute a program with command line arguments and capture its exit status, and want to get just the first line of its stdout/stderr output (and you don't care about stdin), use <span style="color:blue">cld_exec_program_out_data</span>. Many programs produce one-liner outputs, and this is useful for that. Or the first line tells you all you need to know and so you just get the first line. Probably most programs would fall into this category.<br/>
<br/>
</li> <li>If you want to execute a program with command line arguments and capture its exit status, and be able to pass some input to it through stdin from a variable, and be able to get stdout/stderr output into a variable, and you know the maximum size of such output or the leading output you care about, use <span style="color:blue">cld_exec_program_with_input</span>. <br/>
<br/>
</li> <li>If you want to execute a program with command line arguments and capture its exit status, and be able to pass an open file pointer to it as an input, and get the output into an open file pointer, use <span style="color:blue">cld_exec_program_with_in_out</span>. This function allows for unlimited input and unlimited output, so it's the most generic of all, but if you don't need all that, it's better to use a simpler one. This function also lets you pipe two programs together, i.e. use output of one program as the input to another.<br/>
</li></ul><br/>
<br/>
Here are the details on these functions:<br/>
<br/>
<ul><li><span style="color:blue">cld_exec_program_with_input</span>, which takes command line arguments, input from a variable and produces output to another variable.<br/>
<br/>
Assume you are executing the following from the command line:<br/>
<div class="codestyle">
echo "This is input to program through standard input" | /usr/bin/my_program -switch1 40 -fast &gt; out.txt 2&gt;&amp;1<br/>
</div>
(2&gt;&amp;1 means stderr goes to stdout)<br/>
<br/>
and assume that out.txt (the output of program to the stdout and stderr) is "program finished" and is never larger than 300 characters (or you don't care for anything beyond that), including zero terminator.<br/>
<br/>
In this case, you can do the same programmatically like this:<br/>
<div class="codestyle">
const char *cmd = &nbsp;"/usr/bin/my_program";<br/>
const char *argv[] = {"my_program", "-switch1", "40", "-fast", NULL};<br/>
const char *inp = "This is input to program through standard input";<br/>
char out_buf[300];<br/>
<span style="color:blue">cld_exec_program_with_input</span> (cmd, argv, 4, inp, strlen(inp), out_buf, sizeof(out_buf));<br/>
</div>
<br/>
In this case, program at path "/usr/bin/my_program" will execute. Input parameters are in argv. Note that the first input parameter always must be program's name, which is "my_program" in this case. The last input argument must always be NULL. Number of arguments is 4, which is excluding NULL. The output of the program is stored into variable out_buf, and the size of this variable is provided as the last argument.<br/>
<br/>
If inp is NULL or inp is empty string (i.e. inp[0]==0), then no data is written to stdin of the executing program.<br/>
<br/>
<li><span style="color:blue">cld_exec_program_out_data</span> which takes command line arguments and produces standard output, the first line of which is captured. <br/>
<br/>
Assume you are executing the following from the command line:<br/>
<div class="codestyle">
/usr/bin/my_program -switch xyz some_arg &gt; out.txt 2&gt;&amp;1<br/>
</div>
(2&gt;&amp;1 means stderr goes to stdout)<br/>
<br/>
and assume you are interested only in the very first line of out.txt, and you don't have any standard input to it.<br/>
<br/>
In this case, you can do the same programmatically like this:<br/>
<div class="codestyle">
char buf[1024];<br/>
int buf_len = sizeof (buf);<br/>
const char *argv[] = {"my_program", "-switch", "xyz", "some_arg", NULL};<br/>
<br/>
int st = <span style="color:blue">cld_exec_program_out_data</span> ("/usr/bin/my_program", argv, 4, buf, buf_len);<br/>
</div>
In this case, program at path "/usr/bin/my_program" will execute. Input parameters are in argv. Note that the first input parameter always must be program's name, which is "my_program" in this case. The last input argument must always be NULL. Number of arguments is 4, which is excluding NULL. The first line of the output of the program is stored into variable buf, and the size of this variable is buf_len.<br/>
<br/>
</li> <li><span style="color:blue">cld_exec_program_with_in_out</span> which takes command line arguments, takes input from a file pointer provided, and writes output to another file pointer provided.<br/>
<br/>
<ul><li>Assume you want to execute the program, and you will provide the input to it from one file, and want to get output as a file pointer you want to read.<br/>
<div class="codestyle">
const char *ap3[] = {"my_program", "-switch", "40", "-fast", NULL};<br/>
FILE *fin1 = fopen ("/home/user/somefile", "r");<br/>
FILE *fout3 = NULL; // create temp file in cld_exec_program_with_in_out<br/>
int st = <span style="color:blue">cld_exec_program_with_in_out</span> ("/usr/bin/my_program", ap3, 4, fin1, &amp;fout3);<br/>
<span style="color:green">// now you can read from fout3 with fgets in a loop for example<br/></span>
</div>
In this case, program at path "/usr/bin/my_program" will execute. Input parameters are in argv. Note that the first input parameter always must be program's name, which is "my_program" in this case. The last input argument must always be NULL. Number of arguments is 4, which is excluding NULL. The input of the program (stdin) will be taken from file "/home/user/somefile", which we opened, and we passed the file pointer to it to <span style="color:blue">cld_exec_program_with_in_out</span>. The output of my_program will go to file pointer fout3, which in this case is NULL, and that means <span style="color:blue">cld_exec_program_with_in_out</span> will create a temporary file, open it and assign its file pointer to fout3. After writing to fout3 is done, fout3 will remain open and will be rewound to its very beginning, so your program can read it. Since it's a temporary file, it will be automatically deleted once you close it (with fclose()).<br/>
<br/>
</li> <li>To write to a file of your choice, open file for writing and assign the file pointer to fout3:<br/>
<div class="codestyle">
const char *ap3[] = {"my_program", "-switch", "40", "-fast", NULL};<br/>
FILE *fin1 = fopen ("/home/user/somefile", "r");<br/>
FILE *fout3 = fopen ("home/user/outfile", "w+");<br/>
int st = <span style="color:blue">cld_exec_program_with_in_out</span> ("/usr/bin/my_program", ap3, 4, fin1, &amp;fout3);<br/>
<span style="color:green">// now you can read from fout3 (it is rewound to its beginning), or just close it<br/></span>
fclose (fout3);<br/>
</div>
</li></ul><br/>
<br/>
</li> <li>You can also use <span style="color:blue">cld_exec_program_with_in_out</span> to &nbsp;pipe from one program to another:<br/>
<div class="codestyle">
<span style="color:green">// You execute my_program_1 and take input from file /home/user/somefile and produce output to file pointer fout3 which is created for you<br/></span>
const char *ap3[] = {"my_program_1", "-switch", "40", "-fast", NULL};<br/>
FILE *fin1 = fopen ("/home/user/somefile", "r");<br/>
FILE *fout3 = NULL; // create temp file in cld_exec_program_with_in_out<br/>
int st = <span style="color:blue">cld_exec_program_with_in_out</span> ("/usr/bin/my_program1", ap3, 4, fin1, &amp;fout3);<br/>
<br/>
<span style="color:green">// Now you execute my_program_2 and you take input from fout3 (which contains output from my_program_1, we had it created above) and <br/></span>
<span style="color:green">// produces output in fout4 which is file pointer we created for file /home/user/outfile, so the output from my_program_2 goes there.<br/></span>
const char *ap3[] = {"my_program_2", "-switch", "50", "-fast", NULL};<br/>
FILE *fout4 = fopen ("/home/user/outfile", "w+");<br/>
int st = <span style="color:blue">cld_exec_program_with_in_out</span> ("/usr/bin/my_program_2", ap3, 4, fout3, &amp;fout4);<br/>
<span style="color:green">// now file /home/user/outfile has the final output from my_program_2 and fout4 is file pointer to it, and it is rewound<br/></span>
<span style="color:green">// to the very beginning of the file. We can read it, or if the goal is just to have the file created, we can just close it now.<br/></span>
fclose (fout4); <br/>
</div>
</li></ul> <br/>
<a id='122'>
<h2>Output data and HTTP header</h2>
</a>
<a id='header'></a>
<a id='123'>
<h3>Outputting HTTP header, custom HTTP response headers</h3>
</a>
<br/>
To output HTTP header for dynamically generated web pages, use <span style="color:blue">cld_output_http_header</span>:<br/>
<div class="codestyle">
<span style="color:blue">input_req</span> *req = <span style="color:blue">cld_get_config()-&gt;ctx.req</span>;<br/>
<br/>
<span style="color:blue">cld_output_http_header</span>(req);<br/>
</div>
In most cases, you'd just output header as shown above. This means a client (such as browser) is instructed not to cache since pages are dynamically generated in a typical scenario and content type is HTML.<br/>
<br/>
If you however want to send a custom header, you can set it through <span style="color:blue">header</span> member of <span style="color:blue">input_req</span>:<br/>
<div class="codestyle">
<span style="color:blue">input_req</span> *req = <span style="color:blue">cld_get_config()-&gt;ctx.req</span>;<br/>
<span style="color:blue">cld_header</span> header;<br/>
<br/>
header.<span style="color:blue">ctype</span> = "..."; // set content type such as "text/css"<br/>
header.<span style="color:blue">cache_control</span> = "..."; // set custom cache control, such as "max-age=10000"<br/>
header.<span style="color:blue">status_id</span> = "..."; // set custom response code such as "302"<br/>
header.<span style="color:blue">status_text</span> = "..."; // set custom response text such as "Found"<br/>
<span style="color:green">// Set any other custom headers as name/value pairs in <span style="color:blue">control</span>/<span style="color:blue">value</span> array, which must not have gaps and unused values must be NULL<br/></span>
<span style="color:green">// There can be maximum of <span style="color:blue">CLD_MAX_HTTP_HEADER</span> headers added through this mechanism.<br/></span>
header.<span style="color:blue">control</span>[0] = "...";<br/>
header.<span style="color:blue">value</span>[0] = "...";<br/>
header.<span style="color:blue">control</span>[1] = "...";<br/>
header.<span style="color:blue">value</span>[1] = "...";<br/>
...<br/>
<br/>
req-&gt;header = &amp;header;<br/>
<span style="color:blue">cld_output_http_header</span>(req);<br/>
</div>
In the above example, custom header is constructed and output.<br/>
<a id='124'>
<h3>Encoding data for output</h3>
</a>
<br/>
To output data, use <span style="color:blue">cld_printf</span> or <span style="color:blue">cld_puts</span>.<br/>
<br/>
<ul><li>To web-encode (i.e. substitute &amp; with &amp;amp;, &lt; with &amp;lt; etc):<br/>
<div class="codestyle">
int bytes_output = &nbsp;<span style="color:blue">cld_printf</span> (<span style="color:blue">CLD_WEB</span>, "Output web-encoded like printf, using %s, %d etc, ", string, 100);<br/>
</div>
</li> <li>To URL-encode (i.e. substitute space with %20 etc.):<br/>
<div class="codestyle">
int bytes_output = &nbsp;<span style="color:blue">cld_printf</span> (<span style="color:blue">CLD_URL</span>, "Output URL-encoded like printf, using %s, %d etc, ", string, 100);<br/>
</div>
</li> <li>To print non-encoded (i.e. verbatim):<br/>
<div class="codestyle">
int bytes_output = &nbsp;<span style="color:blue">cld_printf</span> (<span style="color:blue">CLD_NOENC</span>, "Output not-encoded like printf, using %s, %d etc, ", string, 100);<br/>
</div>
</li> <li>To output a single string:<br/>
<div class="codestyle">
int bytes_output = &nbsp;<span style="color:blue">cld_puts</span> (<span style="color:blue">CLD_NOENC</span>, "Output not-encoded string");<br/>
int bytes_output = &nbsp;<span style="color:blue">cld_puts</span> (<span style="color:blue">CLD_URL</span>, "Output URL-encoded string");<br/>
int bytes_output = &nbsp;<span style="color:blue">cld_puts</span> (<span style="color:blue">CLD_WEB</span>, "Output Web-encoded string");<br/>
</div>
This outputs a single string, in different encodings.<br/>
</li></ul><br/>
<br/>
Each of the above functions returns number of bytes written. Writing is typically buffered for maximum performance.<br/>
<br/>
"Outputting data" means outputting to the web client, or the string. If the above functions are used within <span style="color:blue">write-string</span> and <span style="color:blue">end-write-string</span> (or API equivalents), the output goes to the string, otherwise it goes to the web client, except if the program is in batch mode. In batch mode, there is no output produced by these functions - you have to output data yourself (to a file, stdout, stderr etc.) or by using <span style="color:blue">print-out</span> and <span style="color:blue">print-error</span> markups. In batch mode, you can still write to a string and then output the string however you see fit. &nbsp;<br/>
<a id='125'>
<h3>Output text without breaks</h3>
</a>
<br/>
If you want to output text to web client and substitute new lines with &lt;br/&gt;s, use:<br/>
<div class="codestyle">
const char *text = "this is\nsome text\n";<br/>
<span style="color:blue">cld_print_web_show_newline</span> (text);<br/>
</div>
This outputs:<br/>
<br/>
this is&lt;br/&gt;<br/>
some text&lt;br/&gt;<br/>
<a id='126'>
<h3>Disable and Enable HTML output, status of enablement</h3>
</a>
<br/>
The output of text to web client can be enabled or disabled. By default it is enabled. In order to output a file, it has to be disabled.<br/>
<br/>
To disable output:<br/>
<div class="codestyle">
<span style="color:blue">cld_disable_output</span>();<br/>
</div>
To enable output:<br/>
<div class="codestyle">
<span style="color:blue">cld_enable_output</span>();<br/>
</div>
You would disable HTML output when you want to output a file from your program, in which case you would output HTTP headers on your own (see <span style="color:blue">cld_out_file()</span>).<br/>
<br/>
When HTML output is disabled, anything written so far into the web output buffer (that hasn't been output yet) is cleared. Also, anything output from that point onward is never written to the output buffer.<br/>
<br/>
If you need to know if html output is enabled or disabled, use <span style="color:blue">cld_is_disabled_output</span>() function. It returns 1 if HTML output is disabled, otherwise 0.<br/>
<a id='127'>
<h3>Send files to the client and output HTTP headers for files</h3>
</a>
<br/>
Use <span style="color:blue">cld_out_file</span> to send files to the client, for example images, documents etc. You can do this to display these files or to have the client download them.<br/>
<br/>
Because the output from your program is always generated text, it is always sent to client with a note not to cache (unless you use <a href="#header">custom headers</a>).<br/>
<br/>
For outputting files, however, you can control HTTP headers. <span style="color:blue">cld_header</span> data type can be used to control it:<br/>
<div class="codestyle">
<span style="color:blue">cld_header</span> header;<br/>
<br/>
<span style="color:green">//<br/></span>
<span style="color:green">// Set the content type<br/></span>
<span style="color:green">//<br/></span>
header.<span style="color:blue">ctype</span> = "image/jpg"; // (or text/html or application/pdf etc.)<br/>
</div>
Content type must be specified.<br/>
<div class="codestyle">
<span style="color:green">//<br/></span>
<span style="color:green">// Disposition, show or download<br/></span>
<span style="color:green">//<br/></span>
<br/>
<span style="color:green">// Show file<br/></span>
header.<span style="color:blue">disp</span> = NULL; // default, just show in client<br/>
header.<span style="color:blue">file_name</span> = NULL; // default, just show in client, no file name to download<br/>
<br/>
<span style="color:green">// Download file<br/></span>
header.<span style="color:blue">disp</span> = "attachment"; // used to download files (i.e. client will prompt for download)<br/>
header.<span style="color:blue">file_name</span> = "document14"; // this is file name to be downloaded, used only when <span style="color:blue">disp</span> is "attachment"<br/>
</div>
Default values <span style="color:blue">disp</span> and <span style="color:blue">file_name</span> are &nbsp;NULL.<br/>
<div class="codestyle">
<span style="color:green">//<br/></span>
<span style="color:green">// Cache control<br/></span>
<span style="color:green">//<br/></span>
header.<span style="color:blue">cache_control</span> = "max-age: 3600"; // set cache-control. <br/>
</div>
Default cache value is to cache almost forever (or rather for 53 years).<br/>
<div class="codestyle">
<span style="color:green">//<br/></span>
<span style="color:green">// ETag<br/></span>
<span style="color:green">//<br/></span>
header.<span style="color:blue">etag</span> = 1; // if 1, etag (file modification date) will be included, if 0, it won't be<br/>
</div>
Default <span style="color:blue">etag</span> value is 1.<br/>
<div class="codestyle">
<span style="color:green">// <br/></span>
<span style="color:green">// Custom HTTP header fields<br/></span>
<span style="color:green">//<br/></span>
header.<span style="color:blue">control</span>[0] = "some_HTTP_option";<br/>
header.<span style="color:blue">value</span>[0] = "value for some_HTTP_option";<br/>
header.<span style="color:blue">control</span>[1] = "some_HTTP_option_1";<br/>
header.<span style="color:blue">value</span>[1] = "value for some_HTTP_option_1";<br/>
</div>
etc. up to <span style="color:blue">CLD_MAX_HTTP_HEADER</span> options. All options in <span style="color:blue">control</span>/<span style="color:blue">value</span> members must be continuosly present from index 0 up to whatever index is used.<br/>
By default, all custom fields are NULL.<br/>
<br/>
An example:<br/>
<div class="codestyle">
<span style="color:blue">cld_header</span> header;<br/>
<br/>
<span style="color:green">// Initialize header<br/></span>
<span style="color:blue">cld_init_header</span> (&amp;header);<br/>
<br/>
<span style="color:green">// Set header<br/></span>
header.<span style="color:blue">ctype</span> = "image/jpg";<br/>
<br/>
<span style="color:green">// Output file with header<br/></span>
<span style="color:blue">cld_out_file</span> ("/home/user/myfile.jpg", &amp;header);<br/>
</div>
Both <span style="color:blue">cld_init_header</span> and <span style="color:blue">cld_out_file</span> do not return a value. <br/>
<br/>
Note that <span style="color:blue">cld_out_file</span> will error out if your file name has dot-dot (..) in it - such files will not be served to avoid dot-dot (or path-traversal) attacks. Your file name should never have dot-dot (i.e. "..") in it.<br/>
<a id='128'>
<h3>File not found (404)</h3>
</a>
<br/>
To output File Not Found message (i.e. 404 code back to the web client), use:<br/>
<div class="codestyle">
<span style="color:blue">cld_cant_find_file</span> ("Explain reason for Not Found");<br/>
</div>
To use this function, HTTP header must not have been output.<br/>
<a id='129'>
<h3>Flush output</h3>
</a>
<br/>
The program output can be flushed with &nbsp;<span style="color:blue">cld_flush_printf</span>:<br/>
<div class="codestyle">
int num_bytes_written = <span style="color:blue">cld_flush_printf</span>(0);<br/>
</div>
The input parameter to this function is always 0. Returns -1 if no output could be flushed (meaning HTML output is disabled and no writing to string is happening now), or number of bytes written (0 or more).<br/>
Typically you don't need to call this function, and it may slow down the output if you do, even if your output is large, since flushing is done automatically when needed. In rare occassions you might use it, such as if your output consists of a number of parts and each part takes some time to compute.<br/>
<a id='130'>
<h2>Create new database document and a new associated file</h2>
</a>
<br/>
Use <span style="color:blue">cld_make_document</span>:<br/>
<div class="codestyle">
<span style="color:blue">define-string</span> document_id<br/>
<br/>
<span style="color:green">// do the rest in a C block<br/></span>
<span style="color:blue">start-c</span><br/>
<br/>
char document_file[MAX_FILENAME_LEN + 1];<br/>
<br/>
<span style="color:green">// Create a new document. You get:<br/></span>
<span style="color:green">// 1. document_id - which is a unique ID for the document.<br/></span>
<span style="color:green">// 2. document_file - a full-path file name associated with this unique ID for the document<br/></span>
<span style="color:green">// You likely want to store both document_id and document_file in some table where you can reference them later.<br/></span>
<br/>
FILE *f = <span style="color:blue">cld_make_document</span> (&amp;document_id, document_file, MAX_FILENAME_LEN); <br/>
<br/>
<span style="color:green">// Now you can &nbsp;write to the file with file pointer f, close it, etc.<br/></span>
fprintf (f, "Hello!");<br/>
fclose(f);<br/>
<span style="color:blue">end-c</span><br/>
</div>
<a id='131'>
<h2>Strings</h2>
</a>
<a id='132'>
<h3>Initialize, Copy, Append strings</h3>
</a>
<br/>
The following functions are used for string creating and manipulation:<br/>
<br/>
<ul><li>Initialize string:<br/>
<div class="codestyle">
char *str = <span style="color:blue">cld_init_string</span>("some init value");<br/>
</div>
Variable str will have value of "some init value".<br/>
<br/>
To define an empty string faster than <span style="color:blue">cld_init_string</span>:<br/>
<div class="codestyle">
<span style="color:blue">CLD_DEFINE_STRING</span> (empty_str);<br/>
</div>
To initialize an existing string faster than <span style="color:blue">cld_init_string</span>:<br/>
<div class="codestyle">
<span style="color:blue">CLD_INIT_STRING</span> (empty_str);<br/>
</div>
</li> <li>Copy strings:<br/>
<div class="codestyle">
char *str = <span style="color:blue">cld_init_string</span> ("some init value");<br/>
<br/>
int len = <span style="color:blue">cld_copy_data</span> (&amp;str, "some new value");<br/>
</div>
New value of variable str is "some new value" with variable len being its length.<br/>
<br/>
</li> <li>Copy integer as a string:<br/>
<div class="codestyle">
char *str = <span style="color:blue">cld_init_string</span> ("some init value");<br/>
<br/>
int len = <span style="color:blue">cld_copy_data_from_int</span> (&amp;str, 204);<br/>
</div>
New value of variable str is "204" with variable len being its length.<br/>
<br/>
</li> <li>Copy string in the middle of another string. The string being copied to is resized to accomodate new size. Zero bytes is placed at the end.<br/>
<div class="codestyle">
char *str = <span style="color:blue">cld_init_string</span> ("some init value");<br/>
<br/>
int len = <span style="color:blue">cld_copy_data_at_offset</span> (&amp;str, 5, "entirely new");<br/>
</div>
String "entirely new" will be written starting at offset 5 in variable str, so the new value of variable str is "some entirely new" with variable len being its length.<br/>
<br/>
This function simply copies string &nbsp;at the given offset and terminates at the end of a string being copied. Everything from the given offset onward in the original string is lost.<br/>
<br/>
</li> <li>Append string:<br/>
<div class="codestyle">
char *to_str = <span style="color:blue">cld_init_string</span> ("some init value");<br/>
<br/>
<span style="color:blue">cld_append_string</span> ("copy over", &amp;to_str);<br/>
</div>
The new value of variable to_str is "some init valuecopy over". This function does not return a value.<br/>
<br/>
</li> <li>Copy string up to given length:<br/>
<div class="codestyle">
char *to_str = <span style="color:blue">cld_init_string</span> ("some init value");<br/>
<br/>
<span style="color:blue">cld_strncpy</span>(to_str, "hello", 3);<br/>
</div>
This will copy maximum of 3 bytes, including zero byte, so variable to_str will have a value of "he", because the third byte will be zero terminator. This function does not return a value. </li></ul><br/>
<a id='133'>
<h3>Output data to string</h3>
</a>
<br/>
Program output normally goes to the web client. You can redirect it to a string by using:<br/>
<div class="codestyle">
char *my_str;<br/>
<br/>
<span style="color:blue">cld_write_to_string</span> (&amp;my_str);<br/>
<br/>
<span style="color:blue">cld_printf</span> (CLD_NOENC, "Some output that normally goes out to the client..");<br/>
<br/>
<span style="color:blue">cld_write_to_string</span> (NULL);<br/>
<br/>
int bytes_written = <span style="color:blue">cld_write_to_string_length</span> ();<br/>
</div>
In the above example, the first call to <span style="color:blue">cld_write_to_string</span> signifies that all output will go to variable str. This is so until the next call to <span style="color:blue">cld_write_to_string</span> happens with NULL parameter. The length of the string written can be obtained immediately after the closing call with <span style="color:blue">cld_write_to_string_length</span>.<br/>
<br/>
Calls to <span style="color:blue">cld_write_to_string</span> can be nested, i.e.:<br/>
<div class="codestyle">
char *my_str;<br/>
<br/>
<span style="color:blue">cld_write_to_string</span> (&amp;my_str);<br/>
<br/>
<span style="color:blue">cld_printf</span> (CLD_NOENC, "This output goes to my_str variable..");<br/>
<br/>
char *my_str_1;<br/>
<br/>
<span style="color:blue">cld_write_to_string</span> (&amp;my_str_1);<br/>
<span style="color:blue">cld_printf</span> (CLD_NOENC, "This output goes to my_str_1 variable...");<br/>
<span style="color:blue">cld_write_to_string</span> (NULL);<br/>
int bytes_written_1 = <span style="color:blue">cld_write_to_string_length</span> ();<br/>
<br/>
<span style="color:blue">cld_write_to_string</span> (NULL);<br/>
<br/>
int bytes_written = <span style="color:blue">cld_write_to_string_length</span> ();<br/>
</div>
In this case the second <span style="color:blue">cld_printf</span> goes to my_str_1 variable, and not to my_str variable. Variable bytes_written_1 has the length of this output only. The result for the first <span style="color:blue">cld_printf</span> is the same as before.<br/>
<br/>
<span style="color:blue">cld_write_to_string</span> can be used to capture page output:<br/>
<div class="codestyle">
<span style="color:blue">define-string</span> my_str<br/>
<br/>
<span style="color:blue">c cld_write_to_string</span> (&amp;my_str);<br/>
<br/>
Hello!&lt;br/&gt;<br/>
&lt;br/&gt;<br/>
It is a good day today!&lt;br/&gt;<br/>
&lt;hr/&gt;<br/>
<br/>
<span style="color:blue">c cld_write_to_string</span> (NULL);<br/>
<br/>
<span style="color:blue">print-noenc</span> my_str<br/>
</div>
In this above example, the output (Hello!... up to and including &lt;hr/&gt;) is written into my_str string, which is then output.<br/>
<a id='134'>
<h3>Change case of strings (upper, lower)</h3>
</a>
<br/>
To lower or uppercase a string, use:<br/>
<div class="codestyle">
char my_str[] = "SOME STRING";<br/>
<span style="color:blue">cld_lower</span>(my_str);<br/>
</div>
Variable my_str is now "some string".<br/>
<div class="codestyle">
<span style="color:blue">cld_upper</span>(my_str);<br/>
</div>
Variable my_str is now "SOME STRING".<br/>
<br/>
Both <span style="color:blue">cld_lower</span> and <span style="color:blue">cld_upper</span> return the input string, in this case they would both return my_str.<br/>
<a id='135'>
<h3>Substrings</h3>
</a>
<br/>
<ul><li>To count the number of substrings, use <span style="color:blue">cld_count_substring</span>:<br/>
<div class="codestyle">
int num = <span style="color:blue">cld_count_substring</span> ("Hello world, and welcome to the world!", "world");<br/>
</div>
In this example, variable num will have a value of 2. Strings are searched case-sensitive.<br/>
<br/>
</li> <li>To search and replace substrings, use <span style="color:blue">cld_replace_string</span>:<br/>
<div class="codestyle">
char str[100];<br/>
<span style="color:blue">cld_strncpy</span> (str, "Hello world, and welcome to the world!", sizeof(str));<br/>
char *past_last;<br/>
<br/>
int num = <span style="color:blue">cld_replace_string</span> (str, sizeof(str), "world", "life", 1, &amp;past_last);<br/>
</div>
In this case, variable num would be 2 (number of replacements), and str would be "Hello life, and welcome to the life!". Variable past_last would be the pointer to the very first character past the last substitution, and here it would point to the final "!". The argument prior to the last is 1, and it signifies to search and replace all occurances. If it were 0, only the first occurance would be replaced:<br/>
<div class="codestyle">
int num = <span style="color:blue">cld_replace_string</span> (str, sizeof(str), "world", "life", 0, &amp;past_last);<br/>
</div>
Variable num would be 1, and str would be "Hello life, and welcome to the world!".<br/>
<br/>
The last argument is optional if you don't care about where the search and replace ended:<br/>
<div class="codestyle">
int num = <span style="color:blue">cld_replace_string</span> (str, sizeof(str), "world", "life", 0, NULL);<br/>
</div>
The function returns the number of occurances/replacements, or -1 if the buffer was too small to complete the replacements. Strings are searched case sensitive. <br/>
<br/>
If -1 is returned, whatever substitutions could have been made (i.e. the buffer was big enough for them), were actually made, and it will stop when the buffer would be too small for the next one. Use the 6th parameter to know what was the last location where substitution was made.<br/>
<br/>
</li> <li>If you want Cloudgizer to allocate the space for the result of search and replace (including when additional space is needed) , use <span style="color:blue">cld_subst</span>:<br/>
<div class="codestyle">
char *str = <span style="color:blue">cld_init_string</span> ("1 two 1 three");<br/>
char *search = "1";<br/>
char *replace_with = "one";<br/>
<span style="color:blue">cld_subst</span> (&amp;src, search, replace_with, 1);<br/>
</div>
In this example, 'src' variable will be:<br/>
<br/>
one two one three<br/>
<br/>
Parameter 'src' must be allocated by <span style="color:blue">define-string</span> or <span style="color:blue">cld_malloc</span> (or such). Second parameter is replaced with the third in 'src'. Fourth parameter is 1, meaning to substitute all occurances - if it were 0 then only the first one would be substituted. Variable 'src' will be allocated more memory if needed for search and replace to complete.<br/>
</li></ul><br/>
<a id='136'>
<h3>Trim string</h3>
</a>
<br/>
To trim string of whitespace both on left and right, use <span style="color:blue">cld_trim</span>:<br/>
<div class="codestyle">
char *str = <span style="color:blue">cld_strdup</span> (" ABC ");<br/>
int len = strlen (str);<br/>
<br/>
<span style="color:blue">cld_trim</span> (str, &amp;len);<br/>
</div>
Variable str will be "ABC" and len will be 3 (i.e. the new length). This function doesn't return a value. &nbsp;<br/>
<a id='137'>
<h3>Break down string into an array of strings based on a delimiter</h3>
</a>
<br/>
Often times a string needs to be broken down into pieces based on a variable delimiter. To do that, use <span style="color:blue">cld_break_down</span>:<br/>
<div class="codestyle">
<span style="color:blue">define-string</span> to_break="name=value+name1=value1+name2=value2"<br/>
<span style="color:blue">start-c</span><br/>
 &nbsp; <span style="color:blue">cld_broken</span> broken;<br/>
 &nbsp; <span style="color:blue">cld_break_down</span> (to_break, "+", &amp;broken); <br/>
 &nbsp; int i;<br/>
<br/>
 &nbsp; for (i = 0; i &lt; broken.<span style="color:blue">num_pieces</span>; i++)<br/>
 &nbsp; {<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">cld_broken</span> broken_further;<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">cld_break_down</span> (broken.<span style="color:blue">pieces</span>[i], "=", &amp;broken_further); <br/>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">cld_printf</span> (<span style="color:blue">CLD_WEB</span>, "Name is %s, value is %s", broken_further.<span style="color:blue">pieces</span>[0], broken_further.<span style="color:blue">pieces</span>[1]);<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">cld_printf</span> (<span style="color:blue">CLD_NOENC</span>, "&lt;br/&gt;\n");<br/>
 &nbsp; }<br/>
<span style="color:blue">end-c</span><br/>
</div>
The output would be:<br/>
<br/>
Name is name, value is value<br/>
Name is name1, value is value1<br/>
Name is name2, value is value2<br/>
<br/>
The string to_break is broken by inserting zero characters, for better performance. If you want it unchanged, use <span style="color:blue">cld_strdup</span> to make a copy first, and then break down the copy. The variable 'broken' (of <span style="color:blue">cld_broken</span> type) has <span style="color:blue">num_pieces</span> member (the number of pieces broken down to) and <span style="color:blue">pieces</span> (the array of pieces). &nbsp;<br/>
<br/>
In the above example, we first break down the original string into pieces separated by "+", and then break those down separated by "=" (in general the separator is any string). Since the original string is broken down, you can also traverse the pieces by reading them zero-terminated one by one from the original string to_break.<br/>
<br/>
This is an efficient way of breaking down a string without making any copies.<br/>
<a id='138'>
<h2>Clear Unused variable error</h2>
</a>
<br/>
It is a good practice to delete unused variables, but sometimes they cannot be. To prevent compiler warnings, use:<br/>
<div class="codestyle">
<span style="color:blue">CLD_UNUSED</span>(x);<br/>
</div>
<a id='139'>
<h2>Error reporting</h2>
</a>
<br/>
Fatal errors (resulting in program termination) can be reported by <span style="color:blue">cld_report_error</span> which takes the arguments the same as printf and returns number of bytes written:<br/>
<div class="codestyle">
<span style="color:blue">cld_report_error</span>("Error %s happened, terminating", err); <br/>
</div>
To report errors and do not exit, use:<br/>
<div class="codestyle">
<span style="color:blue">cld_report_error_no_exit</span>("Error %s happened, continuing", err) <br/>
</div>
In either case, any currently open database transactions are rolled back.<br/>
<a id="encrypt_api"></a>
<a id='140'>
<h2>Encryption and hashing</h2>
</a>
Cloudgizer uses 256 bit SHA hashing and AES encryption. The cipher used is AES-256-CBC.<br/>
<a id='141'>
<h3>Hashing</h3>
</a>
<br/>
To create a 256-bit SHA hash, use <span style="color:blue">cld_sha</span>:<br/>
<div class="codestyle">
char *hash = <span style="color:blue">cld_sha</span>("some value to hash");<br/>
</div>
Variable hash now contains hashed value of "some value to hash". This is a string terminated by null character, always 64 bytes in length. Hashed value might look something like 'e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855'.<br/>
<a id='142'>
<h3>Encrypting data</h3>
</a>
<br/>
Use <span style="color:blue">cld_aes_encrypt</span>, for example:<br/>
<div class="codestyle">
char *to_encrypt = "some data to encrypt";<br/>
int len = strlen(to_encrypt);<br/>
<span style="color:blue">EVP_CIPHER_CTX</span> e_ctx;<br/>
<span style="color:blue">cld_get_enc_key</span>("password", "salt", &amp;e_ctx, NULL);<br/>
char *encrypted_data = <span style="color:blue">cld_aes_encrypt</span>(&amp;e_ctx, (unsigned char*)to_encrypt, &amp;len, 0);<br/>
</div>
The output of the function ('encrypted_data') contains encrypted data, which is allocated by Cloudgizer.<br/>
<br/>
In &nbsp;the above example, we first create an encryption context out of password and salt ("password" and "salt" in the above example) and encrypt string 'to_encrypt' of length 'len'. The fourth parameter is 0 (character mode of encryption), meaning the result is the character string (i.e. the encrypted value is null-terminated and suitable for using in database varchar columns, for example). &nbsp;If the fourth parameter is 1 (binary mode of encryption), the result is a binary encrypted string. <br/>
<br/>
If it is character mode, then the encrypted output will be converted into a string of hexadecimal characters (i.e. ranging from '0' to '9' and from 'a' to 'f') terminated by null character. The maximum size of a buffer of encrypted string is 2*(length_of_input_string+16)+1. This accounts for the maximum of 16 bytes extra for AES, and double for hexadecimal representation (in case of character mode of encryption). &nbsp;Character mode of encryption is convenient if the result of encryption should be a human readable string, or for the purposes of non-binary storage in the database.<br/>
<br/>
Variable 'len' holds the length (in bytes) of data to encrypt, and on return it holds the length (in bytes) of the encrypted data (excluding zero byte at the end if the fourth parameter is 0, i.e. if the result is a character string). <br/>
<br/>
The salt can be NULL in which case no salt is used.<br/>
<a id='143'>
<h3>Decrypting data</h3>
</a>
<br/>
Use <span style="color:blue">cld_aes_decrypt</span>. If 'encrypted_data' is encrypted data produced by <span style="color:blue">cld_aes_encrypt</span>:<br/>
<div class="codestyle">
<span style="color:blue">EVP_CIPHER_CTX</span> d_ctx;<br/>
<span style="color:blue">cld_get_enc_key</span>("password", "salt", NULL, &amp;d_ctx);<br/>
int len = strlen (encrypted_data);<br/>
char *decrypted_data = <span style="color:blue">cld_aes_decrypt</span>(&amp;d_ctx, (unsigned char*)encrypted_data, &amp;len, 0);<br/>
</div>
The output of the function ('decrypted_data') contains decrypted data, which is allocated by Cloudgizer.<br/>
<br/>
In &nbsp;the above example, we first create a decryption context out of password and salt ("password" and "salt" in the above example) and decrypt string 'encrypted_data' of length 'len'. The fourth parameter is 0, meaning that 'encrypted_data' is a character string produced by <span style="color:blue">cld_aes_encrypt</span> with fourth parameter of 0. When decrypting, password, salt and the mode of encryption (binary or character) must match between <span style="color:blue">cld_aes_encrypt</span> and <span style="color:blue">cld_aes_decrypt</span>.<br/>
<br/>
Variable 'len' holds the length (in bytes) of encrypted data (excluding zero byte at the end in case of character mode of encryption), and on return it holds the length (in bytes) of the decrypted data (excluding zero byte at the end which is always placed at the end of decrypted data). <br/>
<a id='144'>
<h3>Generating random string</h3>
</a>
<br/>
To generate a random string (null-terminated) use <span style="color:blue">cld_make_random()</span>. For example, to generate a random string, use:<br/>
<div class="codestyle">
char rnd[20];<br/>
<span style="color:blue">cld_make_random</span> (rnd, sizeof(rnd));<br/>
</div>
Variable 'rnd' now holds random string of length 19. The buffer 'rnd' must be at least a byte longer than the length of random string you desire, to accomodate null terminator.<br/>
<a id='145'>
<h2>Storing and retrieving data in a sequential list (FIFO)</h2>
</a>
<br/>
To store data in a sequential list, and be able to rewind to the beginning and retrieve later, use functions related to <span style="color:blue">cld_store_data</span> type:<br/>
<div class="codestyle">
<span style="color:green">// Declare list data<br/></span>
<span style="color:blue">cld_store_data</span> list_data;<br/>
<br/>
<span style="color:green">// Initialize list data<br/></span>
<span style="color:blue">cld_store_init</span> (&amp;list_data);<br/>
<br/>
<span style="color:green">// Store name/value pairs to list data<br/></span>
<span style="color:blue">cld_store</span> (&amp;list_data, "item name 1", "item value 1");<br/>
<span style="color:blue">cld_store</span> (&amp;list_data, "item name 2", "item value 2");<br/>
<span style="color:blue">cld_store</span> (&amp;list_data, "item name 3", "item value 3");<br/>
...<br/>
<br/>
<span style="color:green">// Rewind list data to the beginning<br/></span>
<span style="color:blue">cld_rewind</span> (&amp;list_data);<br/>
<br/>
<span style="color:green">// Retrieve name/value pairs in the order in which they were put in<br/></span>
char *item_name;<br/>
char *item_value;<br/>
while (1)<br/>
{<br/>
 &nbsp; &nbsp;<span style="color:blue">cld_retrieve</span> (&amp;list_data, &amp;item_name, &amp;item_value);<br/>
 &nbsp; &nbsp;if (name == NULL) break;<br/>
<span style="color:green"> &nbsp; &nbsp;//<br/></span>
<span style="color:green"> &nbsp; &nbsp;// item_name and item_value will be "item name 1"/"item value 1", "item name 2"/"item value 2" etc.<br/></span>
<span style="color:green"> &nbsp; &nbsp;//<br/></span>
}<br/>
<br/>
<span style="color:green">// Delete list data<br/></span>
<span style="color:blue">cld_purge</span> (&amp;list_data);<br/>
</div>
<a id="execute"></a>
<a id='146'>
<h2>Executing Cloudgizer program from command line (Batch processing)</h2>
</a>
<a id='147'>
<h3>Using batch processing</h3>
</a>
<br/>
Batch processing is using the program as a command line program. To enable batch processing, use <span style="color:blue">cld_enable_batch_processing</span>:<br/>
<div class="codestyle">
<span style="color:blue">cld_enable_batch_processing</span>();<br/>
</div>
Batch processing disables web output (HTML output). Only output to a string will work, while web output will not. You can output to stdout and stderr (either via C functions like printf or via markups like <span style="color:blue">print-out</span> and <span style="color:blue">print-error</span>), and read from stdin. A batch program can still receive input parameters via URL, through environment variables, much like web server would:<br/>
<div class="codestyle">
export <span style="color:blue">REQUEST_METHOD</span>=GET<br/>
export <span style="color:blue">QUERY_STRING</span>="page=home&amp;action=employees"<br/>
export <span style="color:blue">CLD_BATCH_PROCESSING=yes</span><br/>
./your_program<br/>
</div>
When writing <span style="color:blue">QUERY_STRING</span>, make sure that actual data is URL encoded. For that, use <span style="color:blue">-urlencode</span> option for <span style="color:blue">cld</span> command line utility, like in this example:<br/>
<div class="codestyle">
export <span style="color:blue">REQUEST_METHOD</span>=GET<br/>
export HELLO_WORLD_URL_ENCODED=$(<span style="color:blue">cld -urlencode</span> "hello world")<br/>
export <span style="color:blue">QUERY_STRING</span>="page=key&amp;dt=${HELLO_WORLD_URL_ENCODED}&amp;action=file"<br/>
export <span style="color:blue">CLD_BATCH_PROCESSING</span>=yes<br/>
./your_program<br/>
</div>
<span style="color:blue">cld -urlencode "hello world"</span> will output URL encoded "hello world" string, with space substituted with '%20'. This output is stored into an environment variable, and its contents then used in <span style="color:blue">QUERY_STRING</span> as URL-encoded string for a URL passed to your program.<br/>
<br/>
In the above bash example, <span style="color:blue">REQUEST_METHOD</span> is set to GET, and <span style="color:blue">QUERY_STRING</span> is set to request's input parameters in URL notation. You must set <span style="color:blue">CLD_BATCH_PROCESSING</span> to yes, and examine it in your program:<br/>
<div class="codestyle">
...<br/>
const char *batch_env = <span style="color:blue">cld_ctx_getenv</span> ("<span style="color:blue">CLD_BATCH_PROCESSING</span>");<br/>
if (!strcasecmp (batch_env, "yes"))<br/>
{<br/>
 &nbsp; &nbsp;<span style="color:blue">cld_enable_batch_processing</span>();<br/>
 &nbsp; &nbsp;<span style="color:blue">/*&lt;</span><br/>
 &nbsp; &nbsp;<span style="color:blue">input-param</span> action<br/>
 &nbsp; &nbsp;<br/>
 &nbsp; &nbsp;if-string action="employees"<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">write-string</span> define employees<br/>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;List of employees<br/>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;hr/&gt;<br/>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">run-query#</span>my_query="select name, extract(year from dateOfHire) yearOfHire from employee"<br/>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">query-result#</span>my_query<span style="color:blue">,</span> name <span style="color:blue">as define</span> name<br/>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">query-result#</span>my_query<span style="color:blue">,</span> yearOfHire <span style="color:blue">as</span> <span style="color:blue">define</span> year_of_hire<br/>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">print-web</span> name<br/>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;,<br/>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">print-web</span> year_of_hire<br/>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;br/&gt;<br/>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">end-query</span><br/>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;hr/&gt;<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">end-write-string</span><br/>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">print-out</span> "%s", employees<br/>
 &nbsp; &nbsp;end-if<br/>
 &nbsp; &nbsp;<span style="color:blue">&gt;*/</span><br/>
 &nbsp; &nbsp;return;<br/>
}<br/>
...<br/>
</div>
In this program, <span style="color:blue">cld_ctx_getenv</span> is first used to enable batch processing with <span style="color:blue">cld_enable_batch_processing</span>, meaning there is no web output. However, you can use most all other features such as working with input parameters, writing strings, queries etc. In the end, the program outputs to standard output:<br/>
<br/>
List of employees<br/>
&lt;hr/&gt;<br/>
Linda,2001&lt;br/&gt;<br/>
John,2003&lt;br/&gt;<br/>
&lt;hr/&gt;<br/>
<br/>
Batch programs can be often written together with web programs if their business logic is intertwined. Effectively you can write programs that could be used as both web and command-line programs, for example:<br/>
<div class="codestyle">
...<br/>
const char *batch_env = <span style="color:blue">cld_ctx_getenv</span> ("<span style="color:blue">CLD_BATCH_PROCESSING</span>");<br/>
int is_batch = !strcasecmp (batch_env, "yes"));<br/>
<br/>
if (is_batch)<br/>
{<br/>
 &nbsp; &nbsp;<span style="color:blue">cld_enable_batch_processing</span>();<br/>
}<br/>
else<br/>
{<br/>
 &nbsp; &nbsp;<span style="color:blue">/*&lt;</span> <span style="color:blue">output-http-header</span> <span style="color:blue">&gt;*/</span><br/>
}<br/>
<br/>
<span style="color:blue">/*&lt;</span><br/>
<span style="color:blue">input-param</span> action<br/>
<br/>
<span style="color:blue">if-string</span> action="employees"<br/>
 &nbsp; &nbsp;<span style="color:blue">write-string</span> define employees<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;List of employees<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;hr/&gt;<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">run-query#</span>my_query="select name, extract(year from dateOfHire) yearOfHire from employee"<br/>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">query-result#</span>my_query<span style="color:blue">,</span> name <span style="color:blue">as define</span> name<br/>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">query-result#</span>my_query<span style="color:blue">,</span> yearOfHire <span style="color:blue">as</span> define year_of_hire<br/>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">print-web</span> name<br/>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;,<br/>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">print-web</span> year_of_hire<br/>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;br/&gt;<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">end-query</span><br/>
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;hr/&gt;<br/>
 &nbsp; &nbsp;<span style="color:blue">end-write-string</span><br/>
 &nbsp; &nbsp;<span style="color:blue">if</span> is_batch<br/>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">print-out</span> " %s\n", employees<br/>
 &nbsp; &nbsp;<span style="color:blue">else</span><br/>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="color:blue">print-noenc</span> employees<br/>
 &nbsp; &nbsp;<span style="color:blue">end-if</span><br/>
<span style="color:blue">end-if</span><br/>
<span style="color:blue">&gt;*/</span><br/>
...<br/>
</div>
The above program can be called both from the web client to output a list of employees, and it can output this list to standard output. The URL parameters used are the same. Batch program's output would be the same as above, while the output to web client would be (for URL such as http://myserver.com/<span style="color:blue">go.your_app_name</span>?page=home&amp;action=employees):<br/>
<br/>
List of employees
<hr/>
Linda,2001<br/>
John,2003<br/>
<hr/>
<a id='148'>
<h3>Exit code for batch processing</h3>
</a>
<br/>
To set exit code for a command-line program, use:<br/>
<div class="codestyle">
<span style="color:blue">cld_set_exit_code</span>(3);<br/>
</div>
This sets exit code to 3.<br/>
<a id='149'>
<h2>POST URL (web call)</h2>
</a>
<br/>
To perform a web call via HTTP/HTTPS:<br/>
<div class="codestyle">
char *response;<br/>
char *error;<br/>
char *cert;<br/>
int result = <span style="color:blue">cld_post_url_with_response</span> ("https://somesite.com?par=3", &amp;response, &amp;error, &amp;cert);<br/>
</div>
The function returns 1 on success and 0 on failure. Variable error has error text in case of failure. If HTTPS is used the location of certificate file can be provided in variable cert. If cert is NULL, certificate is not checked. The actual response (minus headers) is stored in variable response. Response that redirects to another URL will be followed up to 4 times. The response is the body message, not the headers.<br/>
<a id='150'>
<h2>Files</h2>
</a>
<a id="file_create"></a>
<a id='151'>
<h3>File storage</h3>
</a>
<br/>
You can read and write any files accessible to you, using either standard C mechanisms, or the file API explained in this documentation.<br/>
<br/>
You can also use a provided file storage under 'file' directory - see <a href="#file_storage">more about this file storage</a>.<br/>
<br/>
To create a file in this file storage, use the following code:<br/>
<div class="codestyle">
<span style="color:blue">define-string</span> document_id<br/>
c char document_file[<span style="color:blue">MAX_FILENAME_SIZE</span>];<br/>
c FILE *f = <span style="color:blue">cld_make_document</span> (&amp;document_id, document_file, <span style="color:blue">MAX_FILENAME_SIZE</span>); <br/>
</div>
Output variables are document_id (containing the unique ID of the file created, produced by using <span style="color:blue">cldDocumentGenerator</span> table), document_file (containing unique file name with a complete path to it), and file descriptor 'f' as the file created is opened and ready to write to.<br/>
<br/>
You'd typically store file ID and its path in the database, and use them to later manipulate the file (read, write, delete etc.).<br/>
<a id='152'>
<h3>Get file size</h3>
</a>
<br/>
To get the size of a file:<br/>
<div class="codestyle">
size_t sz = <span style="color:blue">cld_get_file_size</span> ("/home/user/my_file");<br/>
</div>
The return value will be -1 if cannot open file or its size.<br/>
<a id='153'>
<h3>Copy files</h3>
</a>
<div class="codestyle">
int result = <span style="color:blue">cld_copy_file</span> ("/home/user/from_file", "/home/user/to_file");<br/>
</div>
This copies from file from_file to file to_file. The result is -1 if cannot open from_file, -2 if cannot open to_file, -3 if cannot read from_file, -4 if cannot write to_file, and 1 on success.<br/>
<a id='154'>
<h3>Read entire file into a string variable</h3>
</a>
<div class="codestyle">
char *file_data;<br/>
int result = <span style="color:blue">cld_read_whole_file</span> ("/home/path/my_file", &amp;file_data);<br/>
</div>
This reads file my_file into string variable file_data, which is <span style="color:blue">cld_malloc</span>() allocated (like all Cloudgizer memory is). Variable 'result' is -1 if cannot open my_file, -2 if cannot read my_file, and the size of the file read (0, or a positive number) if reading succeeded. &nbsp;<br/>
<a id='155'>
<h3>Write whole file from a string</h3>
</a>
<div class="codestyle">
char content[] = "some content";<br/>
size_t content_len = strlen(content);<br/>
<br/>
int result = <span style="color:blue">cld_write_file</span> ("/home/path/my_file", content, content_len, <span style="color:blue">0</span>);<br/>
</div>
This writes "some content" to my_file. Variable 'result' is -1 if cannot open my_file, -2 if cannot write it, and 1 if writing succeeded. The whole file is overwritten with the new content.<br/>
<a id='156'>
<h3>Append to file from a string</h3>
</a>
<div class="codestyle">
char content[] = "new content";<br/>
size_t content_len = strlen(content);<br/>
<br/>
int result = <span style="color:blue">cld_write_file</span> ("/home/path/my_file", content, content_len, <span style="color:blue">1</span>);<br/>
</div>
This appends "new content" to the end of my_file. Variable 'result' is -1 if cannot open my_file, -2 if cannot write it, and 1 if writing succeeded.<br/>
<a id='157'>
<h3>Lock a file</h3>
</a>
<br/>
You can create a file and lock it so your process has exclusive read and write lock on it. This can be useful as a process control means, for example to ensure only one process can continue work. <br/>
<div class="codestyle">
<span style="color:green">// returns 0 if cannot lock, -1 if cannot open file, 1 if locked,-2 invalid path<br/></span>
int file_descriptor;<br/>
int result = <span style="color:blue">cld_lockfile</span> ("/home/user/file_to_create", &amp;file_descriptor);<br/>
</div>
The function returns -2 if file path is invalid, -1 if cannot open file, 0 if cannot lock, and 1 if locked.<br/>
<br/>
The process must not close stdout, stderr or stdin while file lock is in effect.<br/>
<br/>
The file stays locked until the program ends, or until it's closed, for instance:<br/>
<div class="codestyle">
close (file_descriptor);<br/>
</div>
<a id='158'>
<h3>Get application home directory</h3>
</a>
<br/>
Application's home directory is a directory named after application name location directly under the home directory of the user who executes the program:<br/>
<div class="codestyle">
char *home_directory = <span style="color:blue">cld_home_dir</span> ();<br/>
</div>
If cannot determine application home directory, empty string ("") is returned.<br/>
<br/>
Application's home directory is based on application name. For example, if variable <span style="color:blue">cld_handler_name</span> is 'your_app_name' (which is the same as <span style="color:blue">CLD_APP_NAME</span> in <span style="color:blue">appinfo</span> during installation), then application home directory is /home/user/your_app_name. Do not ever change variable <span style="color:blue">cld_handler_name</span>.<br/>
<a id='159'>
<h3>Check if directory</h3>
</a>
<br/>
To determine if something is a directory:<br/>
<div class="codestyle">
int is_dir = <span style="color:blue">cld_is_directory</span> ("/home/user/something");<br/>
</div>
Variable is_dir will be 1 if something is a directory, 0 otherwise. &nbsp;<br/>
<a id='160'>
<h3>Temporary files</h3>
</a>
To store temporary files, use temporary directory:<br/>
<div class="codestyle">
<span style="color:blue">print-web</span> <span style="color:blue">cld_get_config()-&gt;app-&gt;tmp_directory</span><br/>
</div>
<a id='161'>
<h2>Send email</h2>
</a>
<br/>
To send email via sendmail, use:<br/>
<div class="codestyle">
const char *from = "addr1@something.com"<br/>
const char *to = "addr2@somethingelse.com"<br/>
int result = <span style="color:blue">cld_sendmail</span> (from, to, "subject of message", NULL, "This is the body of email message");<br/>
</div>
Variable 'result' is the exit code of sendmail program. In the previous example, 4th parameter was NULL, meaning no additional header was added to the email. Email sender is 'from' and recipient 'to', followed by the subject of the message, while the message itself is the 5th parameter.<br/>
<br/>
If you want to add custom headers to the email sent (for example to send HTML email, for attachments etc.), you can add them:<br/>
<div class="codestyle">
const char *from = "addr1@something.com"<br/>
const char *to = "addr2@somethingelse.com"<br/>
cons char *headers= "MIME-Version: 1.0\r\nContent-Type: text/html";<br/>
int result = <span style="color:blue">cld_sendmail</span> (from, to, "subject of message", headers, "This is the body of email message");<br/>
</div>
<a id='162'>
<h2>Queries and Transactions</h2>
</a>
<a id='163'>
<h3>SELECT from the database</h3>
</a>
<div class="codestyle">
int nrow;<br/>
int ncol;<br/>
char **col_names;<br/>
char **data;<br/>
<br/>
<span style="color:green">// To select data<br/></span>
<span style="color:blue">cld_select_table</span> ("SELECT ...", &amp;nrow, &amp;ncol, &amp;colnames, &amp;data);<br/>
</div>
'nrow' is the number of rows returned. 'ncol' is the number of columns. 'colnames' is a list of column names returned. 'data' holds all column data in order in which it is retrieved (first all columns from the first row, then from the second etc.), for example if there are two columns returned then data[0] is the first column of the first row, data[3] is the second column of the second row etc.<br/>
<br/>
'data' can be NULL, while 'colnames' cannot be NULL. Maximum &nbsp;number of output columns is 1000.<br/>
<br/>
To get column names only, without the data:<br/>
<div class="codestyle">
<span style="color:blue">cld_select_table</span> ("SELECT ...", &amp;nrow, &amp;ncol, &amp;col_names, NULL);<br/>
</div>
In this case, col_names[0] is the name of the first column, col_names[1] is the name of the second column and so forth.<br/>
<br/>
This function does not return value, and its failure will stop the program (i.e. it is expected to always succeed). &nbsp;<br/>
<a id='164'>
<h3>Get value from auto-increment column</h3>
</a>
<br/>
Insert into a table with auto increment column produces new value for it. To obtain it:<br/>
<div class="codestyle">
char val[100];<br/>
<span style="color:blue">cld_get_insert_id</span> (val, sizeof(val));<br/>
</div>
'val' is the output buffer. This function must be called immediately after INSERT and it does not return a value.<br/>
 <a id="ddl"></a>
<a id='165'>
<h3>Execute any SQL other than SELECT, including DDL statements</h3>
</a>
<div class="codestyle">
int rows;<br/>
unsigned int er;<br/>
char *err_message;<br/>
<span style="color:blue">if</span> <span style="color:blue">cld_execute_SQL</span> ("INSERT INTO ... ", &nbsp;&amp;rows, &amp;er, &amp;err_message)==1<br/>
 &nbsp; &nbsp;<span style="color:blue">print-web</span> "Success"<br/>
<span style="color:blue">else</span><br/>
 &nbsp; &nbsp;<span style="color:blue">print-web</span> "Failure"<br/>
<span style="color:blue">end-if</span><br/>
</div>
Varable 'rows' is the number of rows affected, 'er' is the error number, and 'err_message' is the error message. If failed, the function returns 0, otherwise 1.<br/>
<br/>
Use this to execute any SQL, including DDL (Data Definition Language) such as CREATE TABLE, DROP TABLE etc. <br/>
<a id='166'>
<h3>Check for open transaction</h3>
</a>
<div class="codestyle">
if <span style="color:blue">cld_check_transaction</span>(1)==1<br/>
 &nbsp; &nbsp;print-web "You have an open transaction!"<br/>
end-if<br/>
</div>
If input parameter is 1, the function returns 1 if there is an open transaction and 0 if not. If input parameter is 0 then it will report an error if there is an open transaction and it will return 0 if not.<br/>
<br/>
If input parameter is 2, and there is an open transaction, rollback this transaction and return 0.<br/>
<a id='167'>
<h2>Get miscellaneous</h2>
</a>
<a id='168'>
<h3>Get web address for forms and links</h3>
</a>
<br/>
Web address (for forms and links) is obtained from <span style="color:blue">config</span> file under <span style="color:blue">web_address</span> field. You can get it from:<br/>
<div class="codestyle">
const char *web_address = <span style="color:blue">cld_web_address</span> ();<br/>
</div>
<a id='169'>
<h3>Get Base URL of server</h3>
</a>
<br/>
Base URL for "https://myserver.com/go.your_app_name?par1=val1" is "myserver.com". To obtain it, use <span style="color:blue">cld_web_name</span> and pass any URL leading to the server:<br/>
<div class="codestyle">
char *base_URL = <span style="color:blue">cld_web_name</span>(<span style="color:blue">cld_web_address</span>()); <br/>
</div>
This will produce the base name of a web server running the program.<br/>
<a id='170'>
<h3>Get version</h3>
</a>
<br/>
The software version can be obtained via following call:<br/>
<div class="codestyle">
const char *major_version = <span style="color:blue">cld_major_version</span>();<br/>
</div>
<a id='171'>
<h3>Get current, past or future time, including GMT</h3>
</a>
To get current, past or future time, suitable for cookies, use <span style="color:blue">cld_time</span>:<br/>
<div class="codestyle">
char *<span style="color:blue">cld_time</span> (const char *timezone, int year, int month, int day, int hour, int min, int sec);<br/>
</div>
Returns time (now, in the future, or the past). Input parameter 'timezone' is the name of TZ (timezone). So to get GMT time then timezone should be "GMT", if it is Mountain Standard then it is "MST" etc.<br/>
<br/>
Input parameters year,month,day,hour,min,sec are the time to add to current time (they can be negative too). So for example ..(0,0,1,0,0,1) adds 1 day and 1 second to the current time, while ..(0,-1,0,0,0) is one month in the past.<br/>
<a id='172'>
<h3>Get current time</h3>
</a>
<br/>
To get current time, per local time zone, use <span style="color:blue">cld_current_time</span>. The arguments are the buffer where the time should be stored and its length:<br/>
<div class="codestyle">
char buf[50];<br/>
<span style="color:blue">cld_current_time</span> (buf, sizeof(buf));<br/>
</div>
The time returned shows year, month, day of month, hour, minute, second, separated by a dash, such as '2017-07-30-18:48:13', with hours in 0-24 range.<br/>
<a id='173'>
<h3>Get application name</h3>
</a>
<br/>
Application name is stored in global variable <span style="color:blue">cld_handler_name</span>, this is the same as <span style="color:blue">CLD_APP_NAME</span> in <span style="color:blue">appinfo</span> file during installation. <br/>
<div class="codestyle">
/*&lt;<br/>
 &nbsp;Application name is &lt;?print-web <span style="color:blue">cld_handler_name</span>?&gt;<br/>
&gt;*/<br/>
</div>
Application's home directory is based on it. For example, if <span style="color:blue">cld_handler_name</span> is 'your_app_name', then application home directory is /home/user/your_app_name.<br/>
<br/>
Never change <span style="color:blue">cld_handler_name</span>.<br/>
<a id='174'>
<h3>Get environment variable (web or command shell)</h3>
</a>
<br/>
Environment variables can be available from the operating system or the web server. If the program is running in batch mode (i.e. command line), the environment used is that of the OS. When a program is running within a web server, first web server's variables are searched for a match, and if not found, the OS environment is used. The call that does this is <span style="color:blue">cld_ctx_getenv</span>:<br/>
<div class="codestyle">
const char *env_value = <span style="color:blue">cld_ctx_getenv</span> ("CONTENT_TYPE");<br/>
</div>
<hr/>
<div>Copyright (c) DaSoftver LLC 2017. Cloudgizer is a trademark of Zigguro LLC. Contact email address dasoftver@gmail.com. The DaSofver software and information herein are provided "AS IS" and without any warranties or guarantees of any kind. </div>
<br/>
<br/>
</div>
</body>
</html>
<br/>
